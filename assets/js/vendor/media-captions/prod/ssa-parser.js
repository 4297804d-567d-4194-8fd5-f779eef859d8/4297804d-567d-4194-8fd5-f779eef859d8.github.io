/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/media-captions@1.0.4/dist/prod/ssa-parser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{b as VTTCue,p as parseVTTTimestamp}from"./index.js";const FORMAT_START_RE=/^Format:[\s\t]*/,STYLE_START_RE=/^Style:[\s\t]*/,DIALOGUE_START_RE=/^Dialogue:[\s\t]*/,FORMAT_SPLIT_RE=/[\s\t]*,[\s\t]*/,STYLE_FUNCTION_RE=/\{[^}]+\}/g,NEW_LINE_RE=/\\N/g,STYLES_SECTION_START_RE=/^\[(.*)[\s\t]?Styles\]$/,EVENTS_SECTION_START_RE=/^\[(.*)[\s\t]?Events\]$/;class SSAParser{h;O=0;c=null;l=[];m=[];N=null;f;P={};async init(e){this.h=e,e.errors&&(this.f=(await import("./errors.js")).ParseErrorBuilder)}parse(e,t){if(this.O)switch(this.O){case 1:if(""===e)this.O=0;else if(STYLE_START_RE.test(e))if(this.N){const t=e.replace(STYLE_START_RE,"").split(FORMAT_SPLIT_RE);this.S(t)}else this.g(this.f?.T("Style",t));else FORMAT_START_RE.test(e)?this.N=e.replace(FORMAT_START_RE,"").split(FORMAT_SPLIT_RE):EVENTS_SECTION_START_RE.test(e)&&(this.N=null,this.O=2);break;case 2:if(""===e)this.Q();else if(DIALOGUE_START_RE.test(e))if(this.Q(),this.N){const s=e.replace(DIALOGUE_START_RE,"").split(FORMAT_SPLIT_RE),a=this.U(s,t);a&&(this.c=a)}else this.g(this.f?.T("Dialogue",t));else this.c?this.c.text+="\n"+e.replace(STYLE_FUNCTION_RE,"").replace(NEW_LINE_RE,"\n"):FORMAT_START_RE.test(e)?this.N=e.replace(FORMAT_START_RE,"").split(FORMAT_SPLIT_RE):STYLES_SECTION_START_RE.test(e)?(this.N=null,this.O=1):EVENTS_SECTION_START_RE.test(e)&&(this.N=null)}else""===e||(STYLES_SECTION_START_RE.test(e)?(this.N=null,this.O=1):EVENTS_SECTION_START_RE.test(e)&&(this.N=null,this.O=2))}done(){return{metadata:{},cues:this.l,regions:[],errors:this.m}}Q(){this.c&&(this.l.push(this.c),this.h.onCue?.(this.c),this.c=null)}S(e){let t,s,a,r,i="Default",l={},n="center",c="bottom",o=1.2,h=3,T=[];for(let u=0;u<this.N.length;u++){const S=this.N[u],p=e[u];switch(S){case"Name":i=p;break;case"Fontname":l["font-family"]=p;break;case"Fontsize":l["font-size"]=`calc(${p} / var(--overlay-height))`;break;case"PrimaryColour":const e=parseColor(p);e&&(l["--cue-color"]=e);break;case"BorderStyle":h=parseInt(p,10);break;case"BackColour":r=parseColor(p);break;case"OutlineColour":const u=parseColor(p);u&&(a=u);break;case"Bold":parseInt(p)&&(l["font-weight"]="bold");break;case"Italic":parseInt(p)&&(l["font-style"]="italic");break;case"Underline":parseInt(p)&&(l["text-decoration"]="underline");break;case"StrikeOut":parseInt(p)&&(l["text-decoration"]="line-through");break;case"Spacing":l["letter-spacing"]=p+"px";break;case"AlphaLevel":l.opacity=parseFloat(p);break;case"ScaleX":T.push(`scaleX(${parseFloat(p)/100})`);break;case"ScaleY":T.push(`scaleY(${parseFloat(p)/100})`);break;case"Angle":T.push(`rotate(${p}deg)`);break;case"Shadow":o=1.2*parseInt(p,10);break;case"MarginL":l["--cue-width"]="auto",l["--cue-left"]=parseFloat(p)+"px";break;case"MarginR":l["--cue-width"]="auto",l["--cue-right"]=parseFloat(p)+"px";break;case"MarginV":s=parseFloat(p);break;case"Outline":t=parseInt(p,10);break;case"Alignment":const S=parseInt(p,10);switch(S>=4&&(c=S>=7?"top":"center"),S%3){case 1:n="start";break;case 2:n="center";break;case 3:n="end"}}}if(l.R=c,l["--cue-white-space"]="normal",l["--cue-line-height"]="normal",l["--cue-text-align"]=n,"center"===c?(l["--cue-top"]="50%",T.push("translateY(-50%)")):l[`--cue-${c}`]=(s||0)+"px",1===h&&(l["--cue-padding-y"]="0"),(1===h||r)&&(l["--cue-bg-color"]=1===h?"none":r),3===h&&a&&(l["--cue-outline"]=`${t}px solid ${a}`),1===h&&"number"==typeof t){const e=r??"#000";l["--cue-text-shadow"]=[a&&buildTextShadow(1.2*t,1.2*o,a),a?buildTextShadow(t*(t/2),o*(t/2),e):buildTextShadow(t,o,e)].filter(Boolean).join(", ")}T.length&&(l["--cue-transform"]=T.join(" ")),this.P[i]=l}U(e,t){const s=this.V(e),a=this.q(s.Start,s.End,t);if(!a)return;const r=new VTTCue(a[0],a[1],""),i={...this.P[s.Style]||{}},l=s.Name?`<v ${s.Name}>`:"",n=i.R,c=s.MarginL&&parseFloat(s.MarginL),o=s.MarginR&&parseFloat(s.MarginR),h=s.MarginV&&parseFloat(s.MarginV);return c&&(i["--cue-width"]="auto",i["--cue-left"]=c+"px"),o&&(i["--cue-width"]="auto",i["--cue-right"]=o+"px"),h&&"center"!==n&&(i[`--cue-${n}`]=h+"px"),r.text=l+e.slice(this.N.length-1).join(", ").replace(STYLE_FUNCTION_RE,"").replace(NEW_LINE_RE,"\n"),delete i.R,Object.keys(i).length&&(r.style=i),r}V(e){const t={};for(let s=0;s<this.N.length;s++)t[this.N[s]]=e[s];return t}q(e,t,s){const a=parseVTTTimestamp(e),r=parseVTTTimestamp(t);if(null!==a&&null!==r&&r>a)return[a,r];null===a&&this.g(this.f?.s(e,s)),null===r&&this.g(this.f?.t(t,s)),null!=a&&null!==r&&r>a&&this.g(this.f?.u(a,r,s))}g(e){if(e){if(this.m.push(e),this.h.strict)throw this.h.cancel(),e;this.h.onError?.(e)}}}function parseColor(e){const t=parseInt(e.replace("&H",""),16);if(t>=0){return"rgba("+[255&t,t>>8&255,t>>16&255,(t>>24&255^255)/255].join(",")+")"}return null}function buildTextShadow(e,t,s){const a=Math.ceil(2*Math.PI*e);let r="";for(let i=0;i<a;i++){const l=2*Math.PI*i/a;r+=e*Math.cos(l)+"px "+t*Math.sin(l)+"px 0 "+s+(i==a-1?"":",")}return r}function createSSAParser(){return new SSAParser}export{SSAParser,createSSAParser as default};
//# sourceMappingURL=/sm/65f4de8c96b98ae1cdfa361c7ac33197ce69424873aaeabcefdd75cbcd91aedd.map