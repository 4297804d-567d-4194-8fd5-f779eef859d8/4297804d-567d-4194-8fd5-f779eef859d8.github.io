var __defProp=Object.defineProperty,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__publicField=(e,t,n)=>(__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),n),__accessCheck=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},__privateGet=(e,t,n)=>(__accessCheck(e,t,"read from private field"),n?n.call(e):t.get(e)),__privateAdd=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},__privateSet=(e,t,n,r)=>(__accessCheck(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),ZapThreads=function(){var e,t,n,r;const o=Symbol("solid-proxy"),i=Symbol("solid-track"),s={equals:(e,t)=>e===t};let a=T;const l=1,c=2,u={owned:null,cleanups:null,context:null,owner:null},f={};var d=null;let h,p=null,g=null,y=null,m=null,v=0;function b(e,t){const n=g,r=d,o=0===e.length,i=void 0===t?r:t,s=o?u:{owned:null,cleanups:null,context:i?i.context:null,owner:i},a=o?e:()=>e((()=>S((()=>U(s)))));d=s,g=null;try{return P(a,!0)}finally{g=n,d=r}}function w(e,t){const n={value:e,observers:null,observerSlots:null,comparator:(t=t?Object.assign({},s,t):s).equals||void 0};return[O.bind(n),e=>("function"==typeof e&&(e=e(n.value)),L(n,e))]}function k(e,t,n){M($(e,t,!0,l))}function _(e,t,n){M($(e,t,!1,l))}function x(e,t,n){a=j;const r=$(e,t,!1,l),o=h&&function(e){let t;return d&&d.context&&void 0!==(t=d.context[e.id])?t:e.defaultValue}(h);o&&(r.suspense=o),n&&n.render||(r.user=!0),m?m.push(r):M(r)}function E(e,t,n){n=n?Object.assign({},s,n):s;const r=$(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,M(r),O.bind(r)}function A(e,t,n){let r,o,i;2===arguments.length&&"object"==typeof t||1===arguments.length?(r=!0,o=e,i=t||{}):(r=e,o=t,i=n||{});let s=null,a=f,l=!1,c="initialValue"in i,u="function"==typeof r&&E(r);const d=new Set,[p,y]=(i.storage||w)(i.initialValue),[m,v]=w(void 0),[b,_]=w(void 0,{equals:!1}),[x,A]=w(c?"ready":"unresolved");function C(e,t,n,r){return s===e&&(s=null,void 0!==r&&(c=!0),e!==a&&t!==a||!i.onHydrated||queueMicrotask((()=>i.onHydrated(r,{value:t}))),a=f,function(e,t){P((()=>{void 0===t&&y((()=>e)),A(void 0!==t?"errored":c?"ready":"unresolved"),v(t);for(const e of d.keys())e.decrement();d.clear()}),!1)}(t,n)),t}function z(){const e=h,t=p(),n=m();if(void 0!==n&&!s)throw n;return g&&!g.user&&e&&k((()=>{b(),s&&(e.resolved||d.has(e)||(e.increment(),d.add(e)))})),t}function I(e=!0){if(!1!==e&&l)return;l=!1;const t=u?u():r;if(null==t||!1===t)return void C(s,S(p));const n=a!==f?a:S((()=>o(t,{value:p(),refetching:e})));return(i=n)&&"object"==typeof i&&"then"in i?(s=n,"value"in n?("success"===n.status?C(s,n.value,void 0,t):C(s,void 0,D(n.value),t),n):(l=!0,queueMicrotask((()=>l=!1)),P((()=>{A(c?"refreshing":"pending"),_()}),!1),n.then((e=>C(n,e,void 0,t)),(e=>C(n,void 0,D(e),t))))):(C(s,n,void 0,t),n);var i}return Object.defineProperties(z,{state:{get:()=>x()},error:{get:()=>m()},loading:{get(){const e=x();return"pending"===e||"refreshing"===e}},latest:{get(){if(!c)return z();const e=m();if(e&&!s)throw e;return p()}}}),u?k((()=>I(!1))):I(!1),[z,{refetch:I,mutate:y}]}function C(e){return P(e,!1)}function S(e){if(null===g)return e();const t=g;g=null;try{return e()}finally{g=t}}function z(e,t,n){const r=Array.isArray(e);let o,i=n&&n.defer;return n=>{let s;if(r){s=Array(e.length);for(let t=0;t<e.length;t++)s[t]=e[t]()}else s=e();if(i)return i=!1,n;const a=S((()=>t(s,o,n)));return o=s,a}}function I(e){return null===d||(null===d.cleanups?d.cleanups=[e]:d.cleanups.push(e)),e}function B(){return g}function O(){if(this.sources&&this.state)if(this.state===l)M(this);else{const e=y;y=null,P((()=>N(this)),!1),y=e}if(g){const e=this.observers?this.observers.length:0;g.sources?(g.sources.push(this),g.sourceSlots.push(e)):(g.sources=[this],g.sourceSlots=[e]),this.observers?(this.observers.push(g),this.observerSlots.push(g.sources.length-1)):(this.observers=[g],this.observerSlots=[g.sources.length-1])}return this.value}function L(e,t,n){let r=e.value;return e.comparator&&e.comparator(r,t)||(e.value=t,e.observers&&e.observers.length&&P((()=>{for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t],r=p&&p.running;r&&p.disposed.has(n),(r?n.tState:n.state)||(n.pure?y.push(n):m.push(n),n.observers&&q(n)),r||(n.state=l)}if(y.length>1e6)throw y=[],new Error}),!1)),t}function M(e){if(!e.fn)return;U(e);const t=v;!function(e,t,n){let r;const o=d,i=g;g=d=e;try{r=e.fn(t)}catch(s){return e.pure&&(e.state=l,e.owned&&e.owned.forEach(U),e.owned=null),e.updatedAt=n+1,F(s)}finally{g=i,d=o}(!e.updatedAt||e.updatedAt<=n)&&(null!=e.updatedAt&&"observers"in e?L(e,r):e.value=r,e.updatedAt=n)}(e,e.value,t)}function $(e,t,n,r=l,o){const i={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:d,context:d?d.context:null,pure:n};return null===d||d!==u&&(d.owned?d.owned.push(i):d.owned=[i]),i}function R(e){if(0===e.state)return;if(e.state===c)return N(e);if(e.suspense&&S(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<v);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if((e=t[n]).state===l)M(e);else if(e.state===c){const n=y;y=null,P((()=>N(e,t[0])),!1),y=n}}function P(e,t){if(y)return e();let n=!1;t||(y=[]),m?n=!0:m=[],v++;try{const t=e();return function(e){y&&(T(y),y=null);if(e)return;const t=m;m=null,t.length&&P((()=>a(t)),!1)}(n),t}catch(r){n||(m=null),y=null,F(r)}}function T(e){for(let t=0;t<e.length;t++)R(e[t])}function j(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:R(r)}for(t=0;t<n;t++)R(e[t])}function N(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const e=r.state;e===l?r!==t&&(!r.updatedAt||r.updatedAt<v)&&R(r):e===c&&N(r,t)}}}function q(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=c,n.pure?y.push(n):m.push(n),n.observers&&q(n))}}function U(e){let t;if(e.sources)for(;e.sources.length;){const t=e.sources.pop(),n=e.sourceSlots.pop(),r=t.observers;if(r&&r.length){const e=r.pop(),o=t.observerSlots.pop();n<r.length&&(e.sourceSlots[o]=n,r[n]=e,t.observerSlots[n]=o)}}if(e.owned){for(t=e.owned.length-1;t>=0;t--)U(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function D(e){return e instanceof Error?e:new Error("string"==typeof e?e:"Unknown error",{cause:e})}function F(e,t=d){throw D(e)}const H=Symbol("fallback");function V(e){for(let t=0;t<e.length;t++)e[t]()}function K(e,t){return S((()=>e(t||{})))}function W(e){const t="fallback"in e&&{fallback:()=>e.fallback};return E(function(e,t,n={}){let r,o=[],s=[],a=[],l=[],c=0;return I((()=>V(a))),()=>{const u=e()||[],f=u.length;return u[i],S((()=>{if(0===f)return 0!==c&&(V(a),a=[],o=[],s=[],c=0,l=[]),n.fallback&&(o=[H],s[0]=b((e=>(a[0]=e,n.fallback()))),c=1),s;for(o[0]===H&&(a[0](),a=[],o=[],s=[],c=0),r=0;r<f;r++)r<o.length&&o[r]!==u[r]?l[r]((()=>u[r])):r>=o.length&&(s[r]=b(d));for(;r<o.length;r++)a[r]();return c=l.length=a.length=f,o=u.slice(0),s=s.slice(0,c)}));function d(e){a[r]=e;const[n,o]=w(u[r]);return l[r]=o,t(n,r)}}}((()=>e.each),e.children,t||void 0))}function Z(e){const t=e.keyed,n=E((()=>e.when),void 0,{equals:(e,n)=>t?e===n:!e==!n});return E((()=>{const r=n();if(r){const o=e.children;return"function"==typeof o&&o.length>0?S((()=>o(t?r:()=>{if(!S(n))throw`Stale read from <${"Show"}>.`;return e.when}))):o}return e.fallback}),void 0,void 0)}const G="_$DX_DELEGATE";function J(e,t,n){let r;const o=()=>{const t=document.createElement("template");return t.innerHTML=e,n?t.content.firstChild.firstChild:t.content.firstChild},i=t?()=>S((()=>document.importNode(r||(r=o()),!0))):()=>(r||(r=o())).cloneNode(!0);return i.cloneNode=i,i}function Y(e,t=window.document){const n=t[G]||(t[G]=new Set);for(let r=0,o=e.length;r<o;r++){const o=e[r];n.has(o)||(n.add(o),t.addEventListener(o,te))}}function Q(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function X(e,t,n){return S((()=>e(t,n)))}function ee(e,t,n,r){if(void 0===n||r||(r=[]),"function"!=typeof t)return ne(e,t,r,n);_((r=>ne(e,t(),r,n)),r)}function te(e){const t=`$$${e.type}`;let n=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==n&&Object.defineProperty(e,"target",{configurable:!0,value:n}),Object.defineProperty(e,"currentTarget",{configurable:!0,get:()=>n||document});n;){const r=n[t];if(r&&!n.disabled){const o=n[`${t}Data`];if(void 0!==o?r.call(n,o,e):r.call(n,e),e.cancelBubble)return}n=n._$host||n.parentNode||n.host}}function ne(e,t,n,r,o){for(;"function"==typeof n;)n=n();if(t===n)return n;const i=typeof t,s=void 0!==r;if(e=s&&n[0]&&n[0].parentNode||e,"string"===i||"number"===i){if("number"===i&&(t=t.toString())===n)return n;if(s){let o=n[0];o&&3===o.nodeType?o.data!==t&&(o.data=t):o=document.createTextNode(t),n=ie(e,n,r,o)}else n=""!==n&&"string"==typeof n?e.firstChild.data=t:e.textContent=t}else if(null==t||"boolean"===i)n=ie(e,n,r);else{if("function"===i)return _((()=>{let o=t();for(;"function"==typeof o;)o=o();n=ne(e,o,n,r)})),()=>n;if(Array.isArray(t)){const i=[],a=n&&Array.isArray(n);if(re(i,t,n,o))return _((()=>n=ne(e,i,n,r,!0))),()=>n;if(0===i.length){if(n=ie(e,n,r),s)return n}else a?0===n.length?oe(e,i,r):function(e,t,n){let r=n.length,o=t.length,i=r,s=0,a=0,l=t[o-1].nextSibling,c=null;for(;s<o||a<i;)if(t[s]!==n[a]){for(;t[o-1]===n[i-1];)o--,i--;if(o===s){const t=i<r?a?n[a-1].nextSibling:n[i-a]:l;for(;a<i;)e.insertBefore(n[a++],t)}else if(i===a)for(;s<o;)c&&c.has(t[s])||t[s].remove(),s++;else if(t[s]===n[i-1]&&n[a]===t[o-1]){const r=t[--o].nextSibling;e.insertBefore(n[a++],t[s++].nextSibling),e.insertBefore(n[--i],r),t[o]=n[i]}else{if(!c){c=new Map;let e=a;for(;e<i;)c.set(n[e],e++)}const r=c.get(t[s]);if(null!=r)if(a<r&&r<i){let l,u=s,f=1;for(;++u<o&&u<i&&null!=(l=c.get(t[u]))&&l===r+f;)f++;if(f>r-a){const o=t[s];for(;a<r;)e.insertBefore(n[a++],o)}else e.replaceChild(n[a++],t[s++])}else s++;else t[s++].remove()}}else s++,a++}(e,n,i):(n&&ie(e),oe(e,i));n=i}else if(t.nodeType){if(Array.isArray(n)){if(s)return n=ie(e,n,r,t);ie(e,n,null,t)}else null!=n&&""!==n&&e.firstChild?e.replaceChild(t,e.firstChild):e.appendChild(t);n=t}}return n}function re(e,t,n,r){let o=!1;for(let i=0,s=t.length;i<s;i++){let s,a=t[i],l=n&&n[e.length];if(null==a||!0===a||!1===a);else if("object"==(s=typeof a)&&a.nodeType)e.push(a);else if(Array.isArray(a))o=re(e,a,l)||o;else if("function"===s)if(r){for(;"function"==typeof a;)a=a();o=re(e,Array.isArray(a)?a:[a],Array.isArray(l)?l:[l])||o}else e.push(a),o=!0;else{const t=String(a);l&&3===l.nodeType&&l.data===t?e.push(l):e.push(document.createTextNode(t))}}return o}function oe(e,t,n=null){for(let r=0,o=t.length;r<o;r++)e.insertBefore(t[r],n)}function ie(e,t,n,r){if(void 0===n)return e.textContent="";const o=r||document.createTextNode("");if(t.length){let r=!1;for(let i=t.length-1;i>=0;i--){const s=t[i];if(o!==s){const t=s.parentNode===e;r||i?t&&s.remove():t?e.replaceChild(o,s):e.insertBefore(o,n)}else r=!0}}else e.insertBefore(o,n);return[o]}function se(e){return Object.keys(e).reduce(((t,n)=>{const r=e[n];var o;return t[n]=Object.assign({},r),ce(r.value)&&(o=r.value,"[object Function]"!==Object.prototype.toString.call(o))&&!Array.isArray(r.value)&&(t[n].value=Object.assign({},r.value)),Array.isArray(r.value)&&(t[n].value=r.value.slice(0)),t}),{})}function ae(e){if(e)try{return JSON.parse(e)}catch(t){return e}}function le(e,t,n,r){if(null==n||!1===n)return e.removeAttribute(t);let o=r?JSON.stringify(n):n;e.__updating[t]=!0,"true"===o&&(o=""),e.setAttribute(t,o),Promise.resolve().then((()=>delete e.__updating[t]))}function ce(e){return null!=e&&("object"==typeof e||"function"==typeof e)}let ue;function fe(e,t){const n=Object.keys(t);return class extends e{static get observedAttributes(){return n.map((e=>t[e].attribute))}constructor(){super(),this.__initialized=!1,this.__released=!1,this.__releaseCallbacks=[],this.__propertyChangedCallbacks=[],this.__updating={},this.props={}}connectedCallback(){if(this.__initialized)return;this.__releaseCallbacks=[],this.__propertyChangedCallbacks=[],this.__updating={},this.props=function(e,t){const n=se(t);return Object.keys(t).forEach((t=>{const r=n[t],o=e.getAttribute(r.attribute),i=e[t];o&&(r.value=r.parse?ae(o):o),null!=i&&(r.value=Array.isArray(i)?i.slice(0):i),r.reflect&&le(e,r.attribute,r.value,!!r.parse),Object.defineProperty(e,t,{get:()=>r.value,set(e){const n=r.value;r.value=e,r.reflect&&le(this,r.attribute,r.value,!!r.parse);for(let r=0,o=this.__propertyChangedCallbacks.length;r<o;r++)this.__propertyChangedCallbacks[r](t,e,n)},enumerable:!0,configurable:!0})})),n}(this,t);const e=function(e){return Object.keys(e).reduce(((t,n)=>(t[n]=e[n].value,t)),{})}(this.props),n=this.Component,r=ue;try{ue=this,this.__initialized=!0,"function"==typeof(o=n)&&0===o.toString().indexOf("class")?new n(e,{element:this}):n(e,{element:this})}finally{ue=r}var o}async disconnectedCallback(){if(await Promise.resolve(),this.isConnected)return;this.__propertyChangedCallbacks.length=0;let e=null;for(;e=this.__releaseCallbacks.pop();)e(this);delete this.__initialized,this.__released=!0}attributeChangedCallback(e,n,r){if(this.__initialized&&!this.__updating[e]&&(e=this.lookupProp(e))in t){if(null==r&&!this[e])return;this[e]=t[e].parse?ae(r):r}}lookupProp(e){if(t)return n.find((n=>e===n||e===t[n].attribute))}get renderRoot(){return this.shadowRoot||this.attachShadow({mode:"open"})}addReleaseCallback(e){this.__releaseCallbacks.push(e)}addPropertyChangedCallback(e){this.__propertyChangedCallbacks.push(e)}}}function de(e,t={},n={}){const{BaseElement:r=HTMLElement,extension:o}=n;return n=>{if(!e)throw new Error("tag is required to register a Component");let i=customElements.get(e);return i?(i.prototype.Component=n,i):(i=fe(r,function(e){return e?Object.keys(e).reduce(((t,n)=>{const r=e[n];return t[n]=ce(r)&&"value"in r?r:{value:r},t[n].attribute||(t[n].attribute=n.replace(/\.?([A-Z]+)/g,((e,t)=>"-"+t.toLowerCase())).replace("_","-").replace(/^-/,"")),t[n].parse="parse"in t[n]?t[n].parse:"string"!=typeof t[n].value,t}),{}):{}}(t)),i.prototype.Component=n,i.prototype.registeredTag=e,customElements.define(e,i,o),i)}}function he(e){return(t,n)=>{const{element:r}=n;return b((o=>{const i=function(e){const t=Object.keys(e),n={};for(let r=0;r<t.length;r++){const[o,i]=w(e[t[r]]);Object.defineProperty(n,t[r],{get:o,set(e){i((()=>e))}})}return n}(t);r.addPropertyChangedCallback(((e,t)=>i[e]=t)),r.addReleaseCallback((()=>{r.renderRoot.textContent="",o()}));const s=e(i,n);return ee(r.renderRoot,s)}),function(e){if(e.assignedSlot&&e.assignedSlot._$owner)return e.assignedSlot._$owner;let t=e.parentNode;for(;t&&!t._$owner&&(!t.assignedSlot||!t.assignedSlot._$owner);)t=t.parentNode;return t&&t.assignedSlot?t.assignedSlot._$owner:e._$owner}(r))}}const pe=e=>e instanceof Uint8Array,ge=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ye=(e,t)=>e<<32-t|e>>>t;
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const me=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function ve(e){if(!pe(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=me[e[n]];return t}function be(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const t=2*r,o=e.slice(t,t+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function we(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!pe(e))throw new Error("expected Uint8Array, got "+typeof e);return e}let ke=class{clone(){return this._cloneInto()}};function _e(e){const t=t=>e().update(we(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}var xe={};!function(e){function t(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function n(...e){const t=(e,t)=>n=>e(t(n));return{encode:Array.from(e).reverse().reduce(((e,n)=>e?t(e,n.encode):n.encode),void 0),decode:e.reduce(((e,n)=>e?t(e,n.decode):n.decode),void 0)}}function r(e){return{encode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("alphabet.encode input should be an array of numbers");return n.map((n=>{if(t(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]}))},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("alphabet.decode input should be array of strings");return t.map((t=>{if("string"!=typeof t)throw new Error(`alphabet.decode: not string element=${t}`);const n=e.indexOf(t);if(-1===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n}))}}}function o(e=""){if("string"!=typeof e)throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw new Error("join.decode input should be string");return t.split(e)}}}function i(e,n="="){if(t(e),"string"!=typeof n)throw new Error("padding chr should be string");return{encode(t){if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("padding.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`padding.encode: non-string input=${e}`);for(;t.length*e%8;)t.push(n);return t},decode(t){if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("padding.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`padding.decode: non-string input=${e}`);let r=t.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&t[r-1]===n;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return t.slice(0,r)}}}function s(e){if("function"!=typeof e)throw new Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function a(e,n,r){if(n<2)throw new Error(`convertRadix: wrong from=${n}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let o=0;const i=[],s=Array.from(e);for(s.forEach((e=>{if(t(e),e<0||e>=n)throw new Error(`Wrong integer: ${e}`)}));;){let e=0,t=!0;for(let i=o;i<s.length;i++){const a=s[i],l=n*e+a;if(!Number.isSafeInteger(l)||n*e/n!==e||l-a!=n*e)throw new Error("convertRadix: carry overflow");if(e=l%r,s[i]=Math.floor(l/r),!Number.isSafeInteger(s[i])||s[i]*r+e!==l)throw new Error("convertRadix: carry overflow");t&&(s[i]?t=!1:o=i)}if(i.push(e),t)break}for(let t=0;t<e.length-1&&0===e[t];t++)i.push(0);return i.reverse()}
/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */
Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=t;const l=(e,t)=>t?l(t,e%t):e,c=(e,t)=>e+(t-l(e,t));function u(e,n,r,o){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(n<=0||n>32)throw new Error(`convertRadix2: wrong from=${n}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(c(n,r)>32)throw new Error(`convertRadix2: carry overflow from=${n} to=${r} carryBits=${c(n,r)}`);let i=0,s=0;const a=2**r-1,l=[];for(const c of e){if(t(c),c>=2**n)throw new Error(`convertRadix2: invalid data word=${c} from=${n}`);if(i=i<<n|c,s+n>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${n}`);for(s+=n;s>=r;s-=r)l.push((i>>s-r&a)>>>0);i&=2**s-1}if(i=i<<r-s&a,!o&&s>=n)throw new Error("Excess padding");if(!o&&i)throw new Error(`Non-zero padding: ${i}`);return o&&s>0&&l.push(i>>>0),l}function f(e){return t(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return a(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(a(t,e,256))}}}function d(e,n=!1){if(t(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(c(8,e)>32||c(e,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return u(Array.from(t),8,e,!n)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(u(t,e,8,n))}}}function h(e){if("function"!=typeof e)throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(n){}}}function p(e,n){if(t(e),"function"!=typeof n)throw new Error("checksum fn should be function");return{encode(t){if(!(t instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const r=n(t).slice(0,e),o=new Uint8Array(t.length+e);return o.set(t),o.set(r,t.length),o},decode(t){if(!(t instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const r=t.slice(0,-e),o=n(r).slice(0,e),i=t.slice(-e);for(let n=0;n<e;n++)if(o[n]!==i[n])throw new Error("Invalid checksum");return r}}}e.utils={alphabet:r,chain:n,checksum:p,radix:f,radix2:d,join:o,padding:i},e.base16=n(d(4),r("0123456789ABCDEF"),o("")),e.base32=n(d(5),r("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),i(5),o("")),e.base32hex=n(d(5),r("0123456789ABCDEFGHIJKLMNOPQRSTUV"),i(5),o("")),e.base32crockford=n(d(5),r("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),o(""),s((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),e.base64=n(d(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),i(6),o("")),e.base64url=n(d(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),i(6),o(""));const g=e=>n(f(58),r(e),o(""));e.base58=g("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=g("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=g("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const y=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(t){let n="";for(let r=0;r<t.length;r+=8){const o=t.subarray(r,r+8);n+=e.base58.encode(o).padStart(y[o.length],"1")}return n},decode(t){let n=[];for(let r=0;r<t.length;r+=11){const o=t.slice(r,r+11),i=y.indexOf(o.length),s=e.base58.decode(o);for(let e=0;e<s.length-i;e++)if(0!==s[e])throw new Error("base58xmr: wrong padding");n=n.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(n)}};e.base58check=t=>n(p(4,(e=>t(t(e)))),e.base58);const m=n(r("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),o("")),v=[996825010,642813549,513874426,1027748829,705979059];function b(e){const t=e>>25;let n=(33554431&e)<<5;for(let r=0;r<v.length;r++)1==(t>>r&1)&&(n^=v[r]);return n}function w(e,t,n=1){const r=e.length;let o=1;for(let i=0;i<r;i++){const t=e.charCodeAt(i);if(t<33||t>126)throw new Error(`Invalid prefix (${e})`);o=b(o)^t>>5}o=b(o);for(let i=0;i<r;i++)o=b(o)^31&e.charCodeAt(i);for(let i of t)o=b(o)^i;for(let i=0;i<6;i++)o=b(o);return o^=n,m.encode(u([o%2**30],30,5,!1))}function k(e){const t="bech32"===e?1:734539939,n=d(5),r=n.decode,o=n.encode,i=h(r);function s(e,n=90){if("string"!=typeof e)throw new Error("bech32.decode input should be string, not "+typeof e);if(e.length<8||!1!==n&&e.length>n)throw new TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${n})`);const r=e.toLowerCase();if(e!==r&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const o=(e=r).lastIndexOf("1");if(0===o||-1===o)throw new Error('Letter "1" must be present between prefix and data only');const i=e.slice(0,o),s=e.slice(o+1);if(s.length<6)throw new Error("Data must be at least 6 characters long");const a=m.decode(s).slice(0,-6),l=w(i,a,t);if(!s.endsWith(l))throw new Error(`Invalid checksum in ${e}: expected "${l}"`);return{prefix:i,words:a}}return{encode:function(e,n,r=90){if("string"!=typeof e)throw new Error("bech32.encode prefix should be string, not "+typeof e);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const o=e.length+7+n.length;if(!1!==r&&o>r)throw new TypeError(`Length ${o} exceeds limit ${r}`);return`${e=e.toLowerCase()}1${m.encode(n)}${w(e,n,t)}`},decode:s,decodeToBytes:function(e){const{prefix:t,words:n}=s(e,!1);return{prefix:t,words:n,bytes:r(n)}},decodeUnsafe:h(s),fromWords:r,fromWordsUnsafe:i,toWords:o}}e.bech32=k("bech32"),e.bech32m=k("bech32m"),e.utf8={encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)},e.hex=n(d(4),r("0123456789abcdef"),o(""),s((e=>{if("string"!=typeof e||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})));const _={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},x=`Invalid encoding type. Available types: ${Object.keys(_).join(", ")}`;e.bytesToString=(e,t)=>{if("string"!=typeof e||!_.hasOwnProperty(e))throw new TypeError(x);if(!(t instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return _[e].encode(t)},e.str=e.bytesToString;e.stringToBytes=(e,t)=>{if(!_.hasOwnProperty(e))throw new TypeError(x);if("string"!=typeof t)throw new TypeError("stringToBytes() expects string");return _[e].decode(t)},e.bytes=e.stringToBytes}(xe);var Ee=new TextDecoder("utf-8");new TextEncoder;var Ae=5e3;function Ce(e){var t,n,r,o,i,s,a,l;let{prefix:c,words:u}=xe.bech32.decode(e,Ae),f=new Uint8Array(xe.bech32.fromWords(u));switch(c){case"nprofile":{let e=Se(f);if(!(null==(t=e[0])?void 0:t[0]))throw new Error("missing TLV 0 for nprofile");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:ve(e[0][0]),relays:e[1]?e[1].map((e=>Ee.decode(e))):[]}}}case"nevent":{let e=Se(f);if(!(null==(n=e[0])?void 0:n[0]))throw new Error("missing TLV 0 for nevent");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(e[2]&&32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(e[3]&&4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:ve(e[0][0]),relays:e[1]?e[1].map((e=>Ee.decode(e))):[],author:(null==(r=e[2])?void 0:r[0])?ve(e[2][0]):void 0,kind:(null==(o=e[3])?void 0:o[0])?parseInt(ve(e[3][0]),16):void 0}}}case"naddr":{let e=Se(f);if(!(null==(i=e[0])?void 0:i[0]))throw new Error("missing TLV 0 for naddr");if(!(null==(s=e[2])?void 0:s[0]))throw new Error("missing TLV 2 for naddr");if(32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!(null==(a=e[3])?void 0:a[0]))throw new Error("missing TLV 3 for naddr");if(4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ee.decode(e[0][0]),pubkey:ve(e[2][0]),kind:parseInt(ve(e[3][0]),16),relays:e[1]?e[1].map((e=>Ee.decode(e))):[]}}}case"nrelay":{let e=Se(f);if(!(null==(l=e[0])?void 0:l[0]))throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Ee.decode(e[0][0])}}case"nsec":return{type:c,data:f};case"npub":case"note":return{type:c,data:ve(f)};default:throw new Error(`unknown prefix ${c}`)}}function Se(e){let t={},n=e;for(;n.length>0;){let e=n[0],r=n[1],o=n.slice(2,2+r);if(n=n.slice(2+r),o.length<r)throw new Error(`not enough data to read on TLV ${e}`);t[e]=t[e]||[],t[e].push(o)}return t}function ze(e){return Be("npub",be(e))}function Ie(e){return Be("note",be(e))}function Be(e,t){return function(e,t){let n=xe.bech32.toWords(t);return xe.bech32.encode(e,n,Ae)}(e,t)}var Oe=1984,Le=9735,Me=9802,$e=1e4,Re=new TextDecoder("utf-8");new TextEncoder;var Pe=5e3;function Te(e){var t,n,r,o,i,s,a,l;let{prefix:c,words:u}=xe.bech32.decode(e,Pe),f=new Uint8Array(xe.bech32.fromWords(u));switch(c){case"nprofile":{let e=je(f);if(!(null==(t=e[0])?void 0:t[0]))throw new Error("missing TLV 0 for nprofile");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:ve(e[0][0]),relays:e[1]?e[1].map((e=>Re.decode(e))):[]}}}case"nevent":{let e=je(f);if(!(null==(n=e[0])?void 0:n[0]))throw new Error("missing TLV 0 for nevent");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(e[2]&&32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(e[3]&&4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:ve(e[0][0]),relays:e[1]?e[1].map((e=>Re.decode(e))):[],author:(null==(r=e[2])?void 0:r[0])?ve(e[2][0]):void 0,kind:(null==(o=e[3])?void 0:o[0])?parseInt(ve(e[3][0]),16):void 0}}}case"naddr":{let e=je(f);if(!(null==(i=e[0])?void 0:i[0]))throw new Error("missing TLV 0 for naddr");if(!(null==(s=e[2])?void 0:s[0]))throw new Error("missing TLV 2 for naddr");if(32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!(null==(a=e[3])?void 0:a[0]))throw new Error("missing TLV 3 for naddr");if(4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Re.decode(e[0][0]),pubkey:ve(e[2][0]),kind:parseInt(ve(e[3][0]),16),relays:e[1]?e[1].map((e=>Re.decode(e))):[]}}}case"nrelay":{let e=je(f);if(!(null==(l=e[0])?void 0:l[0]))throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Re.decode(e[0][0])}}case"nsec":return{type:c,data:f};case"npub":case"note":return{type:c,data:ve(f)};default:throw new Error(`unknown prefix ${c}`)}}function je(e){let t={},n=e;for(;n.length>0;){let e=n[0],r=n[1],o=n.slice(2,2+r);if(n=n.slice(2+r),o.length<r)throw new Error(`not enough data to read on TLV ${e}`);t[e]=t[e]||[],t[e].push(o)}return t}var Ne,qe=new RegExp(`nostr:(${/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/.source})`),Ue=()=>new RegExp(`\\b${qe.source}\\b`,"g");function De(e){return(Ne=Ne||document.createElement("textarea")).innerHTML="&"+e+";",Ne.value}var Fe=Object.prototype.hasOwnProperty;function He(e){return[].slice.call(arguments,1).forEach((function(t){if(t){if("object"!=typeof t)throw new TypeError(t+"must be object");Object.keys(t).forEach((function(n){e[n]=t[n]}))}})),e}var Ve=/\\([\\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function Ke(e){return e.indexOf("\\")<0?e:e.replace(Ve,"$1")}function We(e){return!(e>=55296&&e<=57343)&&(!(e>=64976&&e<=65007)&&(!!(65535&~e&&65534!=(65535&e))&&(!(e>=0&&e<=8)&&(11!==e&&(!(e>=14&&e<=31)&&(!(e>=127&&e<=159)&&!(e>1114111)))))))}function Ze(e){if(e>65535){var t=55296+((e-=65536)>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}var Ge=/&([a-z#][a-z0-9]{1,31});/gi,Je=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i;function Ye(e,t){var n=0,r=De(t);return t!==r?r:35===t.charCodeAt(0)&&Je.test(t)&&We(n="x"===t[1].toLowerCase()?parseInt(t.slice(2),16):parseInt(t.slice(1),10))?Ze(n):e}function Qe(e){return e.indexOf("&")<0?e:e.replace(Ge,Ye)}var Xe=/[&<>"]/,et=/[&<>"]/g,tt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function nt(e){return tt[e]}function rt(e){return Xe.test(e)?e.replace(et,nt):e}var ot={};function it(e,t){return++t>=e.length-2?t:"paragraph_open"===e[t].type&&e[t].tight&&"inline"===e[t+1].type&&0===e[t+1].content.length&&"paragraph_close"===e[t+2].type&&e[t+2].tight?it(e,t+2):t}ot.blockquote_open=function(){return"<blockquote>\n"},ot.blockquote_close=function(e,t){return"</blockquote>"+st(e,t)},ot.code=function(e,t){return e[t].block?"<pre><code>"+rt(e[t].content)+"</code></pre>"+st(e,t):"<code>"+rt(e[t].content)+"</code>"},ot.fence=function(e,t,n,r,o){var i,s,a,l,c=e[t],u="",f=n.langPrefix;if(c.params){if(s=(i=c.params.split(/\s+/g)).join(" "),a=o.rules.fence_custom,l=i[0],a&&Fe.call(a,l))return o.rules.fence_custom[i[0]](e,t,n,r,o);u=' class="'+f+rt(Qe(Ke(s)))+'"'}return"<pre><code"+u+">"+(n.highlight&&n.highlight.apply(n.highlight,[c.content].concat(i))||rt(c.content))+"</code></pre>"+st(e,t)},ot.fence_custom={},ot.heading_open=function(e,t){return"<h"+e[t].hLevel+">"},ot.heading_close=function(e,t){return"</h"+e[t].hLevel+">\n"},ot.hr=function(e,t,n){return(n.xhtmlOut?"<hr />":"<hr>")+st(e,t)},ot.bullet_list_open=function(){return"<ul>\n"},ot.bullet_list_close=function(e,t){return"</ul>"+st(e,t)},ot.list_item_open=function(){return"<li>"},ot.list_item_close=function(){return"</li>\n"},ot.ordered_list_open=function(e,t){var n=e[t];return"<ol"+(n.order>1?' start="'+n.order+'"':"")+">\n"},ot.ordered_list_close=function(e,t){return"</ol>"+st(e,t)},ot.paragraph_open=function(e,t){return e[t].tight?"":"<p>"},ot.paragraph_close=function(e,t){var n=!(e[t].tight&&t&&"inline"===e[t-1].type&&!e[t-1].content);return(e[t].tight?"":"</p>")+(n?st(e,t):"")},ot.link_open=function(e,t,n){var r=e[t].title?' title="'+rt(Qe(e[t].title))+'"':"",o=n.linkTarget?' target="'+n.linkTarget+'"':"";return'<a href="'+rt(e[t].href)+'"'+r+o+">"},ot.link_close=function(){return"</a>"},ot.image=function(e,t,n){var r=' src="'+rt(e[t].src)+'"',o=e[t].title?' title="'+rt(Qe(e[t].title))+'"':"";return"<img"+r+(' alt="'+(e[t].alt?rt(Qe(Ke(e[t].alt))):"")+'"')+o+(n.xhtmlOut?" /":"")+">"},ot.table_open=function(){return"<table>\n"},ot.table_close=function(){return"</table>\n"},ot.thead_open=function(){return"<thead>\n"},ot.thead_close=function(){return"</thead>\n"},ot.tbody_open=function(){return"<tbody>\n"},ot.tbody_close=function(){return"</tbody>\n"},ot.tr_open=function(){return"<tr>"},ot.tr_close=function(){return"</tr>\n"},ot.th_open=function(e,t){var n=e[t];return"<th"+(n.align?' style="text-align:'+n.align+'"':"")+">"},ot.th_close=function(){return"</th>"},ot.td_open=function(e,t){var n=e[t];return"<td"+(n.align?' style="text-align:'+n.align+'"':"")+">"},ot.td_close=function(){return"</td>"},ot.strong_open=function(){return"<strong>"},ot.strong_close=function(){return"</strong>"},ot.em_open=function(){return"<em>"},ot.em_close=function(){return"</em>"},ot.del_open=function(){return"<del>"},ot.del_close=function(){return"</del>"},ot.ins_open=function(){return"<ins>"},ot.ins_close=function(){return"</ins>"},ot.mark_open=function(){return"<mark>"},ot.mark_close=function(){return"</mark>"},ot.sub=function(e,t){return"<sub>"+rt(e[t].content)+"</sub>"},ot.sup=function(e,t){return"<sup>"+rt(e[t].content)+"</sup>"},ot.hardbreak=function(e,t,n){return n.xhtmlOut?"<br />\n":"<br>\n"},ot.softbreak=function(e,t,n){return n.breaks?n.xhtmlOut?"<br />\n":"<br>\n":"\n"},ot.text=function(e,t){return rt(e[t].content)},ot.htmlblock=function(e,t){return e[t].content},ot.htmltag=function(e,t){return e[t].content},ot.abbr_open=function(e,t){return'<abbr title="'+rt(Qe(e[t].title))+'">'},ot.abbr_close=function(){return"</abbr>"},ot.footnote_ref=function(e,t){var n=Number(e[t].id+1).toString(),r="fnref"+n;return e[t].subId>0&&(r+=":"+e[t].subId),'<sup class="footnote-ref"><a href="#fn'+n+'" id="'+r+'">['+n+"]</a></sup>"},ot.footnote_block_open=function(e,t,n){return(n.xhtmlOut?'<hr class="footnotes-sep" />\n':'<hr class="footnotes-sep">\n')+'<section class="footnotes">\n<ol class="footnotes-list">\n'},ot.footnote_block_close=function(){return"</ol>\n</section>\n"},ot.footnote_open=function(e,t){return'<li id="fn'+Number(e[t].id+1).toString()+'"  class="footnote-item">'},ot.footnote_close=function(){return"</li>\n"},ot.footnote_anchor=function(e,t){var n="fnref"+Number(e[t].id+1).toString();return e[t].subId>0&&(n+=":"+e[t].subId),' <a href="#'+n+'" class="footnote-backref">↩</a>'},ot.dl_open=function(){return"<dl>\n"},ot.dt_open=function(){return"<dt>"},ot.dd_open=function(){return"<dd>"},ot.dl_close=function(){return"</dl>\n"},ot.dt_close=function(){return"</dt>\n"},ot.dd_close=function(){return"</dd>\n"};var st=ot.getBreak=function(e,t){return(t=it(e,t))<e.length&&"list_item_close"===e[t].type?"":"\n"};function at(){this.rules=He({},ot),this.getBreak=ot.getBreak}function lt(){this.__rules__=[],this.__cache__=null}function ct(e,t,n,r,o){this.src=e,this.env=r,this.options=n,this.parser=t,this.tokens=o,this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache=[],this.isInLabel=!1,this.linkLevel=0,this.linkContent="",this.labelUnmatchedScopes=0}function ut(e,t){var n,r,o,i=-1,s=e.posMax,a=e.pos,l=e.isInLabel;if(e.isInLabel)return-1;if(e.labelUnmatchedScopes)return e.labelUnmatchedScopes--,-1;for(e.pos=t+1,e.isInLabel=!0,n=1;e.pos<s;){if(91===(o=e.src.charCodeAt(e.pos)))n++;else if(93===o&&0===--n){r=!0;break}e.parser.skipToken(e)}return r?(i=e.pos,e.labelUnmatchedScopes=0):e.labelUnmatchedScopes=n-1,e.pos=a,e.isInLabel=l,i}function ft(e,t,n,r){var o,i,s,a,l,c;if(42!==e.charCodeAt(0))return-1;if(91!==e.charCodeAt(1))return-1;if(-1===e.indexOf("]:"))return-1;if((i=ut(o=new ct(e,t,n,r,[]),1))<0||58!==e.charCodeAt(i+1))return-1;for(a=o.posMax,s=i+2;s<a&&10!==o.src.charCodeAt(s);s++);return l=e.slice(2,i),0===(c=e.slice(i+2,s).trim()).length?-1:(r.abbreviations||(r.abbreviations={}),void 0===r.abbreviations[":"+l]&&(r.abbreviations[":"+l]=c),s)}function dt(e){var t=Qe(e);try{t=decodeURI(t)}catch(n){}return encodeURI(t)}function ht(e,t){var n,r,o,i=t,s=e.posMax;if(60===e.src.charCodeAt(t)){for(t++;t<s;){if(10===(n=e.src.charCodeAt(t)))return!1;if(62===n)return o=dt(Ke(e.src.slice(i+1,t))),!!e.parser.validateLink(o)&&(e.pos=t+1,e.linkContent=o,!0);92===n&&t+1<s?t+=2:t++}return!1}for(r=0;t<s&&32!==(n=e.src.charCodeAt(t))&&!(n<32||127===n);)if(92===n&&t+1<s)t+=2;else{if(40===n&&++r>1)break;if(41===n&&--r<0)break;t++}return i!==t&&(o=Ke(e.src.slice(i,t)),!!e.parser.validateLink(o)&&(e.linkContent=o,e.pos=t,!0))}function pt(e,t){var n,r=t,o=e.posMax,i=e.src.charCodeAt(t);if(34!==i&&39!==i&&40!==i)return!1;for(t++,40===i&&(i=41);t<o;){if((n=e.src.charCodeAt(t))===i)return e.pos=t+1,e.linkContent=Ke(e.src.slice(r+1,t)),!0;92===n&&t+1<o?t+=2:t++}return!1}function gt(e){return e.trim().replace(/\s+/g," ").toUpperCase()}function yt(e,t,n,r){var o,i,s,a,l,c,u,f,d;if(91!==e.charCodeAt(0))return-1;if(-1===e.indexOf("]:"))return-1;if((i=ut(o=new ct(e,t,n,r,[]),0))<0||58!==e.charCodeAt(i+1))return-1;for(a=o.posMax,s=i+2;s<a&&(32===(l=o.src.charCodeAt(s))||10===l);s++);if(!ht(o,s))return-1;for(u=o.linkContent,c=s=o.pos,s+=1;s<a&&(32===(l=o.src.charCodeAt(s))||10===l);s++);for(s<a&&c!==s&&pt(o,s)?(f=o.linkContent,s=o.pos):(f="",s=c);s<a&&32===o.src.charCodeAt(s);)s++;return s<a&&10!==o.src.charCodeAt(s)?-1:(d=gt(e.slice(1,i)),void 0===r.references[d]&&(r.references[d]={title:f,href:u}),s)}at.prototype.renderInline=function(e,t,n){for(var r=this.rules,o=e.length,i=0,s="";o--;)s+=r[e[i].type](e,i++,t,n,this);return s},at.prototype.render=function(e,t,n){for(var r=this.rules,o=e.length,i=-1,s="";++i<o;)"inline"===e[i].type?s+=this.renderInline(e[i].children,t,n):s+=r[e[i].type](e,i,t,n,this);return s},lt.prototype.__find__=function(e){for(var t=this.__rules__.length,n=-1;t--;)if(this.__rules__[++n].name===e)return n;return-1},lt.prototype.__compile__=function(){var e=this,t=[""];e.__rules__.forEach((function(e){e.enabled&&e.alt.forEach((function(e){t.indexOf(e)<0&&t.push(e)}))})),e.__cache__={},t.forEach((function(t){e.__cache__[t]=[],e.__rules__.forEach((function(n){n.enabled&&(t&&n.alt.indexOf(t)<0||e.__cache__[t].push(n.fn))}))}))},lt.prototype.at=function(e,t,n){var r=this.__find__(e),o=n||{};if(-1===r)throw new Error("Parser rule not found: "+e);this.__rules__[r].fn=t,this.__rules__[r].alt=o.alt||[],this.__cache__=null},lt.prototype.before=function(e,t,n,r){var o=this.__find__(e),i=r||{};if(-1===o)throw new Error("Parser rule not found: "+e);this.__rules__.splice(o,0,{name:t,enabled:!0,fn:n,alt:i.alt||[]}),this.__cache__=null},lt.prototype.after=function(e,t,n,r){var o=this.__find__(e),i=r||{};if(-1===o)throw new Error("Parser rule not found: "+e);this.__rules__.splice(o+1,0,{name:t,enabled:!0,fn:n,alt:i.alt||[]}),this.__cache__=null},lt.prototype.push=function(e,t,n){var r=n||{};this.__rules__.push({name:e,enabled:!0,fn:t,alt:r.alt||[]}),this.__cache__=null},lt.prototype.enable=function(e,t){e=Array.isArray(e)?e:[e],t&&this.__rules__.forEach((function(e){e.enabled=!1})),e.forEach((function(e){var t=this.__find__(e);if(t<0)throw new Error("Rules manager: invalid rule name "+e);this.__rules__[t].enabled=!0}),this),this.__cache__=null},lt.prototype.disable=function(e){(e=Array.isArray(e)?e:[e]).forEach((function(e){var t=this.__find__(e);if(t<0)throw new Error("Rules manager: invalid rule name "+e);this.__rules__[t].enabled=!1}),this),this.__cache__=null},lt.prototype.getRules=function(e){return null===this.__cache__&&this.__compile__(),this.__cache__[e]||[]},ct.prototype.pushPending=function(){this.tokens.push({type:"text",content:this.pending,level:this.pendingLevel}),this.pending=""},ct.prototype.push=function(e){this.pending&&this.pushPending(),this.tokens.push(e),this.pendingLevel=this.level},ct.prototype.cacheSet=function(e,t){for(var n=this.cache.length;n<=e;n++)this.cache.push(0);this.cache[e]=t},ct.prototype.cacheGet=function(e){return e<this.cache.length?this.cache[e]:0};var mt=" \n()[]'\".,!?-";function vt(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1")}var bt=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,wt=/\((c|tm|r|p)\)/gi,kt={c:"©",r:"®",p:"§",tm:"™"};var _t=/['"]/,xt=/['"]/g,Et=/[-\s()\[\]]/;function At(e,t){return!(t<0||t>=e.length)&&!Et.test(e[t])}function Ct(e,t,n){return e.substr(0,t)+n+e.substr(t+1)}var St=[["block",function(e){e.inlineMode?e.tokens.push({type:"inline",content:e.src.replace(/\n/g," ").trim(),level:0,lines:[0,1],children:[]}):e.block.parse(e.src,e.options,e.env,e.tokens)}],["abbr",function(e){var t,n,r,o,i=e.tokens;if(!e.inlineMode)for(t=1,n=i.length-1;t<n;t++)if("paragraph_open"===i[t-1].type&&"inline"===i[t].type&&"paragraph_close"===i[t+1].type){for(r=i[t].content;r.length&&!((o=ft(r,e.inline,e.options,e.env))<0);)r=r.slice(o).trim();i[t].content=r,r.length||(i[t-1].tight=!0,i[t+1].tight=!0)}}],["references",function(e){var t,n,r,o,i=e.tokens;if(e.env.references=e.env.references||{},!e.inlineMode)for(t=1,n=i.length-1;t<n;t++)if("inline"===i[t].type&&"paragraph_open"===i[t-1].type&&"paragraph_close"===i[t+1].type){for(r=i[t].content;r.length&&!((o=yt(r,e.inline,e.options,e.env))<0);)r=r.slice(o).trim();i[t].content=r,r.length||(i[t-1].tight=!0,i[t+1].tight=!0)}}],["inline",function(e){var t,n,r,o=e.tokens;for(n=0,r=o.length;n<r;n++)"inline"===(t=o[n]).type&&e.inline.parse(t.content,e.options,e.env,t.children)}],["footnote_tail",function(e){var t,n,r,o,i,s,a,l,c,u=0,f=!1,d={};if(e.env.footnotes&&(e.tokens=e.tokens.filter((function(e){return"footnote_reference_open"===e.type?(f=!0,l=[],c=e.label,!1):"footnote_reference_close"===e.type?(f=!1,d[":"+c]=l,!1):(f&&l.push(e),!f)})),e.env.footnotes.list)){for(s=e.env.footnotes.list,e.tokens.push({type:"footnote_block_open",level:u++}),t=0,n=s.length;t<n;t++){for(e.tokens.push({type:"footnote_open",id:t,level:u++}),s[t].tokens?((a=[]).push({type:"paragraph_open",tight:!1,level:u++}),a.push({type:"inline",content:"",level:u,children:s[t].tokens}),a.push({type:"paragraph_close",tight:!1,level:--u})):s[t].label&&(a=d[":"+s[t].label]),e.tokens=e.tokens.concat(a),i="paragraph_close"===e.tokens[e.tokens.length-1].type?e.tokens.pop():null,o=s[t].count>0?s[t].count:1,r=0;r<o;r++)e.tokens.push({type:"footnote_anchor",id:t,subId:r,level:u});i&&e.tokens.push(i),e.tokens.push({type:"footnote_close",level:--u})}e.tokens.push({type:"footnote_block_close",level:--u})}}],["abbr2",function(e){var t,n,r,o,i,s,a,l,c,u,f,d,h=e.tokens;if(e.env.abbreviations)for(e.env.abbrRegExp||(d="(^|["+mt.split("").map(vt).join("")+"])("+Object.keys(e.env.abbreviations).map((function(e){return e.substr(1)})).sort((function(e,t){return t.length-e.length})).map(vt).join("|")+")($|["+mt.split("").map(vt).join("")+"])",e.env.abbrRegExp=new RegExp(d,"g")),u=e.env.abbrRegExp,n=0,r=h.length;n<r;n++)if("inline"===h[n].type)for(t=(o=h[n].children).length-1;t>=0;t--)if("text"===(i=o[t]).type){for(l=0,s=i.content,u.lastIndex=0,c=i.level,a=[];f=u.exec(s);)u.lastIndex>l&&a.push({type:"text",content:s.slice(l,f.index+f[1].length),level:c}),a.push({type:"abbr_open",title:e.env.abbreviations[":"+f[2]],level:c++}),a.push({type:"text",content:f[2],level:c}),a.push({type:"abbr_close",level:--c}),l=u.lastIndex-f[3].length;a.length&&(l<s.length&&a.push({type:"text",content:s.slice(l),level:c}),h[n].children=o=[].concat(o.slice(0,t),a,o.slice(t+1)))}}],["replacements",function(e){var t,n,r,o,i,s;if(e.options.typographer)for(i=e.tokens.length-1;i>=0;i--)if("inline"===e.tokens[i].type)for(t=(o=e.tokens[i].children).length-1;t>=0;t--)"text"===(n=o[t]).type&&(r=n.content,r=(s=r).indexOf("(")<0?s:s.replace(wt,(function(e,t){return kt[t.toLowerCase()]})),bt.test(r)&&(r=r.replace(/\+-/g,"±").replace(/\.{2,}/g,"…").replace(/([?!])…/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---([^-]|$)/gm,"$1—$2").replace(/(^|\s)--(\s|$)/gm,"$1–$2").replace(/(^|[^-\s])--([^-\s]|$)/gm,"$1–$2")),n.content=r)}],["smartquotes",function(e){var t,n,r,o,i,s,a,l,c,u,f,d,h,p,g,y,m;if(e.options.typographer)for(m=[],g=e.tokens.length-1;g>=0;g--)if("inline"===e.tokens[g].type)for(y=e.tokens[g].children,m.length=0,t=0;t<y.length;t++)if("text"===(n=y[t]).type&&!_t.test(n.text)){for(a=y[t].level,h=m.length-1;h>=0&&!(m[h].level<=a);h--);m.length=h+1,i=0,s=(r=n.content).length;e:for(;i<s&&(xt.lastIndex=i,o=xt.exec(r));)if(l=!At(r,o.index-1),i=o.index+1,p="'"===o[0],(c=!At(r,i))||l){if(f=!c,d=!l)for(h=m.length-1;h>=0&&(u=m[h],!(m[h].level<a));h--)if(u.single===p&&m[h].level===a){u=m[h],p?(y[u.token].content=Ct(y[u.token].content,u.pos,e.options.quotes[2]),n.content=Ct(n.content,o.index,e.options.quotes[3])):(y[u.token].content=Ct(y[u.token].content,u.pos,e.options.quotes[0]),n.content=Ct(n.content,o.index,e.options.quotes[1])),m.length=h;continue e}f?m.push({token:t,pos:o.index,single:p,level:a}):d&&p&&(n.content=Ct(n.content,o.index,"’"))}else p&&(n.content=Ct(n.content,o.index,"’"))}}]];function zt(){this.options={},this.ruler=new lt;for(var e=0;e<St.length;e++)this.ruler.push(St[e][0],St[e][1])}function It(e,t,n,r,o){var i,s,a,l,c,u,f;for(this.src=e,this.parser=t,this.options=n,this.env=r,this.tokens=o,this.bMarks=[],this.eMarks=[],this.tShift=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.parentType="root",this.ddIndent=-1,this.level=0,this.result="",u=0,f=!1,a=l=u=0,c=(s=this.src).length;l<c;l++){if(i=s.charCodeAt(l),!f){if(32===i){u++;continue}f=!0}10!==i&&l!==c-1||(10!==i&&l++,this.bMarks.push(a),this.eMarks.push(l),this.tShift.push(u),f=!1,u=0,a=l+1)}this.bMarks.push(s.length),this.eMarks.push(s.length),this.tShift.push(0),this.lineMax=this.bMarks.length-1}function Bt(e,t){var n,r,o;return(r=e.bMarks[t]+e.tShift[t])>=(o=e.eMarks[t])||42!==(n=e.src.charCodeAt(r++))&&45!==n&&43!==n||r<o&&32!==e.src.charCodeAt(r)?-1:r}function Ot(e,t){var n,r=e.bMarks[t]+e.tShift[t],o=e.eMarks[t];if(r+1>=o)return-1;if((n=e.src.charCodeAt(r++))<48||n>57)return-1;for(;;){if(r>=o)return-1;if(!((n=e.src.charCodeAt(r++))>=48&&n<=57)){if(41===n||46===n)break;return-1}}return r<o&&32!==e.src.charCodeAt(r)?-1:r}zt.prototype.process=function(e){var t,n,r;for(t=0,n=(r=this.ruler.getRules("")).length;t<n;t++)r[t](e)},It.prototype.isEmpty=function(e){return this.bMarks[e]+this.tShift[e]>=this.eMarks[e]},It.prototype.skipEmptyLines=function(e){for(var t=this.lineMax;e<t&&!(this.bMarks[e]+this.tShift[e]<this.eMarks[e]);e++);return e},It.prototype.skipSpaces=function(e){for(var t=this.src.length;e<t&&32===this.src.charCodeAt(e);e++);return e},It.prototype.skipChars=function(e,t){for(var n=this.src.length;e<n&&this.src.charCodeAt(e)===t;e++);return e},It.prototype.skipCharsBack=function(e,t,n){if(e<=n)return e;for(;e>n;)if(t!==this.src.charCodeAt(--e))return e+1;return e},It.prototype.getLines=function(e,t,n,r){var o,i,s,a,l,c=e;if(e>=t)return"";if(c+1===t)return i=this.bMarks[c]+Math.min(this.tShift[c],n),s=r?this.eMarks[c]+1:this.eMarks[c],this.src.slice(i,s);for(a=new Array(t-e),o=0;c<t;c++,o++)(l=this.tShift[c])>n&&(l=n),l<0&&(l=0),i=this.bMarks[c]+l,s=c+1<t||r?this.eMarks[c]+1:this.eMarks[c],a[o]=this.src.slice(i,s);return a.join("")};var Lt={};["article","aside","button","blockquote","body","canvas","caption","col","colgroup","dd","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","li","map","object","ol","output","p","pre","progress","script","section","style","table","tbody","td","textarea","tfoot","th","tr","thead","ul","video"].forEach((function(e){Lt[e]=!0}));var Mt=/^<([a-zA-Z]{1,15})[\s\/>]/,$t=/^<\/([a-zA-Z]{1,15})[\s>]/;function Rt(e,t){var n=e.bMarks[t]+e.blkIndent,r=e.eMarks[t];return e.src.substr(n,r-n)}function Pt(e,t){var n,r,o=e.bMarks[t]+e.tShift[t],i=e.eMarks[t];return o>=i||126!==(r=e.src.charCodeAt(o++))&&58!==r||o===(n=e.skipSpaces(o))||n>=i?-1:n}var Tt=[["code",function(e,t,n){var r,o;if(e.tShift[t]-e.blkIndent<4)return!1;for(o=r=t+1;r<n;)if(e.isEmpty(r))r++;else{if(!(e.tShift[r]-e.blkIndent>=4))break;o=++r}return e.line=r,e.tokens.push({type:"code",content:e.getLines(t,o,4+e.blkIndent,!0),block:!0,lines:[t,e.line],level:e.level}),!0}],["fences",function(e,t,n,r){var o,i,s,a,l,c=!1,u=e.bMarks[t]+e.tShift[t],f=e.eMarks[t];if(u+3>f)return!1;if(126!==(o=e.src.charCodeAt(u))&&96!==o)return!1;if(l=u,(i=(u=e.skipChars(u,o))-l)<3)return!1;if((s=e.src.slice(u,f).trim()).indexOf("`")>=0)return!1;if(r)return!0;for(a=t;!(++a>=n)&&!((u=l=e.bMarks[a]+e.tShift[a])<(f=e.eMarks[a])&&e.tShift[a]<e.blkIndent);)if(e.src.charCodeAt(u)===o&&!(e.tShift[a]-e.blkIndent>=4||(u=e.skipChars(u,o))-l<i||(u=e.skipSpaces(u))<f)){c=!0;break}return i=e.tShift[t],e.line=a+(c?1:0),e.tokens.push({type:"fence",params:s,content:e.getLines(t+1,a,i,!0),lines:[t,e.line],level:e.level}),!0},["paragraph","blockquote","list"]],["blockquote",function(e,t,n,r){var o,i,s,a,l,c,u,f,d,h,p,g=e.bMarks[t]+e.tShift[t],y=e.eMarks[t];if(g>y)return!1;if(62!==e.src.charCodeAt(g++))return!1;if(e.level>=e.options.maxNesting)return!1;if(r)return!0;for(32===e.src.charCodeAt(g)&&g++,l=e.blkIndent,e.blkIndent=0,a=[e.bMarks[t]],e.bMarks[t]=g,i=(g=g<y?e.skipSpaces(g):g)>=y,s=[e.tShift[t]],e.tShift[t]=g-e.bMarks[t],f=e.parser.ruler.getRules("blockquote"),o=t+1;o<n&&!((g=e.bMarks[o]+e.tShift[o])>=(y=e.eMarks[o]));o++)if(62!==e.src.charCodeAt(g++)){if(i)break;for(p=!1,d=0,h=f.length;d<h;d++)if(f[d](e,o,n,!0)){p=!0;break}if(p)break;a.push(e.bMarks[o]),s.push(e.tShift[o]),e.tShift[o]=-1337}else 32===e.src.charCodeAt(g)&&g++,a.push(e.bMarks[o]),e.bMarks[o]=g,i=(g=g<y?e.skipSpaces(g):g)>=y,s.push(e.tShift[o]),e.tShift[o]=g-e.bMarks[o];for(c=e.parentType,e.parentType="blockquote",e.tokens.push({type:"blockquote_open",lines:u=[t,0],level:e.level++}),e.parser.tokenize(e,t,o),e.tokens.push({type:"blockquote_close",level:--e.level}),e.parentType=c,u[1]=e.line,d=0;d<s.length;d++)e.bMarks[d+t]=a[d],e.tShift[d+t]=s[d];return e.blkIndent=l,!0},["paragraph","blockquote","list"]],["hr",function(e,t,n,r){var o,i,s,a=e.bMarks[t],l=e.eMarks[t];if((a+=e.tShift[t])>l)return!1;if(42!==(o=e.src.charCodeAt(a++))&&45!==o&&95!==o)return!1;for(i=1;a<l;){if((s=e.src.charCodeAt(a++))!==o&&32!==s)return!1;s===o&&i++}return!(i<3)&&(r||(e.line=t+1,e.tokens.push({type:"hr",lines:[t,e.line],level:e.level})),!0)},["paragraph","blockquote","list"]],["list",function(e,t,n,r){var o,i,s,a,l,c,u,f,d,h,p,g,y,m,v,b,w,k,_,x,E,A=!0;if((f=Ot(e,t))>=0)g=!0;else{if(!((f=Bt(e,t))>=0))return!1;g=!1}if(e.level>=e.options.maxNesting)return!1;if(p=e.src.charCodeAt(f-1),r)return!0;for(m=e.tokens.length,g?(u=e.bMarks[t]+e.tShift[t],h=Number(e.src.substr(u,f-u-1)),e.tokens.push({type:"ordered_list_open",order:h,lines:b=[t,0],level:e.level++})):e.tokens.push({type:"bullet_list_open",lines:b=[t,0],level:e.level++}),o=t,v=!1,k=e.parser.ruler.getRules("list");!(!(o<n)||((d=(y=e.skipSpaces(f))>=e.eMarks[o]?1:y-f)>4&&(d=1),d<1&&(d=1),i=f-e.bMarks[o]+d,e.tokens.push({type:"list_item_open",lines:w=[t,0],level:e.level++}),a=e.blkIndent,l=e.tight,s=e.tShift[t],c=e.parentType,e.tShift[t]=y-e.bMarks[t],e.blkIndent=i,e.tight=!0,e.parentType="list",e.parser.tokenize(e,t,n,!0),e.tight&&!v||(A=!1),v=e.line-t>1&&e.isEmpty(e.line-1),e.blkIndent=a,e.tShift[t]=s,e.tight=l,e.parentType=c,e.tokens.push({type:"list_item_close",level:--e.level}),o=t=e.line,w[1]=o,y=e.bMarks[t],o>=n)||e.isEmpty(o)||e.tShift[o]<e.blkIndent);){for(E=!1,_=0,x=k.length;_<x;_++)if(k[_](e,o,n,!0)){E=!0;break}if(E)break;if(g){if((f=Ot(e,o))<0)break}else if((f=Bt(e,o))<0)break;if(p!==e.src.charCodeAt(f-1))break}return e.tokens.push({type:g?"ordered_list_close":"bullet_list_close",level:--e.level}),b[1]=o,e.line=o,A&&function(e,t){var n,r,o=e.level+2;for(n=t+2,r=e.tokens.length-2;n<r;n++)e.tokens[n].level===o&&"paragraph_open"===e.tokens[n].type&&(e.tokens[n+2].tight=!0,e.tokens[n].tight=!0,n+=2)}(e,m),!0},["paragraph","blockquote"]],["footnote",function(e,t,n,r){var o,i,s,a,l,c=e.bMarks[t]+e.tShift[t],u=e.eMarks[t];if(c+4>u)return!1;if(91!==e.src.charCodeAt(c))return!1;if(94!==e.src.charCodeAt(c+1))return!1;if(e.level>=e.options.maxNesting)return!1;for(a=c+2;a<u;a++){if(32===e.src.charCodeAt(a))return!1;if(93===e.src.charCodeAt(a))break}return a!==c+2&&(!(a+1>=u||58!==e.src.charCodeAt(++a))&&(r||(a++,e.env.footnotes||(e.env.footnotes={}),e.env.footnotes.refs||(e.env.footnotes.refs={}),l=e.src.slice(c+2,a-2),e.env.footnotes.refs[":"+l]=-1,e.tokens.push({type:"footnote_reference_open",label:l,level:e.level++}),o=e.bMarks[t],i=e.tShift[t],s=e.parentType,e.tShift[t]=e.skipSpaces(a)-a,e.bMarks[t]=a,e.blkIndent+=4,e.parentType="footnote",e.tShift[t]<e.blkIndent&&(e.tShift[t]+=e.blkIndent,e.bMarks[t]-=e.blkIndent),e.parser.tokenize(e,t,n,!0),e.parentType=s,e.blkIndent-=4,e.tShift[t]=i,e.bMarks[t]=o,e.tokens.push({type:"footnote_reference_close",level:--e.level})),!0))},["paragraph"]],["heading",function(e,t,n,r){var o,i,s,a=e.bMarks[t]+e.tShift[t],l=e.eMarks[t];if(a>=l)return!1;if(35!==(o=e.src.charCodeAt(a))||a>=l)return!1;for(i=1,o=e.src.charCodeAt(++a);35===o&&a<l&&i<=6;)i++,o=e.src.charCodeAt(++a);return!(i>6||a<l&&32!==o)&&(r||(l=e.skipCharsBack(l,32,a),(s=e.skipCharsBack(l,35,a))>a&&32===e.src.charCodeAt(s-1)&&(l=s),e.line=t+1,e.tokens.push({type:"heading_open",hLevel:i,lines:[t,e.line],level:e.level}),a<l&&e.tokens.push({type:"inline",content:e.src.slice(a,l).trim(),level:e.level+1,lines:[t,e.line],children:[]}),e.tokens.push({type:"heading_close",hLevel:i,level:e.level})),!0)},["paragraph","blockquote"]],["lheading",function(e,t,n){var r,o,i,s=t+1;return!(s>=n)&&(!(e.tShift[s]<e.blkIndent)&&(!(e.tShift[s]-e.blkIndent>3)&&(!((o=e.bMarks[s]+e.tShift[s])>=(i=e.eMarks[s]))&&((45===(r=e.src.charCodeAt(o))||61===r)&&(o=e.skipChars(o,r),!((o=e.skipSpaces(o))<i)&&(o=e.bMarks[t]+e.tShift[t],e.line=s+1,e.tokens.push({type:"heading_open",hLevel:61===r?1:2,lines:[t,e.line],level:e.level}),e.tokens.push({type:"inline",content:e.src.slice(o,e.eMarks[t]).trim(),level:e.level+1,lines:[t,e.line-1],children:[]}),e.tokens.push({type:"heading_close",hLevel:61===r?1:2,level:e.level}),!0))))))}],["htmlblock",function(e,t,n,r){var o,i,s,a=e.bMarks[t],l=e.eMarks[t],c=e.tShift[t];if(a+=c,!e.options.html)return!1;if(c>3||a+2>=l)return!1;if(60!==e.src.charCodeAt(a))return!1;if(33===(o=e.src.charCodeAt(a+1))||63===o){if(r)return!0}else{if(47!==o&&!function(e){var t=32|e;return t>=97&&t<=122}(o))return!1;if(47===o){if(!(i=e.src.slice(a,l).match($t)))return!1}else if(!(i=e.src.slice(a,l).match(Mt)))return!1;if(!0!==Lt[i[1].toLowerCase()])return!1;if(r)return!0}for(s=t+1;s<e.lineMax&&!e.isEmpty(s);)s++;return e.line=s,e.tokens.push({type:"htmlblock",level:e.level,lines:[t,e.line],content:e.getLines(t,s,0,!0)}),!0},["paragraph","blockquote"]],["table",function(e,t,n,r){var o,i,s,a,l,c,u,f,d,h,p;if(t+2>n)return!1;if(l=t+1,e.tShift[l]<e.blkIndent)return!1;if((s=e.bMarks[l]+e.tShift[l])>=e.eMarks[l])return!1;if(124!==(o=e.src.charCodeAt(s))&&45!==o&&58!==o)return!1;if(i=Rt(e,t+1),!/^[-:| ]+$/.test(i))return!1;if((c=i.split("|"))<=2)return!1;for(f=[],a=0;a<c.length;a++){if(!(d=c[a].trim())){if(0===a||a===c.length-1)continue;return!1}if(!/^:?-+:?$/.test(d))return!1;58===d.charCodeAt(d.length-1)?f.push(58===d.charCodeAt(0)?"center":"right"):58===d.charCodeAt(0)?f.push("left"):f.push("")}if(-1===(i=Rt(e,t).trim()).indexOf("|"))return!1;if(c=i.replace(/^\||\|$/g,"").split("|"),f.length!==c.length)return!1;if(r)return!0;for(e.tokens.push({type:"table_open",lines:h=[t,0],level:e.level++}),e.tokens.push({type:"thead_open",lines:[t,t+1],level:e.level++}),e.tokens.push({type:"tr_open",lines:[t,t+1],level:e.level++}),a=0;a<c.length;a++)e.tokens.push({type:"th_open",align:f[a],lines:[t,t+1],level:e.level++}),e.tokens.push({type:"inline",content:c[a].trim(),lines:[t,t+1],level:e.level,children:[]}),e.tokens.push({type:"th_close",level:--e.level});for(e.tokens.push({type:"tr_close",level:--e.level}),e.tokens.push({type:"thead_close",level:--e.level}),e.tokens.push({type:"tbody_open",lines:p=[t+2,0],level:e.level++}),l=t+2;l<n&&!(e.tShift[l]<e.blkIndent)&&-1!==(i=Rt(e,l).trim()).indexOf("|");l++){for(c=i.replace(/^\||\|$/g,"").split("|"),e.tokens.push({type:"tr_open",level:e.level++}),a=0;a<c.length;a++)e.tokens.push({type:"td_open",align:f[a],level:e.level++}),u=c[a].substring(124===c[a].charCodeAt(0)?1:0,124===c[a].charCodeAt(c[a].length-1)?c[a].length-1:c[a].length).trim(),e.tokens.push({type:"inline",content:u,level:e.level,children:[]}),e.tokens.push({type:"td_close",level:--e.level});e.tokens.push({type:"tr_close",level:--e.level})}return e.tokens.push({type:"tbody_close",level:--e.level}),e.tokens.push({type:"table_close",level:--e.level}),h[1]=p[1]=l,e.line=l,!0},["paragraph"]],["deflist",function(e,t,n,r){var o,i,s,a,l,c,u,f,d,h,p,g,y,m;if(r)return!(e.ddIndent<0)&&Pt(e,t)>=0;if(u=t+1,e.isEmpty(u)&&++u>n)return!1;if(e.tShift[u]<e.blkIndent)return!1;if((o=Pt(e,u))<0)return!1;if(e.level>=e.options.maxNesting)return!1;c=e.tokens.length,e.tokens.push({type:"dl_open",lines:l=[t,0],level:e.level++}),s=t,i=u;e:for(;;){for(m=!0,y=!1,e.tokens.push({type:"dt_open",lines:[s,s],level:e.level++}),e.tokens.push({type:"inline",content:e.getLines(s,s+1,e.blkIndent,!1).trim(),level:e.level+1,lines:[s,s],children:[]}),e.tokens.push({type:"dt_close",level:--e.level});;){if(e.tokens.push({type:"dd_open",lines:a=[u,0],level:e.level++}),g=e.tight,d=e.ddIndent,f=e.blkIndent,p=e.tShift[i],h=e.parentType,e.blkIndent=e.ddIndent=e.tShift[i]+2,e.tShift[i]=o-e.bMarks[i],e.tight=!0,e.parentType="deflist",e.parser.tokenize(e,i,n,!0),e.tight&&!y||(m=!1),y=e.line-i>1&&e.isEmpty(e.line-1),e.tShift[i]=p,e.tight=g,e.parentType=h,e.blkIndent=f,e.ddIndent=d,e.tokens.push({type:"dd_close",level:--e.level}),a[1]=u=e.line,u>=n)break e;if(e.tShift[u]<e.blkIndent)break e;if((o=Pt(e,u))<0)break;i=u}if(u>=n)break;if(s=u,e.isEmpty(s))break;if(e.tShift[s]<e.blkIndent)break;if((i=s+1)>=n)break;if(e.isEmpty(i)&&i++,i>=n)break;if(e.tShift[i]<e.blkIndent)break;if((o=Pt(e,i))<0)break}return e.tokens.push({type:"dl_close",level:--e.level}),l[1]=u,e.line=u,m&&function(e,t){var n,r,o=e.level+2;for(n=t+2,r=e.tokens.length-2;n<r;n++)e.tokens[n].level===o&&"paragraph_open"===e.tokens[n].type&&(e.tokens[n+2].tight=!0,e.tokens[n].tight=!0,n+=2)}(e,c),!0},["paragraph"]],["paragraph",function(e,t){var n,r,o,i,s,a,l=t+1;if(l<(n=e.lineMax)&&!e.isEmpty(l))for(a=e.parser.ruler.getRules("paragraph");l<n&&!e.isEmpty(l);l++)if(!(e.tShift[l]-e.blkIndent>3)){for(o=!1,i=0,s=a.length;i<s;i++)if(a[i](e,l,n,!0)){o=!0;break}if(o)break}return r=e.getLines(t,l,e.blkIndent,!1).trim(),e.line=l,r.length&&(e.tokens.push({type:"paragraph_open",tight:!1,lines:[t,e.line],level:e.level}),e.tokens.push({type:"inline",content:r,level:e.level+1,lines:[t,e.line],children:[]}),e.tokens.push({type:"paragraph_close",tight:!1,level:e.level})),!0}]];function jt(){this.ruler=new lt;for(var e=0;e<Tt.length;e++)this.ruler.push(Tt[e][0],Tt[e][1],{alt:(Tt[e][2]||[]).slice()})}jt.prototype.tokenize=function(e,t,n){for(var r,o=this.ruler.getRules(""),i=o.length,s=t,a=!1;s<n&&(e.line=s=e.skipEmptyLines(s),!(s>=n))&&!(e.tShift[s]<e.blkIndent);){for(r=0;r<i&&!o[r](e,s,n,!1);r++);if(e.tight=!a,e.isEmpty(e.line-1)&&(a=!0),(s=e.line)<n&&e.isEmpty(s)){if(a=!0,++s<n&&"list"===e.parentType&&e.isEmpty(s))break;e.line=s}}};var Nt=/[\n\t]/g,qt=/\r[\n\u0085]|[\u2424\u2028\u0085]/g,Ut=/\u00a0/g;function Dt(e){switch(e){case 10:case 92:case 96:case 42:case 95:case 94:case 91:case 93:case 33:case 38:case 60:case 62:case 123:case 125:case 36:case 37:case 64:case 126:case 43:case 61:case 58:return!0;default:return!1}}jt.prototype.parse=function(e,t,n,r){var o,i=0,s=0;if(!e)return[];(e=(e=e.replace(Ut," ")).replace(qt,"\n")).indexOf("\t")>=0&&(e=e.replace(Nt,(function(t,n){var r;return 10===e.charCodeAt(n)?(i=n+1,s=0,t):(r="    ".slice((n-i-s)%4),s=n-i+1,r)}))),o=new It(e,this,t,n,r),this.tokenize(o,o.line,o.lineMax)};for(var Ft=[],Ht=0;Ht<256;Ht++)Ft.push(0);function Vt(e){return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122}function Kt(e,t){var n,r,o,i=t,s=!0,a=!0,l=e.posMax,c=e.src.charCodeAt(t);for(n=t>0?e.src.charCodeAt(t-1):-1;i<l&&e.src.charCodeAt(i)===c;)i++;return i>=l&&(s=!1),(o=i-t)>=4?s=a=!1:(32!==(r=i<l?e.src.charCodeAt(i):-1)&&10!==r||(s=!1),32!==n&&10!==n||(a=!1),95===c&&(Vt(n)&&(s=!1),Vt(r)&&(a=!1))),{can_open:s,can_close:a,delims:o}}"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach((function(e){Ft[e.charCodeAt(0)]=1}));var Wt=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;var Zt=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;var Gt=["coap","doi","javascript","aaa","aaas","about","acap","cap","cid","crid","data","dav","dict","dns","file","ftp","geo","go","gopher","h323","http","https","iax","icap","im","imap","info","ipp","iris","iris.beep","iris.xpc","iris.xpcs","iris.lwz","ldap","mailto","mid","msrp","msrps","mtqp","mupdate","news","nfs","ni","nih","nntp","opaquelocktoken","pop","pres","rtsp","service","session","shttp","sieve","sip","sips","sms","snmp","soap.beep","soap.beeps","tag","tel","telnet","tftp","thismessage","tn3270","tip","tv","urn","vemmi","ws","wss","xcon","xcon-userid","xmlrpc.beep","xmlrpc.beeps","xmpp","z39.50r","z39.50s","adiumxtra","afp","afs","aim","apt","attachment","aw","beshare","bitcoin","bolo","callto","chrome","chrome-extension","com-eventbrite-attendee","content","cvs","dlna-playsingle","dlna-playcontainer","dtn","dvb","ed2k","facetime","feed","finger","fish","gg","git","gizmoproject","gtalk","hcp","icon","ipn","irc","irc6","ircs","itms","jar","jms","keyparc","lastfm","ldaps","magnet","maps","market","message","mms","ms-help","msnim","mumble","mvn","notes","oid","palm","paparazzi","platform","proxy","psyc","query","res","resource","rmi","rsync","rtmp","secondlife","sftp","sgn","skype","smb","soldat","spotify","ssh","steam","svn","teamspeak","things","udp","unreal","ut2004","ventrilo","view-source","webcal","wtai","wyciwyg","xfire","xri","ymsgr"],Jt=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/,Yt=/^<([a-zA-Z.\-]{1,25}):([^<>\x00-\x20]*)>/;function Qt(e,t){return e=e.source,t=t||"",function n(r,o){return r?(o=o.source||o,e=e.replace(r,o),n):new RegExp(e,t)}}var Xt=Qt(/(?:unquoted|single_quoted|double_quoted)/)("unquoted",/[^"'=<>`\x00-\x20]+/)("single_quoted",/'[^']*'/)("double_quoted",/"[^"]*"/)(),en=Qt(/(?:\s+attr_name(?:\s*=\s*attr_value)?)/)("attr_name",/[a-zA-Z_:][a-zA-Z0-9:._-]*/)("attr_value",Xt)(),tn=Qt(/<[A-Za-z][A-Za-z0-9]*attribute*\s*\/?>/)("attribute",en)(),nn=Qt(/^(?:open_tag|close_tag|comment|processing|declaration|cdata)/)("open_tag",tn)("close_tag",/<\/[A-Za-z][A-Za-z0-9]*\s*>/)("comment",/<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->/)("processing",/<[?].*?[?]>/)("declaration",/<![A-Z]+\s+[^>]*>/)("cdata",/<!\[CDATA\[[\s\S]*?\]\]>/)();var rn=/^&#((?:x[a-f0-9]{1,8}|[0-9]{1,8}));/i,on=/^&([a-z][a-z0-9]{1,31});/i;var sn=[["text",function(e,t){for(var n=e.pos;n<e.posMax&&!Dt(e.src.charCodeAt(n));)n++;return n!==e.pos&&(t||(e.pending+=e.src.slice(e.pos,n)),e.pos=n,!0)}],["newline",function(e,t){var n,r,o=e.pos;if(10!==e.src.charCodeAt(o))return!1;if(n=e.pending.length-1,r=e.posMax,!t)if(n>=0&&32===e.pending.charCodeAt(n))if(n>=1&&32===e.pending.charCodeAt(n-1)){for(var i=n-2;i>=0;i--)if(32!==e.pending.charCodeAt(i)){e.pending=e.pending.substring(0,i+1);break}e.push({type:"hardbreak",level:e.level})}else e.pending=e.pending.slice(0,-1),e.push({type:"softbreak",level:e.level});else e.push({type:"softbreak",level:e.level});for(o++;o<r&&32===e.src.charCodeAt(o);)o++;return e.pos=o,!0}],["escape",function(e,t){var n,r=e.pos,o=e.posMax;if(92!==e.src.charCodeAt(r))return!1;if(++r<o){if((n=e.src.charCodeAt(r))<256&&0!==Ft[n])return t||(e.pending+=e.src[r]),e.pos+=2,!0;if(10===n){for(t||e.push({type:"hardbreak",level:e.level}),r++;r<o&&32===e.src.charCodeAt(r);)r++;return e.pos=r,!0}}return t||(e.pending+="\\"),e.pos++,!0}],["backticks",function(e,t){var n,r,o,i,s,a=e.pos;if(96!==e.src.charCodeAt(a))return!1;for(n=a,a++,r=e.posMax;a<r&&96===e.src.charCodeAt(a);)a++;for(o=e.src.slice(n,a),i=s=a;-1!==(i=e.src.indexOf("`",s));){for(s=i+1;s<r&&96===e.src.charCodeAt(s);)s++;if(s-i===o.length)return t||e.push({type:"code",content:e.src.slice(a,i).replace(/[ \n]+/g," ").trim(),block:!1,level:e.level}),e.pos=s,!0}return t||(e.pending+=o),e.pos+=o.length,!0}],["del",function(e,t){var n,r,o,i,s,a=e.posMax,l=e.pos;if(126!==e.src.charCodeAt(l))return!1;if(t)return!1;if(l+4>=a)return!1;if(126!==e.src.charCodeAt(l+1))return!1;if(e.level>=e.options.maxNesting)return!1;if(i=l>0?e.src.charCodeAt(l-1):-1,s=e.src.charCodeAt(l+2),126===i)return!1;if(126===s)return!1;if(32===s||10===s)return!1;for(r=l+2;r<a&&126===e.src.charCodeAt(r);)r++;if(r>l+3)return e.pos+=r-l,t||(e.pending+=e.src.slice(l,r)),!0;for(e.pos=l+2,o=1;e.pos+1<a;){if(126===e.src.charCodeAt(e.pos)&&126===e.src.charCodeAt(e.pos+1)&&(i=e.src.charCodeAt(e.pos-1),126!==(s=e.pos+2<a?e.src.charCodeAt(e.pos+2):-1)&&126!==i&&(32!==i&&10!==i?o--:32!==s&&10!==s&&o++,o<=0))){n=!0;break}e.parser.skipToken(e)}return n?(e.posMax=e.pos,e.pos=l+2,t||(e.push({type:"del_open",level:e.level++}),e.parser.tokenize(e),e.push({type:"del_close",level:--e.level})),e.pos=e.posMax+2,e.posMax=a,!0):(e.pos=l,!1)}],["ins",function(e,t){var n,r,o,i,s,a=e.posMax,l=e.pos;if(43!==e.src.charCodeAt(l))return!1;if(t)return!1;if(l+4>=a)return!1;if(43!==e.src.charCodeAt(l+1))return!1;if(e.level>=e.options.maxNesting)return!1;if(i=l>0?e.src.charCodeAt(l-1):-1,s=e.src.charCodeAt(l+2),43===i)return!1;if(43===s)return!1;if(32===s||10===s)return!1;for(r=l+2;r<a&&43===e.src.charCodeAt(r);)r++;if(r!==l+2)return e.pos+=r-l,t||(e.pending+=e.src.slice(l,r)),!0;for(e.pos=l+2,o=1;e.pos+1<a;){if(43===e.src.charCodeAt(e.pos)&&43===e.src.charCodeAt(e.pos+1)&&(i=e.src.charCodeAt(e.pos-1),43!==(s=e.pos+2<a?e.src.charCodeAt(e.pos+2):-1)&&43!==i&&(32!==i&&10!==i?o--:32!==s&&10!==s&&o++,o<=0))){n=!0;break}e.parser.skipToken(e)}return n?(e.posMax=e.pos,e.pos=l+2,t||(e.push({type:"ins_open",level:e.level++}),e.parser.tokenize(e),e.push({type:"ins_close",level:--e.level})),e.pos=e.posMax+2,e.posMax=a,!0):(e.pos=l,!1)}],["mark",function(e,t){var n,r,o,i,s,a=e.posMax,l=e.pos;if(61!==e.src.charCodeAt(l))return!1;if(t)return!1;if(l+4>=a)return!1;if(61!==e.src.charCodeAt(l+1))return!1;if(e.level>=e.options.maxNesting)return!1;if(i=l>0?e.src.charCodeAt(l-1):-1,s=e.src.charCodeAt(l+2),61===i)return!1;if(61===s)return!1;if(32===s||10===s)return!1;for(r=l+2;r<a&&61===e.src.charCodeAt(r);)r++;if(r!==l+2)return e.pos+=r-l,t||(e.pending+=e.src.slice(l,r)),!0;for(e.pos=l+2,o=1;e.pos+1<a;){if(61===e.src.charCodeAt(e.pos)&&61===e.src.charCodeAt(e.pos+1)&&(i=e.src.charCodeAt(e.pos-1),61!==(s=e.pos+2<a?e.src.charCodeAt(e.pos+2):-1)&&61!==i&&(32!==i&&10!==i?o--:32!==s&&10!==s&&o++,o<=0))){n=!0;break}e.parser.skipToken(e)}return n?(e.posMax=e.pos,e.pos=l+2,t||(e.push({type:"mark_open",level:e.level++}),e.parser.tokenize(e),e.push({type:"mark_close",level:--e.level})),e.pos=e.posMax+2,e.posMax=a,!0):(e.pos=l,!1)}],["emphasis",function(e,t){var n,r,o,i,s,a,l,c=e.posMax,u=e.pos,f=e.src.charCodeAt(u);if(95!==f&&42!==f)return!1;if(t)return!1;if(n=(l=Kt(e,u)).delims,!l.can_open)return e.pos+=n,t||(e.pending+=e.src.slice(u,e.pos)),!0;if(e.level>=e.options.maxNesting)return!1;for(e.pos=u+n,a=[n];e.pos<c;)if(e.src.charCodeAt(e.pos)!==f)e.parser.skipToken(e);else{if(r=(l=Kt(e,e.pos)).delims,l.can_close){for(i=a.pop(),s=r;i!==s;){if(s<i){a.push(i-s);break}if(s-=i,0===a.length)break;e.pos+=i,i=a.pop()}if(0===a.length){n=i,o=!0;break}e.pos+=r;continue}l.can_open&&a.push(r),e.pos+=r}return o?(e.posMax=e.pos,e.pos=u+n,t||(2!==n&&3!==n||e.push({type:"strong_open",level:e.level++}),1!==n&&3!==n||e.push({type:"em_open",level:e.level++}),e.parser.tokenize(e),1!==n&&3!==n||e.push({type:"em_close",level:--e.level}),2!==n&&3!==n||e.push({type:"strong_close",level:--e.level})),e.pos=e.posMax+n,e.posMax=c,!0):(e.pos=u,!1)}],["sub",function(e,t){var n,r,o=e.posMax,i=e.pos;if(126!==e.src.charCodeAt(i))return!1;if(t)return!1;if(i+2>=o)return!1;if(e.level>=e.options.maxNesting)return!1;for(e.pos=i+1;e.pos<o;){if(126===e.src.charCodeAt(e.pos)){n=!0;break}e.parser.skipToken(e)}return n&&i+1!==e.pos?(r=e.src.slice(i+1,e.pos)).match(/(^|[^\\])(\\\\)*\s/)?(e.pos=i,!1):(e.posMax=e.pos,e.pos=i+1,t||e.push({type:"sub",level:e.level,content:r.replace(Wt,"$1")}),e.pos=e.posMax+1,e.posMax=o,!0):(e.pos=i,!1)}],["sup",function(e,t){var n,r,o=e.posMax,i=e.pos;if(94!==e.src.charCodeAt(i))return!1;if(t)return!1;if(i+2>=o)return!1;if(e.level>=e.options.maxNesting)return!1;for(e.pos=i+1;e.pos<o;){if(94===e.src.charCodeAt(e.pos)){n=!0;break}e.parser.skipToken(e)}return n&&i+1!==e.pos?(r=e.src.slice(i+1,e.pos)).match(/(^|[^\\])(\\\\)*\s/)?(e.pos=i,!1):(e.posMax=e.pos,e.pos=i+1,t||e.push({type:"sup",level:e.level,content:r.replace(Zt,"$1")}),e.pos=e.posMax+1,e.posMax=o,!0):(e.pos=i,!1)}],["links",function(e,t){var n,r,o,i,s,a,l,c,u=!1,f=e.pos,d=e.posMax,h=e.pos,p=e.src.charCodeAt(h);if(33===p&&(u=!0,p=e.src.charCodeAt(++h)),91!==p)return!1;if(e.level>=e.options.maxNesting)return!1;if(n=h+1,(r=ut(e,h))<0)return!1;if((a=r+1)<d&&40===e.src.charCodeAt(a)){for(a++;a<d&&(32===(c=e.src.charCodeAt(a))||10===c);a++);if(a>=d)return!1;for(h=a,ht(e,a)?(i=e.linkContent,a=e.pos):i="",h=a;a<d&&(32===(c=e.src.charCodeAt(a))||10===c);a++);if(a<d&&h!==a&&pt(e,a))for(s=e.linkContent,a=e.pos;a<d&&(32===(c=e.src.charCodeAt(a))||10===c);a++);else s="";if(a>=d||41!==e.src.charCodeAt(a))return e.pos=f,!1;a++}else{if(e.linkLevel>0)return!1;for(;a<d&&(32===(c=e.src.charCodeAt(a))||10===c);a++);if(a<d&&91===e.src.charCodeAt(a)&&(h=a+1,(a=ut(e,a))>=0?o=e.src.slice(h,a++):a=h-1),o||(void 0===o&&(a=r+1),o=e.src.slice(n,r)),!(l=e.env.references[gt(o)]))return e.pos=f,!1;i=l.href,s=l.title}return t||(e.pos=n,e.posMax=r,u?e.push({type:"image",src:i,title:s,alt:e.src.substr(n,r-n),level:e.level}):(e.push({type:"link_open",href:i,title:s,level:e.level++}),e.linkLevel++,e.parser.tokenize(e),e.linkLevel--,e.push({type:"link_close",level:--e.level}))),e.pos=a,e.posMax=d,!0}],["footnote_inline",function(e,t){var n,r,o,i,s=e.posMax,a=e.pos;return!(a+2>=s)&&(94===e.src.charCodeAt(a)&&(91===e.src.charCodeAt(a+1)&&(!(e.level>=e.options.maxNesting)&&(n=a+2,!((r=ut(e,a+1))<0)&&(t||(e.env.footnotes||(e.env.footnotes={}),e.env.footnotes.list||(e.env.footnotes.list=[]),o=e.env.footnotes.list.length,e.pos=n,e.posMax=r,e.push({type:"footnote_ref",id:o,level:e.level}),e.linkLevel++,i=e.tokens.length,e.parser.tokenize(e),e.env.footnotes.list[o]={tokens:e.tokens.splice(i)},e.linkLevel--),e.pos=r+1,e.posMax=s,!0)))))}],["footnote_ref",function(e,t){var n,r,o,i,s=e.posMax,a=e.pos;if(a+3>s)return!1;if(!e.env.footnotes||!e.env.footnotes.refs)return!1;if(91!==e.src.charCodeAt(a))return!1;if(94!==e.src.charCodeAt(a+1))return!1;if(e.level>=e.options.maxNesting)return!1;for(r=a+2;r<s;r++){if(32===e.src.charCodeAt(r))return!1;if(10===e.src.charCodeAt(r))return!1;if(93===e.src.charCodeAt(r))break}return r!==a+2&&(!(r>=s)&&(r++,n=e.src.slice(a+2,r-1),void 0!==e.env.footnotes.refs[":"+n]&&(t||(e.env.footnotes.list||(e.env.footnotes.list=[]),e.env.footnotes.refs[":"+n]<0?(o=e.env.footnotes.list.length,e.env.footnotes.list[o]={label:n,count:0},e.env.footnotes.refs[":"+n]=o):o=e.env.footnotes.refs[":"+n],i=e.env.footnotes.list[o].count,e.env.footnotes.list[o].count++,e.push({type:"footnote_ref",id:o,subId:i,level:e.level})),e.pos=r,e.posMax=s,!0)))}],["autolink",function(e,t){var n,r,o,i,s,a=e.pos;return 60===e.src.charCodeAt(a)&&(!((n=e.src.slice(a)).indexOf(">")<0)&&((r=n.match(Yt))?!(Gt.indexOf(r[1].toLowerCase())<0)&&(s=dt(i=r[0].slice(1,-1)),!!e.parser.validateLink(i)&&(t||(e.push({type:"link_open",href:s,level:e.level}),e.push({type:"text",content:i,level:e.level+1}),e.push({type:"link_close",level:e.level})),e.pos+=r[0].length,!0)):!!(o=n.match(Jt))&&(s=dt("mailto:"+(i=o[0].slice(1,-1))),!!e.parser.validateLink(s)&&(t||(e.push({type:"link_open",href:s,level:e.level}),e.push({type:"text",content:i,level:e.level+1}),e.push({type:"link_close",level:e.level})),e.pos+=o[0].length,!0))))}],["htmltag",function(e,t){var n,r,o,i=e.pos;return!!e.options.html&&(o=e.posMax,!(60!==e.src.charCodeAt(i)||i+2>=o)&&(!(33!==(n=e.src.charCodeAt(i+1))&&63!==n&&47!==n&&!function(e){var t=32|e;return t>=97&&t<=122}(n))&&(!!(r=e.src.slice(i).match(nn))&&(t||e.push({type:"htmltag",content:e.src.slice(i,i+r[0].length),level:e.level}),e.pos+=r[0].length,!0))))}],["entity",function(e,t){var n,r,o=e.pos,i=e.posMax;if(38!==e.src.charCodeAt(o))return!1;if(o+1<i)if(35===e.src.charCodeAt(o+1)){if(r=e.src.slice(o).match(rn))return t||(n="x"===r[1][0].toLowerCase()?parseInt(r[1].slice(1),16):parseInt(r[1],10),e.pending+=We(n)?Ze(n):Ze(65533)),e.pos+=r[0].length,!0}else if(r=e.src.slice(o).match(on)){var s=De(r[1]);if(r[1]!==s)return t||(e.pending+=s),e.pos+=r[0].length,!0}return t||(e.pending+="&"),e.pos++,!0}]];function an(){this.ruler=new lt;for(var e=0;e<sn.length;e++)this.ruler.push(sn[e][0],sn[e][1]);this.validateLink=ln}function ln(e){var t=e.trim().toLowerCase();return-1===(t=Qe(t)).indexOf(":")||-1===["vbscript","javascript","file","data"].indexOf(t.split(":")[0])}an.prototype.skipToken=function(e){var t,n,r=this.ruler.getRules(""),o=r.length,i=e.pos;if((n=e.cacheGet(i))>0)e.pos=n;else{for(t=0;t<o;t++)if(r[t](e,!0))return void e.cacheSet(i,e.pos);e.pos++,e.cacheSet(i,e.pos)}},an.prototype.tokenize=function(e){for(var t,n,r=this.ruler.getRules(""),o=r.length,i=e.posMax;e.pos<i;){for(n=0;n<o&&!(t=r[n](e,!1));n++);if(t){if(e.pos>=i)break}else e.pending+=e.src[e.pos++]}e.pending&&e.pushPending()},an.prototype.parse=function(e,t,n,r){var o=new ct(e,this,t,n,r);this.tokenize(o)};var cn={default:{options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","replacements","smartquotes","references","abbr2","footnote_tail"]},block:{rules:["blockquote","code","fences","footnote","heading","hr","htmlblock","lheading","list","paragraph","table"]},inline:{rules:["autolink","backticks","del","emphasis","entity","escape","footnote_ref","htmltag","links","newline","text"]}}},full:{options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{},block:{},inline:{}}},commonmark:{options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","abbr2"]},block:{rules:["blockquote","code","fences","heading","hr","htmlblock","lheading","list","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","htmltag","links","newline","text"]}}}};function un(e,t,n){this.src=t,this.env=n,this.options=e.options,this.tokens=[],this.inlineMode=!1,this.inline=e.inline,this.block=e.block,this.renderer=e.renderer,this.typographer=e.typographer}function fn(e,t){"string"!=typeof e&&(t=e,e="default"),t&&null!=t.linkify&&console.warn("linkify option is removed. Use linkify plugin instead:\n\nimport Remarkable from 'remarkable';\nimport linkify from 'remarkable/linkify';\nnew Remarkable().use(linkify)\n"),this.inline=new an,this.block=new jt,this.core=new zt,this.renderer=new at,this.ruler=new lt,this.options={},this.configure(cn[e]),this.set(t||{})}function dn(e,{delay:t}={}){if("number"!=typeof t&&void 0!==t)throw new TypeError(`Expected \`interval\` to be of type \`number\` but received type \`${typeof t}\``);const n=void 0===t?async()=>{}:(r=t,async()=>new Promise((e=>{setTimeout(e,r)})));var r;let o=[];return t=>{o.push(t),1===o.length&&(async()=>{await n(),e(o),o=[]})()}}fn.prototype.set=function(e){He(this.options,e)},fn.prototype.configure=function(e){var t=this;if(!e)throw new Error("Wrong `remarkable` preset, check name/content");e.options&&t.set(e.options),e.components&&Object.keys(e.components).forEach((function(n){e.components[n].rules&&t[n].ruler.enable(e.components[n].rules,!0)}))},fn.prototype.use=function(e,t){return e(this,t),this},fn.prototype.parse=function(e,t){var n=new un(this,e,t);return this.core.process(n),n.tokens},fn.prototype.render=function(e,t){return t=t||{},this.renderer.render(this.parse(e,t),this.options,t)},fn.prototype.parseInline=function(e,t){var n=new un(this,e,t);return n.inlineMode=!0,this.core.process(n),n.tokens},fn.prototype.renderInline=function(e,t){return t=t||{},this.renderer.render(this.parseInline(e,t),this.options,t)};const hn=Symbol("store-raw"),pn=Symbol("store-node"),gn=Symbol("store-has"),yn=Symbol("store-self");function mn(e){let t=e[o];if(!t&&(Object.defineProperty(e,o,{value:t=new Proxy(e,En)}),!Array.isArray(e))){const n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let o=0,i=n.length;o<i;o++){const i=n[o];r[i].get&&Object.defineProperty(e,i,{enumerable:r[i].enumerable,get:r[i].get.bind(t)})}}return t}function vn(e){let t;return null!=e&&"object"==typeof e&&(e[o]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function bn(e,t=new Set){let n,r,o,i;if(n=null!=e&&e[hn])return n;if(!vn(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let n=0,i=e.length;n<i;n++)o=e[n],(r=bn(o,t))!==o&&(e[n]=r)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const n=Object.keys(e),s=Object.getOwnPropertyDescriptors(e);for(let a=0,l=n.length;a<l;a++)i=n[a],s[i].get||(o=e[i],(r=bn(o,t))!==o&&(e[i]=r))}return e}function wn(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function kn(e,t,n){if(e[t])return e[t];const[r,o]=w(n,{equals:!1,internal:!0});return r.$=o,e[t]=r}function _n(e){B()&&kn(wn(e,pn),yn)()}function xn(e){return _n(e),Reflect.ownKeys(e)}const En={get(e,t,n){if(t===hn)return e;if(t===o)return n;if(t===i)return _n(e),n;const r=wn(e,pn),s=r[t];let a=s?s():e[t];if(t===pn||t===gn||"__proto__"===t)return a;if(!s){const n=Object.getOwnPropertyDescriptor(e,t);!B()||"function"==typeof a&&!e.hasOwnProperty(t)||n&&n.get||(a=kn(r,t,a)())}return vn(a)?mn(a):a},has:(e,t)=>t===hn||t===o||t===i||t===pn||t===gn||"__proto__"===t||(B()&&kn(wn(e,gn),t)(),t in e),set:()=>!0,deleteProperty:()=>!0,ownKeys:xn,getOwnPropertyDescriptor:function(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return n&&!n.get&&n.configurable&&t!==o&&t!==pn?(delete n.value,delete n.writable,n.get=()=>e[o][t],n):n}};function An(e,t,n,r=!1){if(!r&&e[t]===n)return;const o=e[t],i=e.length;void 0===n?(delete e[t],e[gn]&&e[gn][t]&&void 0!==o&&e[gn][t].$()):(e[t]=n,e[gn]&&e[gn][t]&&void 0===o&&e[gn][t].$());let s,a=wn(e,pn);if((s=kn(a,t,o))&&s.$((()=>n)),Array.isArray(e)&&e.length!==i){for(let t=e.length;t<i;t++)(s=a[t])&&s.$();(s=kn(a,"length",i))&&s.$(e.length)}(s=a[yn])&&s.$()}function Cn(e,t){const n=Object.keys(t);for(let r=0;r<n.length;r+=1){const o=n[r];An(e,o,t[o])}}function Sn(e,t,n=[]){let r,o=e;if(t.length>1){r=t.shift();const i=typeof r,s=Array.isArray(e);if(Array.isArray(r)){for(let o=0;o<r.length;o++)Sn(e,[r[o]].concat(t),n);return}if(s&&"function"===i){for(let o=0;o<e.length;o++)r(e[o],o)&&Sn(e,[o].concat(t),n);return}if(s&&"object"===i){const{from:o=0,to:i=e.length-1,by:s=1}=r;for(let r=o;r<=i;r+=s)Sn(e,[r].concat(t),n);return}if(t.length>1)return void Sn(e[r],t,[r].concat(n));o=e[r],n=[r].concat(n)}let i=t[0];"function"==typeof i&&(i=i(o,n),i===o)||void 0===r&&null==i||(i=bn(i),void 0===r||vn(o)&&vn(i)&&!Array.isArray(i)?Cn(o,i):An(e,r,i))}function zn(...[e,t]){const n=bn(e||{}),r=Array.isArray(n);return[mn(n),function(...e){C((()=>{r&&1===e.length?function(e,t){if("function"==typeof t&&(t=t(e)),t=bn(t),Array.isArray(t)){if(e===t)return;let n=0,r=t.length;for(;n<r;n++){const r=t[n];e[n]!==r&&An(e,n,r)}An(e,"length",r)}else Cn(e,t)}(n,e[0]):Sn(n,e)}))}]}const In={get(e,t,n){if(t===hn)return e;if(t===o)return n;if(t===i)return _n(e),n;const r=wn(e,pn),s=r[t];let a=s?s():e[t];if(t===pn||t===gn||"__proto__"===t)return a;if(!s){const o=Object.getOwnPropertyDescriptor(e,t),i="function"==typeof a;if(!B()||i&&!e.hasOwnProperty(t)||o&&o.get){if(null!=a&&i&&a===Array.prototype[t])return(...e)=>C((()=>Array.prototype[t].apply(n,e)))}else a=kn(r,t,a)()}return vn(a)?Bn(a):a},has:(e,t)=>t===hn||t===o||t===i||t===pn||t===gn||"__proto__"===t||(B()&&kn(wn(e,gn),t)(),t in e),set:(e,t,n)=>(C((()=>An(e,t,bn(n)))),!0),deleteProperty:(e,t)=>(C((()=>An(e,t,void 0,!0))),!0),ownKeys:xn,getOwnPropertyDescriptor:function(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||n.set||!n.configurable||t===o||t===pn||(delete n.value,delete n.writable,n.get=()=>e[o][t],n.set=n=>e[o][t]=n),n}};function Bn(e){let t=e[o];if(!t){Object.defineProperty(e,o,{value:t=new Proxy(e,In)});const n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e),i=Object.getPrototypeOf(e),s=null!==e&&"object"==typeof e&&!Array.isArray(e)&&i!==Object.prototype;if(s){const e=Object.getOwnPropertyDescriptors(i);n.push(...Object.keys(e)),Object.assign(r,e)}for(let o=0,a=n.length;o<a;o++){const i=n[o];if(!s||"constructor"!==i){if(r[i].get){const n=r[i].get.bind(t);Object.defineProperty(e,i,{get:n,configurable:!0})}if(r[i].set){const n=r[i].set,o=e=>C((()=>n.call(t,e)));Object.defineProperty(e,i,{set:o,configurable:!0})}}}}return t}function On(e,t){return Bn(bn(e||{}))}const Ln=Symbol("store-root");function Mn(e,t,n,r,o){const i=t[n];if(e===i)return;const s=Array.isArray(e);if(n!==Ln&&(!vn(e)||!vn(i)||s!==Array.isArray(i)||o&&e[o]!==i[o]))return void An(t,n,e);if(s){if(e.length&&i.length&&(!r||o&&e[0]&&null!=e[0][o])){let t,n,s,a,l,c,u,f;for(s=0,a=Math.min(i.length,e.length);s<a&&(i[s]===e[s]||o&&i[s]&&e[s]&&i[s][o]===e[s][o]);s++)Mn(e[s],i,s,r,o);const d=new Array(e.length),h=new Map;for(a=i.length-1,l=e.length-1;a>=s&&l>=s&&(i[a]===e[l]||o&&i[s]&&e[s]&&i[a][o]===e[l][o]);a--,l--)d[l]=i[a];if(s>l||s>a){for(n=s;n<=l;n++)An(i,n,e[n]);for(;n<e.length;n++)An(i,n,d[n]),Mn(e[n],i,n,r,o);return void(i.length>e.length&&An(i,"length",e.length))}for(u=new Array(l+1),n=l;n>=s;n--)c=e[n],f=o&&c?c[o]:c,t=h.get(f),u[n]=void 0===t?-1:t,h.set(f,n);for(t=s;t<=a;t++)c=i[t],f=o&&c?c[o]:c,n=h.get(f),void 0!==n&&-1!==n&&(d[n]=i[t],n=u[n],h.set(f,n));for(n=s;n<e.length;n++)n in d?(An(i,n,d[n]),Mn(e[n],i,n,r,o)):An(i,n,e[n])}else for(let t=0,n=e.length;t<n;t++)Mn(e[t],i,t,r,o);return void(i.length>e.length&&An(i,"length",e.length))}const a=Object.keys(e);for(let c=0,u=a.length;c<u;c++)Mn(e[a[c]],i,a[c],r,o);const l=Object.keys(i);for(let c=0,u=l.length;c<u;c++)void 0===e[l[c]]&&An(i,l[c],void 0)}function $n(e,t={}){const{merge:n,key:r="id"}=t,o=bn(e);return e=>{if(!vn(e)||!vn(o))return o;const t=Mn(o,{[Ln]:e},Ln,n,r);return void 0===t?e:t}}const Rn=new WeakMap,Pn={get(e,t){if(t===hn)return e;const n=e[t];let r;return vn(n)?Rn.get(n)||(Rn.set(n,r=new Proxy(n,Pn)),r):n},set:(e,t,n)=>(An(e,t,bn(n)),!0),deleteProperty:(e,t)=>(An(e,t,void 0,!0),!0)};const Tn=(e,t)=>t.some((t=>e instanceof t));let jn,Nn;const qn=new WeakMap,Un=new WeakMap,Dn=new WeakMap,Fn=new WeakMap,Hn=new WeakMap;let Vn={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Un.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Dn.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Zn(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Kn(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Nn||(Nn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Gn(this),t),Zn(qn.get(this))}:function(...t){return Zn(e.apply(Gn(this),t))}:function(t,...n){const r=e.call(Gn(this),t,...n);return Dn.set(r,t.sort?t.sort():[t]),Zn(r)}}function Wn(e){return"function"==typeof e?Kn(e):(e instanceof IDBTransaction&&function(e){if(Un.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)}));Un.set(e,t)}(e),Tn(e,jn||(jn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Vn):e)}function Zn(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(Zn(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&qn.set(t,e)})).catch((()=>{})),Hn.set(t,e),t}(e);if(Fn.has(e))return Fn.get(e);const t=Wn(e);return t!==e&&(Fn.set(e,t),Hn.set(t,e)),t}const Gn=e=>Hn.get(e);const Jn=["get","getKey","getAll","getAllKeys","count"],Yn=["put","add","delete","clear"],Qn=new Map;function Xn(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Qn.get(t))return Qn.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=Yn.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!Jn.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,o?"readwrite":"readonly");let s=i.store;return r&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),o&&i.done]))[0]};return Qn.set(t,i),i}function er(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[]},n=[];for(const r of e.tags)"e"===r[0]&&r[1]&&n.push(r),"p"===r[0]&&r[1]&&t.profiles.push({pubkey:r[1],relays:r[2]?[r[2]]:[]});for(let r=0;r<n.length;r++){const e=n[r],[o,i,s,a]=e,l={id:i,relays:s?[s]:[]},c=0===r,u=r===n.length-1;"root"!==a?"reply"!==a?"mention"!==a?c?t.root=l:u?t.reply=l:t.mentions.push(l):t.mentions.push(l):t.reply=l:t.root=l}return t}Vn=(e=>({...e,get:(t,n,r)=>Xn(t,n)||e.get(t,n,r),has:(t,n)=>!!Xn(t,n)||e.has(t,n)}))(Vn);var tr={equals:!1},nr=(t=class{constructor(t=Map){__privateAdd(this,e,void 0),__privateSet(this,e,new t)}dirty(t){var n;null==(n=__privateGet(this,e).get(t))||n.$$()}track(t){if(!B())return;let n=__privateGet(this,e).get(t);if(n)n.n++;else{const[r,o]=w(void 0,tr);__privateGet(this,e).set(t,n={$:r,$$:o,n:1})}I((()=>{1==n.n--&&queueMicrotask((()=>0===n.n&&__privateGet(this,e).delete(t)))})),n.$()}},e=new WeakMap,t),rr=Symbol("track-keys"),or=(r=class extends Set{constructor(e){if(super(),__privateAdd(this,n,new nr),e)for(const t of e)super.add(t)}get size(){return __privateGet(this,n).track(rr),super.size}has(e){return __privateGet(this,n).track(e),super.has(e)}*keys(){for(const e of super.keys())__privateGet(this,n).track(e),yield e;__privateGet(this,n).track(rr)}values(){return this.keys()}*entries(){for(const e of super.keys())__privateGet(this,n).track(e),yield[e,e];__privateGet(this,n).track(rr)}[Symbol.iterator](){return this.values()}forEach(e){__privateGet(this,n).track(rr),super.forEach(e)}add(e){return super.has(e)||(super.add(e),C((()=>{__privateGet(this,n).dirty(e),__privateGet(this,n).dirty(rr)}))),this}delete(e){const t=super.delete(e);return t&&C((()=>{__privateGet(this,n).dirty(e),__privateGet(this,n).dirty(rr)})),t}clear(){super.size&&C((()=>{for(const e of super.keys())__privateGet(this,n).dirty(e);super.clear(),__privateGet(this,n).dirty(rr)}))}},n=new WeakMap,r);const ir=On({readRelays:[],writeRelays:[],rootEventIds:[],topRootEventIds:new Set,userObservedComments:!1,userStartedReadingComments:!1,commentContexts:new Map,maxCommentLength:0,writePowDifficulty:0,minReadPow:0,maxWritePow:0,blocks:{events:new Set,pubkeys:new Set,checkUpdates:!0},ranks:new Map,showReportButton:new Set,moderators:new or,filter:{},profiles:()=>[]}),sr=On({}),ar=["reply","likes","votes","singleVoteCounter","zaps","publish","watch","hideContent","relayInformation","spamNostrBand"],lr=e=>ar.includes(e),cr="aa,ab,ae,af,ak,am,an,ar,as,av,ay,az,ba,be,bg,bi,bm,bn,bo,br,bs,ca,ce,ch,co,cr,cs,cu,cv,cy,da,de,dv,dz,ee,el,en,eo,es,et,eu,fa,ff,fi,fj,fo,fr,fy,ga,gd,gl,gn,gu,gv,ha,he,hi,ho,hr,ht,hu,hy,hz,ia,id,ie,ig,ii,ik,io,is,it,iu,ja,jv,ka,kg,ki,kj,kk,kl,km,kn,ko,kr,ks,ku,kv,kw,ky,la,lb,lg,li,ln,lo,lt,lu,lv,mg,mh,mi,mk,ml,mn,mr,ms,mt,my,na,nb,nd,ne,ng,nl,nn,no,nr,nv,ny,oc,oj,om,or,os,pa,pi,pl,ps,pt,qu,rm,rn,ro,ru,rw,sa,sc,sd,se,sg,si,sk,sl,sm,sn,so,sq,sr,ss,st,su,sv,sw,ta,te,tg,th,ti,tk,tl,tn,to,tr,ts,tt,tw,ty,ug,uk,ur,uz,ve,vi,vo,wa,wo,xh,yi,yo,za,zh,zu".split(","),ur=e=>cr.includes(e),fr=e=>"-"===e.content?-1:0===e.content.length||"+"===e.content?1:0,dr={events:"id",reactions:"id",aggregates:["eid","k"],profiles:"pk",profileRelays:"pk",sessions:"pk",requestFilters:"key",relayInfos:"name",relayStats:["name","kind","serial"],eventsBlocked:"id",pubkeysBlocked:"id",communities:"community"},hr=async(e,t)=>{if(t<=1){const t=[...e.objectStoreNames];await Promise.all(t.map((t=>e.deleteObjectStore(t))))}const n=e.createObjectStore("events",{keyPath:dr.events});n.createIndex("pk","pk"),n.createIndex("a","a"),n.createIndex("ro","ro"),n.createIndex("r","r"),n.createIndex("d","d"),n.createIndex("k","k");e.createObjectStore("reactions",{keyPath:dr.reactions}).createIndex("a","a"),e.createObjectStore("aggregates",{keyPath:dr.aggregates});e.createObjectStore("profiles",{keyPath:dr.profiles}).createIndex("l","l"),e.createObjectStore("profileRelays",{keyPath:dr.profileRelays});e.createObjectStore("sessions",{keyPath:dr.sessions}).createIndex("autoLogin","autoLogin"),e.createObjectStore("requestFilters",{keyPath:dr.requestFilters}),e.createObjectStore("relayInfos",{keyPath:dr.relayInfos});e.createObjectStore("relayStats",{keyPath:dr.relayStats}).createIndex("name","name"),e.createObjectStore("pubkeysBlocked",{keyPath:dr.pubkeysBlocked}),e.createObjectStore("eventsBlocked",{keyPath:dr.eventsBlocked}),e.createObjectStore("communities",{keyPath:dr.communities})},pr=e=>e.filter((e=>2===e.length&&"client"===e[0])).map((e=>e[1]))[0],gr=e=>{var t,n;const r=er(e),o=e.tags.find((e=>"a"===e[0])),i=o&&o[1],s=o&&"mention"===o[3],a=e.tags.find((e=>"r"===e[0])),l=a&&a[1],c=e.tags.filter((e=>"t"===e[0])),u=[...new Set(c.map((e=>e[1])))],f=e.tags.find((e=>"d"===e[0])),d=f&&f[1],h=e.tags.find((e=>"title"===e[0])),p=h&&h[1],g=e.tags.find((e=>e.length>2&&"nonce"===e[0])),y=g&&+g[2]||0,m=pr(e.tags),v=e.tags.filter((e=>e.length>=3&&"l"===e[0]&&"ISO-639-1"===e[2])).map((e=>e[1].trim())).filter(ur)[0];return{id:e.id??"",k:e.kind,c:e.content,ts:e.created_at,pk:e.pubkey,ro:null==(t=r.root)?void 0:t.id,re:null==(n=r.reply)?void 0:n.id,me:r.mentions.map((e=>e.id)),p:r.profiles.map((e=>e.pubkey)),a:i,am:s,r:l,t:u,d:d,tl:p,pow:y,client:m,language:v}};let yr,mr={},vr=!0,br=!0;const wr=async()=>{if(vr&&br)try{return yr||(yr=await function(e,t,{blocked:n,upgrade:r,blocking:o,terminated:i}={}){const s=indexedDB.open(e,t),a=Zn(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(Zn(s.result),e.oldVersion,e.newVersion,Zn(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),o&&e.addEventListener("versionchange",(e=>o(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("zapthreads-codonaft",2,{upgrade:hr}),yr.addEventListener("close",(e=>{console.log("[zapthreads] closed database"),br=!1}),{once:!0}),window.addEventListener("storage",(e=>{null===e.key&&(console.log("[zapthreads] cleared storage"),br=!1)}),{once:!0})),yr}catch(e){vr=!1}},kr=e=>{const t=E(z(e,(()=>{const[t,n,r]=e(),[o,{mutate:i}]=A((()=>Br[t]),(()=>xr(t,n,r)),{initialValue:[],storage:Or});return xr(t,n,r).then(i),o})));return()=>t()()},_r=e=>{const t=E(z(e,(()=>{const[t,n,r]=e(),[o,{mutate:i}]=A((()=>Br[t]),(()=>Er(t,n,r)),{initialValue:void 0,storage:Or});return Er(t,n,r).then(i),o})));return()=>t()()},xr=async(e,t,n)=>{if(!br)return[];const r=await wr();if(!r){const r=mr[e];if(r){if(n){const e=Array.isArray(t)?t:[t];return Object.values(r).filter((t=>e.includes(t[n.index])))}return Object.values(r)}return[]}if(t&&n){if(Array.isArray(t)){const o=t.map((t=>r.getAllFromIndex(e,n.index,t)));return(await Promise.all(o)).flat()}return r.getAllFromIndex(e,n.index,t)}return r.getAll(e)},Er=async(e,t,n)=>{if(!br)return;const r=await wr();if(r)return n?r.getFromIndex(e,n.index,t):r.get(e,t);{const r=mr[e];if(r){if(n)return Object.values(r).find((e=>e[n.index]===t));return r[(t.lower?t.lower:t).toString()]}}},Ar={},Cr=(e,t)=>{mr[e]??(mr[e]={});for(const n of t){let t=dr[e];t=Array.isArray(t)?t:[t];const r=t.map((e=>n[e])).join(",");mr[e][r]=n}},Sr=async(e,t,n={immediate:!1})=>{if(!br)return;const r=await wr();if(n.immediate)return r?r.put(e,t):Cr(e,[t]),void(Br[e]=+new Date);Ar[e]||(Ar[e]=dn((async t=>{if(!r)return Cr(e,t),void(Br[e]=+new Date);const n=r.transaction(e,"readwrite");await Promise.all([...t.map((e=>n.store.put(e))),n.done])&&(Br[e]=+new Date)}),{delay:96})),Ar[e](t)},zr=async(e,t,n={immediate:!0})=>{if(!br)return;const r=await wr();let o=!0;if(!n.immediate)throw new Error("unimplemented");if(r){const n=r.transaction(e,"readwrite");o=!!(await Promise.all([...t.map((e=>n.store.delete(e))),n.done]))}else((e,t)=>{const n=mr[e];n&&delete n[(t.lower?t.lower:t).toString()]})(e,t);o&&(Br[e]=+new Date)},Ir=async e=>{await new Promise((e=>setTimeout(e,96))),await e()},Br=On({});function Or(e){const[t,n]=zn({value:e});return[()=>t.value,e=>{const r=bn(t.value);return"function"==typeof e&&(e=e(r)),n("value",$n(e)),t.value}]}function Lr(e){-1===e.indexOf("://")&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}new TextDecoder("utf-8"),new TextEncoder;function Mr(e,t){if(e.ids&&-1===e.ids.indexOf(t.id))return!1;if(e.kinds&&-1===e.kinds.indexOf(t.kind))return!1;if(e.authors&&-1===e.authors.indexOf(t.pubkey))return!1;for(let n in e)if("#"===n[0]){let r=e[`#${n.slice(1)}`];if(r&&!t.tags.find((([e,t])=>e===n.slice(1)&&-1!==r.indexOf(t))))return!1}return!(e.since&&t.created_at<e.since)&&!(e.until&&t.created_at>e.until)}new TextDecoder("utf-8"),new TextEncoder;var $r=class{constructor(e){__publicField(this,"value"),__publicField(this,"next",null),__publicField(this,"prev",null),this.value=e}},Rr=class{constructor(){__publicField(this,"first"),__publicField(this,"last"),this.first=null,this.last=null}enqueue(e){const t=new $r(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const e=this.first;return this.first=e.next,e.value}};async function Pr(){return new Promise((e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()}))}var Tr=class{constructor(e,t){__publicField(this,"url"),__publicField(this,"_connected",!1),__publicField(this,"onclose",null),__publicField(this,"onnotice",(e=>console.debug(`NOTICE from ${this.url}: ${e}`))),__publicField(this,"_onauth",null),__publicField(this,"baseEoseTimeout",4400),__publicField(this,"connectionTimeout",4400),__publicField(this,"openSubs",new Map),__publicField(this,"connectionTimeoutHandle"),__publicField(this,"connectionPromise"),__publicField(this,"openCountRequests",new Map),__publicField(this,"openEventPublishes",new Map),__publicField(this,"ws"),__publicField(this,"incomingMessageQueue",new Rr),__publicField(this,"queueRunning",!1),__publicField(this,"challenge"),__publicField(this,"serial",0),__publicField(this,"verifyEvent"),__publicField(this,"_WebSocket"),this.url=function(e){-1===e.indexOf("://")&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket}static async connect(e,t){const n=new Tr(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((e,t)=>{this.connectionTimeoutHandle=setTimeout((()=>{var e;t("connection timed out"),this.connectionPromise=void 0,null==(e=this.onclose)||e.call(this),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void t(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=e=>{var n;t(e.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,null==(n=this.onclose)||n.call(this),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{var e;this._connected&&(this._connected=!1,this.connectionPromise=void 0,null==(e=this.onclose)||e.call(this),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;!1!==this.handleNext();)await Pr();this.queueRunning=!1}handleNext(){var e,t,n;const r=this.incomingMessageQueue.dequeue();if(!r)return!1;const o=function(e){let t=e.slice(0,22).indexOf('"EVENT"');if(-1===t)return null;let n=e.slice(t+7+1).indexOf('"');if(-1===n)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(-1===o)return null;let i=r+1+o;return e.slice(r+1,i)}(r);if(o){const n=this.openSubs.get(o);if(!n)return;const i=function(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}(r,"id"),s=null==(e=n.alreadyHaveEvent)?void 0:e.call(n,i);if(null==(t=n.receivedEvent)||t.call(n,this,i),s)return}try{let e=JSON.parse(r);switch(e[0]){case"EVENT":{const t=this.openSubs.get(e[1]),n=e[2];return void(this.verifyEvent(n)&&function(e,t){for(let n=0;n<e.length;n++)if(Mr(e[n],t))return!0;return!1}(t.filters,n)&&t.onevent(n))}case"COUNT":{const t=e[1],n=e[2],r=this.openCountRequests.get(t);return void(r&&(r.resolve(n.count),this.openCountRequests.delete(t)))}case"EOSE":{const t=this.openSubs.get(e[1]);if(!t)return;return void t.receivedEose()}case"OK":{const t=e[1],n=e[2],r=e[3],o=this.openEventPublishes.get(t);return n?o.resolve(r):o.reject(new Error(r)),void this.openEventPublishes.delete(t)}case"CLOSED":{const t=e[1],n=this.openSubs.get(t);if(!n)return;return n.closed=!0,void n.close(e[2])}case"NOTICE":return void this.onnotice(e[1]);case"AUTH":return this.challenge=e[1],void(null==(n=this._onauth)||n.call(this,e[1]))}}catch(i){return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{var t;null==(t=this.ws)||t.send(e)}))}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e((n=this.url,r=this.challenge,{kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",n],["challenge",r]],content:""}));var n,r;const o=new Promise(((e,n)=>{this.openEventPublishes.set(t.id,{resolve:e,reject:n})}));return this.send('["AUTH",'+JSON.stringify(t)+"]"),o}async publish(e){const t=new Promise(((t,n)=>{this.openEventPublishes.set(e.id,{resolve:t,reject:n})}));return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;const n=(null==t?void 0:t.id)||"count:"+this.serial,r=new Promise(((e,t)=>{this.openCountRequests.set(n,{resolve:e,reject:t})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||"sub:"+this.serial,r=new jr(this,n,e,t);return this.openSubs.set(n,r),r}close(){var e;this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,null==(e=this.ws)||e.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},jr=class{constructor(e,t,n,r){__publicField(this,"relay"),__publicField(this,"id"),__publicField(this,"closed",!1),__publicField(this,"eosed",!1),__publicField(this,"filters"),__publicField(this,"alreadyHaveEvent"),__publicField(this,"receivedEvent"),__publicField(this,"onevent"),__publicField(this,"oneose"),__publicField(this,"onclose"),__publicField(this,"eoseTimeout"),__publicField(this,"eoseTimeoutHandle"),this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(e=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,e)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){var e;this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,null==(e=this.oneose)||e.call(this))}close(e="closed by caller"){var t;!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),null==(t=this.onclose)||t.call(this,e)}};function Nr(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function qr(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Ur(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}const Dr="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,Fr=e=>e instanceof Uint8Array,Hr=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Vr=(e,t)=>e<<32-t|e>>>t;
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function Kr(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!Fr(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class Wr{clone(){return this._cloneInto()}}function Zr(e){const t=t=>e().update(Kr(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Gr(e=32){if(Dr&&"function"==typeof Dr.getRandomValues)return Dr.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}let Jr=class extends Wr{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Hr(this.buffer)}update(e){Ur(this);const{view:t,buffer:n,blockLen:r}=this,o=(e=Kr(e)).length;for(let i=0;i<o;){const s=Math.min(r-this.pos,o-i);if(s!==r)n.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=Hr(e);for(;r<=o-i;i+=r)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ur(this),function(e,t){qr(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:o}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let u=i;u<r;u++)t[u]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),a=Number(n&i),l=r?4:0,c=r?0:4;e.setUint32(t+l,s,r),e.setUint32(t+c,a,r)}(n,r-8,BigInt(8*this.length),o),this.process(n,0);const s=Hr(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=a/4,c=this.get();if(l>c.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)s.setUint32(4*u,c[u],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:o,destroyed:i,pos:s}=this;return e.length=r,e.pos=s,e.finished=o,e.destroyed=i,r%t&&e.buffer.set(n),e}};const Yr=(e,t,n)=>e&t^e&n^t&n,Qr=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Xr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),eo=new Uint32Array(64);let to=class extends Jr{constructor(){super(64,32,8,!1),this.A=0|Xr[0],this.B=0|Xr[1],this.C=0|Xr[2],this.D=0|Xr[3],this.E=0|Xr[4],this.F=0|Xr[5],this.G=0|Xr[6],this.H=0|Xr[7]}get(){const{A:e,B:t,C:n,D:r,E:o,F:i,G:s,H:a}=this;return[e,t,n,r,o,i,s,a]}set(e,t,n,r,o,i,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(e,t){for(let f=0;f<16;f++,t+=4)eo[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const e=eo[f-15],t=eo[f-2],n=Vr(e,7)^Vr(e,18)^e>>>3,r=Vr(t,17)^Vr(t,19)^t>>>10;eo[f]=r+eo[f-7]+n+eo[f-16]|0}let{A:n,B:r,C:o,D:i,E:s,F:a,G:l,H:c}=this;for(let f=0;f<64;f++){const e=c+(Vr(s,6)^Vr(s,11)^Vr(s,25))+((u=s)&a^~u&l)+Qr[f]+eo[f]|0,t=(Vr(n,2)^Vr(n,13)^Vr(n,22))+Yr(n,r,o)|0;c=l,l=a,a=s,s=i+e|0,i=o,o=r,r=n,n=e+t|0}var u;n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,a=a+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(n,r,o,i,s,a,l,c)}roundClean(){eo.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const no=Zr((()=>new to)),ro=BigInt(0),oo=BigInt(1),io=BigInt(2),so=e=>e instanceof Uint8Array,ao=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function lo(e){if(!so(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=ao[e[n]];return t}function co(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function uo(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function fo(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const t=2*r,o=e.slice(t,t+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function ho(e){return uo(lo(e))}function po(e){if(!so(e))throw new Error("Uint8Array expected");return uo(lo(Uint8Array.from(e).reverse()))}function go(e,t){return fo(e.toString(16).padStart(2*t,"0"))}function yo(e,t){return go(e,t).reverse()}function mo(e,t,n){let r;if("string"==typeof t)try{r=fo(t)}catch(i){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${i}`)}else{if(!so(t))throw new Error(`${e} must be hex string or Uint8Array`);r=Uint8Array.from(t)}const o=r.length;if("number"==typeof n&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return r}function vo(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!so(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}const bo=e=>(io<<BigInt(e-1))-oo,wo=e=>new Uint8Array(e),ko=e=>Uint8Array.from(e);function _o(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=wo(e),o=wo(e),i=0;const s=()=>{r.fill(1),o.fill(0),i=0},a=(...e)=>n(o,r,...e),l=(e=wo())=>{o=a(ko([0]),e),r=a(),0!==e.length&&(o=a(ko([1]),e),r=a())},c=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return vo(...n)};return(e,t)=>{let n;for(s(),l(e);!(n=t(c()));)l();return s(),n}}const xo={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function Eo(e,t,n={}){const r=(t,n,r)=>{const o=xo[n];if("function"!=typeof o)throw new Error(`Invalid validator "${n}", expected function`);const i=e[t];if(!(r&&void 0===i||o(i,e)))throw new Error(`Invalid param ${String(t)}=${i} (${typeof i}), expected ${n}`)};for(const[o,i]of Object.entries(t))r(o,i,!1);for(const[o,i]of Object.entries(n))r(o,i,!0);return e}const Ao=Object.freeze(Object.defineProperty({__proto__:null,bitGet:function(e,t){return e>>BigInt(t)&oo},bitLen:function(e){let t;for(t=0;e>ro;e>>=oo,t+=1);return t},bitMask:bo,bitSet:(e,t,n)=>e|(n?oo:ro)<<BigInt(t),bytesToHex:lo,bytesToNumberBE:ho,bytesToNumberLE:po,concatBytes:vo,createHmacDrbg:_o,ensureBytes:mo,equalBytes:function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},hexToBytes:fo,hexToNumber:uo,numberToBytesBE:go,numberToBytesLE:yo,numberToHexUnpadded:co,numberToVarBytesBE:function(e){return fo(co(e))},utf8ToBytes:function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))},validateObject:Eo},Symbol.toStringTag,{value:"Module"})),Co=BigInt(0),So=BigInt(1),zo=BigInt(2),Io=BigInt(3),Bo=BigInt(4),Oo=BigInt(5),Lo=BigInt(8);
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Mo(e,t){const n=e%t;return n>=Co?n:t+n}function $o(e,t,n){if(n<=Co||t<Co)throw new Error("Expected power/modulo > 0");if(n===So)return Co;let r=So;for(;t>Co;)t&So&&(r=r*e%n),e=e*e%n,t>>=So;return r}function Ro(e,t,n){let r=e;for(;t-- >Co;)r*=r,r%=n;return r}function Po(e,t){if(e===Co||t<=Co)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=Mo(e,t),r=t,o=Co,i=So;for(;n!==Co;){const e=r%n,t=o-i*(r/n);r=n,n=e,o=i,i=t}if(r!==So)throw new Error("invert: does not exist");return Mo(o,t)}function To(e){if(e%Bo===Io){const t=(e+So)/Bo;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%Lo===Oo){const t=(e-Oo)/Lo;return function(e,n){const r=e.mul(n,zo),o=e.pow(r,t),i=e.mul(n,o),s=e.mul(e.mul(i,zo),o),a=e.mul(i,e.sub(s,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-So)/zo;let n,r,o;for(n=e-So,r=0;n%zo===Co;n/=zo,r++);for(o=zo;o<e&&$o(o,t,e)!==e-So;o++);if(1===r){const t=(e+So)/Bo;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const i=(n+So)/zo;return function(e,s){if(e.pow(s,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,l=e.pow(e.mul(e.ONE,o),n),c=e.pow(s,i),u=e.pow(s,n);for(;!e.eql(u,e.ONE);){if(e.eql(u,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(u);t<a&&!e.eql(r,e.ONE);t++)r=e.sqr(r);const n=e.pow(l,So<<BigInt(a-t-1));l=e.sqr(n),c=e.mul(c,n),u=e.mul(u,l),a=t}return c}}(e)}BigInt(9),BigInt(16);const jo=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function No(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function qo(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Uo(e){const t=qo(e);return t+Math.ceil(t/2)}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const Do=BigInt(0),Fo=BigInt(1);function Ho(e){return Eo(e.Fp,jo.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),Eo(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...No(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const{bytesToNumberBE:Vo,hexToBytes:Ko}=Ao,Wo={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:t}=Wo;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Vo(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=Wo,n="string"==typeof e?Ko(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:o,l:i}=Wo._parseInt(n.subarray(2)),{d:s,l:a}=Wo._parseInt(i);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:s}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,n=e=>{const t=e.toString(16);return 1&t.length?`0${t}`:t},r=t(n(e.s)),o=t(n(e.r)),i=r.length/2,s=o.length/2,a=n(i),l=n(s);return`30${n(s+i+4)}02${l}${o}02${a}${r}`}},Zo=BigInt(0),Go=BigInt(1);BigInt(2);const Jo=BigInt(3);function Yo(e){const t=function(e){const t=Ho(e);Eo(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=t;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=t.toBytes||((e,t,r)=>{const o=t.toAffine();return vo(Uint8Array.from([4]),n.toBytes(o.x),n.toBytes(o.y))}),o=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function i(e){const{a:r,b:o}=t,i=n.sqr(e),s=n.mul(i,e);return n.add(n.add(s,n.mul(e,r)),o)}if(!n.eql(n.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function s(e){return"bigint"==typeof e&&Zo<e&&e<t.n}function a(e){if(!s(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:o,n:i}=t;if(n&&"bigint"!=typeof e){if(e instanceof Uint8Array&&(e=lo(e)),"string"!=typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let s;try{s="bigint"==typeof e?e:ho(mo("private key",e,r))}catch(l){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof e}`)}return o&&(s=Mo(s,i)),a(s),s}const c=new Map;function u(e){if(!(e instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof f)throw new Error("projective point not allowed");const o=e=>n.eql(e,n.ZERO);return o(t)&&o(r)?f.ZERO:new f(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(f.fromAffine)}static fromHex(e){const t=f.fromAffine(o(mo("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return f.BASE.multiply(l(e))}_setWindowSize(e){this._WINDOW_SIZE=e,c.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:e,y:r}=this.toAffine();if(!n.isValid(e)||!n.isValid(r))throw new Error("bad point: x or y not FE");const o=n.sqr(r),s=i(e);if(!n.eql(o,s))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){u(e);const{px:t,py:r,pz:o}=this,{px:i,py:s,pz:a}=e,l=n.eql(n.mul(t,a),n.mul(i,o)),c=n.eql(n.mul(r,a),n.mul(s,o));return l&&c}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,o=n.mul(r,Jo),{px:i,py:s,pz:a}=this;let l=n.ZERO,c=n.ZERO,u=n.ZERO,d=n.mul(i,i),h=n.mul(s,s),p=n.mul(a,a),g=n.mul(i,s);return g=n.add(g,g),u=n.mul(i,a),u=n.add(u,u),l=n.mul(e,u),c=n.mul(o,p),c=n.add(l,c),l=n.sub(h,c),c=n.add(h,c),c=n.mul(l,c),l=n.mul(g,l),u=n.mul(o,u),p=n.mul(e,p),g=n.sub(d,p),g=n.mul(e,g),g=n.add(g,u),u=n.add(d,d),d=n.add(u,d),d=n.add(d,p),d=n.mul(d,g),c=n.add(c,d),p=n.mul(s,a),p=n.add(p,p),d=n.mul(p,g),l=n.sub(l,d),u=n.mul(p,h),u=n.add(u,u),u=n.add(u,u),new f(l,c,u)}add(e){u(e);const{px:r,py:o,pz:i}=this,{px:s,py:a,pz:l}=e;let c=n.ZERO,d=n.ZERO,h=n.ZERO;const p=t.a,g=n.mul(t.b,Jo);let y=n.mul(r,s),m=n.mul(o,a),v=n.mul(i,l),b=n.add(r,o),w=n.add(s,a);b=n.mul(b,w),w=n.add(y,m),b=n.sub(b,w),w=n.add(r,i);let k=n.add(s,l);return w=n.mul(w,k),k=n.add(y,v),w=n.sub(w,k),k=n.add(o,i),c=n.add(a,l),k=n.mul(k,c),c=n.add(m,v),k=n.sub(k,c),h=n.mul(p,w),c=n.mul(g,v),h=n.add(c,h),c=n.sub(m,h),h=n.add(m,h),d=n.mul(c,h),m=n.add(y,y),m=n.add(m,y),v=n.mul(p,v),w=n.mul(g,w),m=n.add(m,v),v=n.sub(y,v),v=n.mul(p,v),w=n.add(w,v),y=n.mul(m,w),d=n.add(d,y),y=n.mul(k,w),c=n.mul(b,c),c=n.sub(c,y),y=n.mul(b,m),h=n.mul(k,h),h=n.add(h,y),new f(c,d,h)}subtract(e){return this.add(e.negate())}is0(){return this.equals(f.ZERO)}wNAF(e){return h.wNAFCached(this,c,e,(e=>{const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(f.fromAffine)}))}multiplyUnsafe(e){const r=f.ZERO;if(e===Zo)return r;if(a(e),e===Go)return this;const{endo:o}=t;if(!o)return h.unsafeLadder(this,e);let{k1neg:i,k1:s,k2neg:l,k2:c}=o.splitScalar(e),u=r,d=r,p=this;for(;s>Zo||c>Zo;)s&Go&&(u=u.add(p)),c&Go&&(d=d.add(p)),p=p.double(),s>>=Go,c>>=Go;return i&&(u=u.negate()),l&&(d=d.negate()),d=new f(n.mul(d.px,o.beta),d.py,d.pz),u.add(d)}multiply(e){a(e);let r,o,i=e;const{endo:s}=t;if(s){const{k1neg:e,k1:t,k2neg:a,k2:l}=s.splitScalar(i);let{p:c,f:u}=this.wNAF(t),{p:d,f:p}=this.wNAF(l);c=h.constTimeNegate(e,c),d=h.constTimeNegate(a,d),d=new f(n.mul(d.px,s.beta),d.py,d.pz),r=c.add(d),o=u.add(p)}else{const{p:e,f:t}=this.wNAF(i);r=e,o=t}return f.normalizeZ([r,o])[0]}multiplyAndAddUnsafe(e,t,n){const r=f.BASE,o=(e,t)=>t!==Zo&&t!==Go&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),i=o(this,t).add(o(e,n));return i.is0()?void 0:i}toAffine(e){const{px:t,py:r,pz:o}=this,i=this.is0();null==e&&(e=i?n.ONE:n.inv(o));const s=n.mul(t,e),a=n.mul(r,e),l=n.mul(o,e);if(i)return{x:n.ZERO,y:n.ZERO};if(!n.eql(l,n.ONE))throw new Error("invZ was invalid");return{x:s,y:a}}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===Go)return!0;if(n)return n(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===Go?this:n?n(f,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),r(f,this,e)}toHex(e=!0){return lo(this.toRawBytes(e))}}f.BASE=new f(t.Gx,t.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);const d=t.nBitLength,h=function(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,o=t;for(;n>Do;)n&Fo&&(r=r.add(o)),o=o.double(),n>>=Fo;return r},precomputeWindow(e,t){const{windows:n,windowSize:o}=r(t),i=[];let s=e,a=s;for(let r=0;r<n;r++){a=s,i.push(a);for(let e=1;e<o;e++)a=a.add(s),i.push(a);s=a.double()}return i},wNAF(t,o,i){const{windows:s,windowSize:a}=r(t);let l=e.ZERO,c=e.BASE;const u=BigInt(2**t-1),f=2**t,d=BigInt(t);for(let e=0;e<s;e++){const t=e*a;let r=Number(i&u);i>>=d,r>a&&(r-=f,i+=Fo);const s=t,h=t+Math.abs(r)-1,p=e%2!=0,g=r<0;0===r?c=c.add(n(p,o[s])):l=l.add(n(g,o[h]))}return{p:l,f:c}},wNAFCached(e,t,n,r){const o=e._WINDOW_SIZE||1;let i=t.get(e);return i||(i=this.precomputeWindow(e,o),1!==o&&t.set(e,r(i))),this.wNAF(o,i,n)}}}(f,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:f,normPrivateKeyToScalar:l,weierstrassEquation:i,isWithinCurveOrder:s}}function Qo(e){const t=function(e){const t=Ho(e);return Eo(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,o=n.BYTES+1,i=2*n.BYTES+1;function s(e){return Mo(e,r)}function a(e){return Po(e,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:u,isWithinCurveOrder:f}=Yo({...t,toBytes(e,t,r){const o=t.toAffine(),i=n.toBytes(o.x),s=vo;return r?s(Uint8Array.from([t.hasEvenY()?2:3]),i):s(Uint8Array.from([4]),i,n.toBytes(o.y))},fromBytes(e){const t=e.length,r=e[0],s=e.subarray(1);if(t!==o||2!==r&&3!==r){if(t===i&&4===r){return{x:n.fromBytes(s.subarray(0,n.BYTES)),y:n.fromBytes(s.subarray(n.BYTES,2*n.BYTES))}}throw new Error(`Point of length ${t} was invalid. Expected ${o} compressed bytes or ${i} uncompressed bytes`)}{const e=ho(s);if(!(Zo<(a=e)&&a<n.ORDER))throw new Error("Point is not on curve");const t=u(e);let o=n.sqrt(t);return!(1&~r)!==((o&Go)===Go)&&(o=n.neg(o)),{x:e,y:o}}var a}}),d=e=>lo(go(e,t.nByteLength));function h(e){return e>r>>Go}const p=(e,t,n)=>ho(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=mo("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=Wo.toSig(mo("DER",e));return new g(t,n)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r:r,s:o,recovery:i}=this,c=b(mo("msgHash",e));if(null==i||![0,1,2,3].includes(i))throw new Error("recovery id invalid");const u=2===i||3===i?r+t.n:r;if(u>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const f=1&i?"03":"02",h=l.fromHex(f+d(u)),p=a(u),g=s(-c*p),y=s(o*p),m=l.BASE.multiplyAndAddUnsafe(h,g,y);if(!m)throw new Error("point at infinify");return m.assertValidity(),m}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return fo(this.toDERHex())}toDERHex(){return Wo.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return fo(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(e){try{return c(e),!0}catch(t){return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const e=Uo(t.n);return function(e,t,n=!1){const r=e.length,o=qo(t),i=Uo(t);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);const s=Mo(n?ho(e):po(e),t-So)+So;return n?yo(s,o):go(s,o)}(t.randomBytes(e),t.n)},precompute:(e=8,t=l.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function m(e){const t=e instanceof Uint8Array,n="string"==typeof e,r=(t||n)&&e.length;return t?r===o||r===i:n?r===2*o||r===2*i:e instanceof l}const v=t.bits2int||function(e){const n=ho(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},b=t.bits2int_modN||function(e){return s(v(e))},w=bo(t.nBitLength);function k(e){if("bigint"!=typeof e)throw new Error("bigint expected");if(!(Zo<=e&&e<w))throw new Error(`bigint expected < 2^${t.nBitLength}`);return go(e,t.nByteLength)}function _(e,r,o=x){if(["recovered","canonical"].some((e=>e in o)))throw new Error("sign() legacy options not supported");const{hash:i,randomBytes:u}=t;let{lowS:d,prehash:p,extraEntropy:y}=o;null==d&&(d=!0),e=mo("msgHash",e),p&&(e=mo("prehashed msgHash",i(e)));const m=b(e),w=c(r),_=[k(w),k(m)];if(null!=y){const e=!0===y?u(n.BYTES):y;_.push(mo("extraEntropy",e))}const E=vo(..._),A=m;return{seed:E,k2sig:function(e){const t=v(e);if(!f(t))return;const n=a(t),r=l.BASE.multiply(t).toAffine(),o=s(r.x);if(o===Zo)return;const i=s(n*s(A+o*w));if(i===Zo)return;let c=(r.x===o?0:2)|Number(r.y&Go),u=i;return d&&h(i)&&(u=function(e){return h(e)?s(-e):e}(i),c^=1),new g(o,u,c)}}}const x={lowS:t.lowS,prehash:!1},E={lowS:t.lowS,prehash:!1};return l.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return l.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(m(e))throw new Error("first arg must be private key");if(!m(t))throw new Error("second arg must be public key");return l.fromHex(t).multiply(c(e)).toRawBytes(n)},sign:function(e,n,r=x){const{seed:o,k2sig:i}=_(e,n,r),s=t;return _o(s.hash.outputLen,s.nByteLength,s.hmac)(o,i)},verify:function(e,n,r,o=E){var i;const c=e;if(n=mo("msgHash",n),r=mo("publicKey",r),"strict"in o)throw new Error("options.strict was renamed to lowS");const{lowS:u,prehash:f}=o;let d,h;try{if("string"==typeof c||c instanceof Uint8Array)try{d=g.fromDER(c)}catch(x){if(!(x instanceof Wo.Err))throw x;d=g.fromCompact(c)}else{if("object"!=typeof c||"bigint"!=typeof c.r||"bigint"!=typeof c.s)throw new Error("PARSE");{const{r:e,s:t}=c;d=new g(e,t)}}h=l.fromHex(r)}catch(A){if("PARSE"===A.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(u&&d.hasHighS())return!1;f&&(n=t.hash(n));const{r:p,s:y}=d,m=b(n),v=a(y),w=s(m*v),k=s(p*v),_=null==(i=l.BASE.multiplyAndAddUnsafe(h,w,k))?void 0:i.toAffine();return!!_&&s(_.x)===p},ProjectivePoint:l,Signature:g,utils:y}}BigInt(4);class Xo extends Wr{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Nr(e.outputLen),Nr(e.blockLen)}(e);const n=Kr(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,o=new Uint8Array(r);o.set(n.length>r?e.create().update(n).digest():n);for(let i=0;i<o.length;i++)o[i]^=54;this.iHash.update(o),this.oHash=e.create();for(let i=0;i<o.length;i++)o[i]^=106;this.oHash.update(o),o.fill(0)}update(e){return Ur(this),this.iHash.update(e),this}digestInto(e){Ur(this),qr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:o,blockLen:i,outputLen:s}=this;return e.finished=r,e.destroyed=o,e.blockLen=i,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ei=(e,t,n)=>new Xo(e,t).update(n).digest();
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
function ti(e){return{hash:e,hmac:(t,...n)=>ei(e,t,function(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!Fr(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}(...n)),randomBytes:Gr}}ei.create=(e,t)=>new Xo(e,t);
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const ni=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),ri=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),oi=BigInt(1),ii=BigInt(2),si=(e,t)=>(e+t/ii)/t;function ai(e){const t=ni,n=BigInt(3),r=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),a=BigInt(44),l=BigInt(88),c=e*e*e%t,u=c*c*e%t,f=Ro(u,n,t)*u%t,d=Ro(f,n,t)*u%t,h=Ro(d,ii,t)*c%t,p=Ro(h,o,t)*h%t,g=Ro(p,i,t)*p%t,y=Ro(g,a,t)*g%t,m=Ro(y,l,t)*y%t,v=Ro(m,a,t)*g%t,b=Ro(v,n,t)*u%t,w=Ro(b,s,t)*p%t,k=Ro(w,r,t)*c%t,_=Ro(k,ii,t);if(!li.eql(li.sqr(_),e))throw new Error("Cannot find square root");return _}const li=function(e,t,n=!1,r={}){if(e<=Co)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:i}=No(e,t);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=To(e),a=Object.freeze({ORDER:e,BITS:o,BYTES:i,MASK:bo(o),ZERO:Co,ONE:So,create:t=>Mo(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return Co<=t&&t<e},is0:e=>e===Co,isOdd:e=>(e&So)===So,neg:t=>Mo(-t,e),eql:(e,t)=>e===t,sqr:t=>Mo(t*t,e),add:(t,n)=>Mo(t+n,e),sub:(t,n)=>Mo(t-n,e),mul:(t,n)=>Mo(t*n,e),pow:(e,t)=>function(e,t,n){if(n<Co)throw new Error("Expected power > 0");if(n===Co)return e.ONE;if(n===So)return t;let r=e.ONE,o=t;for(;n>Co;)n&So&&(r=e.mul(r,o)),o=e.sqr(o),n>>=So;return r}(a,e,t),div:(t,n)=>Mo(t*Po(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>Po(t,e),sqrt:r.sqrt||(e=>s(a,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,o)=>e.is0(r)?t:(n[o]=t,e.mul(t,r))),e.ONE),o=e.inv(r);return t.reduceRight(((t,r,o)=>e.is0(r)?t:(n[o]=e.mul(t,n[o]),e.mul(t,r))),o),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?yo(e,i):go(e,i),fromBytes:e=>{if(e.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${e.length}`);return n?po(e):ho(e)}});return Object.freeze(a)}(ni,void 0,void 0,{sqrt:ai}),ci=function(e,t){const n=t=>Qo({...e,...ti(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:li,n:ri,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=ri,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-oi*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,s=BigInt("0x100000000000000000000000000000000"),a=si(i*e,t),l=si(-r*e,t);let c=Mo(e-a*n-l*o,t),u=Mo(-a*r-l*i,t);const f=c>s,d=u>s;if(f&&(c=t-c),d&&(u=t-u),c>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:f,k1:c,k2neg:d,k2:u}}}},no),ui=BigInt(0),fi=e=>"bigint"==typeof e&&ui<e&&e<ni,di=e=>"bigint"==typeof e&&ui<e&&e<ri,hi={};function pi(e,...t){let n=hi[e];if(void 0===n){const t=no(Uint8Array.from(e,(e=>e.charCodeAt(0))));n=vo(t,t),hi[e]=n}return no(vo(n,...t))}const gi=e=>e.toRawBytes(!0).slice(1),yi=e=>go(e,32),mi=e=>Mo(e,ni),vi=e=>Mo(e,ri),bi=ci.ProjectivePoint,wi=(e,t,n)=>bi.BASE.multiplyAndAddUnsafe(e,t,n);function ki(e){let t=ci.utils.normPrivateKeyToScalar(e),n=bi.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:vi(-t),bytes:gi(n)}}function _i(e){if(!fi(e))throw new Error("bad x: need 0 < x < p");const t=mi(e*e);let n=ai(mi(t*e+BigInt(7)));n%ii!==ui&&(n=mi(-n));const r=new bi(e,n,oi);return r.assertValidity(),r}function xi(...e){return vi(ho(pi("BIP0340/challenge",...e)))}function Ei(e){return ki(e).bytes}function Ai(e,t,n=Gr(32)){const r=mo("message",e),{bytes:o,scalar:i}=ki(t),s=mo("auxRand",n,32),a=yi(i^ho(pi("BIP0340/aux",s))),l=pi("BIP0340/nonce",a,o,r),c=vi(ho(l));if(c===ui)throw new Error("sign failed: k is zero");const{bytes:u,scalar:f}=ki(c),d=xi(u,o,r),h=new Uint8Array(64);if(h.set(u,0),h.set(yi(vi(f+d*i)),32),!Ci(h,r,o))throw new Error("sign: Invalid signature produced");return h}function Ci(e,t,n){const r=mo("signature",e,64),o=mo("message",t),i=mo("publicKey",n,32);try{const e=_i(ho(i)),t=ho(r.subarray(0,32));if(!fi(t))return!1;const n=ho(r.subarray(32,64));if(!di(n))return!1;const s=xi(yi(t),gi(e),o),a=wi(e,n,vi(-s));return!(!a||!a.hasEvenY()||a.toAffine().x!==t)}catch(s){return!1}}const Si=(()=>({getPublicKey:Ei,sign:Ai,verify:Ci,utils:{randomPrivateKey:ci.utils.randomPrivateKey,lift_x:_i,pointToBytes:gi,numberToBytesBE:go,bytesToNumberBE:ho,taggedHash:pi,mod:Mo}}))();function zi(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Ii(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}const Bi={number:zi,bool:function(e){if("boolean"!=typeof e)throw new Error(`Expected boolean, not ${e}`)},bytes:Ii,hash:function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");zi(e.outputLen),zi(e.blockLen)},exists:function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},output:function(e,t){Ii(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}};class Oi extends ke{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ge(this.buffer)}update(e){Bi.exists(this);const{view:t,buffer:n,blockLen:r}=this,o=(e=we(e)).length;for(let i=0;i<o;){const s=Math.min(r-this.pos,o-i);if(s!==r)n.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=ge(e);for(;r<=o-i;i+=r)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Bi.exists(this),Bi.output(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:o}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let u=i;u<r;u++)t[u]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),a=Number(n&i),l=r?4:0,c=r?0:4;e.setUint32(t+l,s,r),e.setUint32(t+c,a,r)}(n,r-8,BigInt(8*this.length),o),this.process(n,0);const s=ge(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=a/4,c=this.get();if(l>c.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)s.setUint32(4*u,c[u],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:o,destroyed:i,pos:s}=this;return e.length=r,e.pos=s,e.finished=o,e.destroyed=i,r%t&&e.buffer.set(n),e}}const Li=(e,t,n)=>e&t^e&n^t&n,Mi=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),$i=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ri=new Uint32Array(64);class Pi extends Oi{constructor(){super(64,32,8,!1),this.A=0|$i[0],this.B=0|$i[1],this.C=0|$i[2],this.D=0|$i[3],this.E=0|$i[4],this.F=0|$i[5],this.G=0|$i[6],this.H=0|$i[7]}get(){const{A:e,B:t,C:n,D:r,E:o,F:i,G:s,H:a}=this;return[e,t,n,r,o,i,s,a]}set(e,t,n,r,o,i,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(e,t){for(let f=0;f<16;f++,t+=4)Ri[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const e=Ri[f-15],t=Ri[f-2],n=ye(e,7)^ye(e,18)^e>>>3,r=ye(t,17)^ye(t,19)^t>>>10;Ri[f]=r+Ri[f-7]+n+Ri[f-16]|0}let{A:n,B:r,C:o,D:i,E:s,F:a,G:l,H:c}=this;for(let f=0;f<64;f++){const e=c+(ye(s,6)^ye(s,11)^ye(s,25))+((u=s)&a^~u&l)+Mi[f]+Ri[f]|0,t=(ye(n,2)^ye(n,13)^ye(n,22))+Li(n,r,o)|0;c=l,l=a,a=s,s=i+e|0,i=o,o=r,r=n,n=e+t|0}var u;n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,a=a+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(n,r,o,i,s,a,l,c)}roundClean(){Ri.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Ti extends Pi{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const ji=_e((()=>new Pi));_e((()=>new Ti));var Ni=Symbol("verified"),qi=e=>e instanceof Object;new TextDecoder("utf-8");var Ui=new TextEncoder;function Di(e){if(!function(e){if(!qi(e))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Fi(e){return ve(ji(Ui.encode(Di(e))))}var Hi=new class{generateSecretKey(){return Si.utils.randomPrivateKey()}getPublicKey(e){return ve(Si.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=ve(Si.getPublicKey(t)),n.id=Fi(n),n.sig=ve(Si.sign(Fi(n),t)),n[Ni]=!0,n}verifyEvent(e){if("boolean"==typeof e[Ni])return e[Ni];const t=Fi(e);if(t!==e.id)return e[Ni]=!1,!1;try{const n=Si.verify(e.sig,t,e.pubkey);return e[Ni]=n,n}catch(n){return e[Ni]=!1,!1}}};Hi.generateSecretKey,Hi.getPublicKey,Hi.finalizeEvent;var Vi=Hi.verifyEvent,Ki=Symbol("verified"),Wi=e=>e instanceof Object;new TextDecoder("utf-8");var Zi=new TextEncoder;function Gi(e){if(!function(e){if(!Wi(e))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Ji(e){return ve(ji(Zi.encode(Gi(e))))}var Yi=new class{generateSecretKey(){return Si.utils.randomPrivateKey()}getPublicKey(e){return ve(Si.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=ve(Si.getPublicKey(t)),n.id=Ji(n),n.sig=ve(Si.sign(Ji(n),t)),n[Ki]=!0,n}verifyEvent(e){if("boolean"==typeof e[Ki])return e[Ki];const t=Ji(e);if(t!==e.id)return e[Ki]=!1,!1;try{const n=Si.verify(e.sig,t,e.pubkey);return e[Ki]=n,n}catch(n){return e[Ki]=!1,!1}}};function Qi(e){let t=0;for(let n=0;n<e.length;n++){const r=parseInt(e[n],16);if(0!==r){t+=Math.clz32(r)-28;break}t+=4}return t}function Xi(e){const t=e.length;if(0===t)return 0;const n=e.toSorted(((e,t)=>e-t)),r=Math.floor(t/2);return t%2==0?Math.floor((n[r-1]+n[r])/2):n[r]}function es(e,t){if(0===e.length)return;const n=function(e){if(0===e.length)return;let t=0,n=e[0];for(let r=1;r<e.length;r++)e[r]>n&&(n=e[r],t=r);return t}(e.map(t));return e[n]}Yi.generateSecretKey,Yi.getPublicKey,Yi.finalizeEvent,Yi.verifyEvent;const ts=86400,ns=604800,rs=()=>Math.round(Date.now()/1e3),os=(e,t=!1)=>e.sort(((e,n)=>{const r=(e.ts||0)-(n.ts||0),o=0!==r?r:e.id.localeCompare(n.id);return t?o:-o})),is=async(e,t,n)=>{const r=await Er(e,IDBKeyRange.only(t))||{id:t,addedAt:rs(),used:!1};if(!r.used){let o,i;if("eventsBlocked"===e){const e=await Er("events",IDBKeyRange.only(t));e&&(o=await Er("pubkeysBlocked",IDBKeyRange.only(e.pk)))}if(o)Sr("pubkeysBlocked",{...o,used:!0});else{const t=r.reason||n;Sr(e,{...r,used:!0,reason:t})}if("eventsBlocked"===e)i=[t];else if("pubkeysBlocked"===e){i=(await xr("events",t,{index:"pk"})).map((e=>e.id))}i&&zr("events",i)}},ss=async()=>{if(!ir.community||!ir.anchorAuthor)return;const e=ir.community&&await Er("communities",IDBKeyRange.only(ir.community)),t=e?e.l+1:0,n=rs();if(e&&n<t+ts)return;(await ks.querySync(ir.readRelays,{kinds:[34550],authors:[ir.anchorAuthor],"#d":[ir.community],since:t})).forEach((e=>{if(34550===e.kind){const t=e.tags.filter((e=>e.length>=4&&"p"===e[0]&&"moderator"===e[3])).map((e=>e[1]));Sr("communities",{community:ir.community,moderators:t,l:rs()},{immediate:!0})}}))},as=async()=>{const e=rs();return Math.max(...await Promise.all(["eventsBlocked","pubkeysBlocked"].map((async t=>{const n=t.replace("Blocked",""),r=ir.blocks[n];let o=0;const i=[],s=await xr(t);for(const a of s)o=Math.max(o,a.addedAt),!a.used&&e>=a.addedAt+ns?i.push(a.id):r.add(a.id);return zr(t,i),o}))))},ls=async e=>{if(ir.disableFeatures.includes("spamNostrBand"))return;const t=rs();if(t<e+ts)return;await Promise.allSettled(["eventsBlocked","pubkeysBlocked"].map((async e=>{try{const n=e.replace("Blocked",""),r=Os(`https://spam.nostr.band/spam_api?method=get_current_spam&view=${n}`),o=ir.blocks[n],i=await r;if(200===i.status){(await i.json())[`cluster_${n}`].map((e=>e[n])).flat().filter((e=>!o.has(e))).forEach((r=>{o.add(r),Sr(e,{id:r,addedAt:t,used:!1,reason:`Block-listed ${n.slice(0,-1)} by spam.nostr.band`})}))}}catch(n){console.error(n)}}))),console.log("[zapthreads] updated spam.nostr.band")},cs=async()=>{const e=ir.community&&await Er("communities",IDBKeyRange.only(ir.community)),t=e?e.l:0;return ir.moderators.clear(),ir.anchorAuthor&&ir.moderators.add(ir.anchorAuthor),e&&e.moderators.forEach((e=>ir.moderators.add(e))),t},us=async()=>{await cs();const e=sr.active?[sr.active.pk]:[],t=[...ir.moderators,...e];(await ks.querySync(ir.readRelays,{kinds:[Oe,$e],authors:t})).forEach((e=>{e.kind===Oe?fs(e.tags):e.kind===$e&&ds(e.tags)}))},fs=e=>{const t=e.filter((e=>e.length>=2&&"p"===e[0])).map((e=>e[1]));if(!(t.length>0&&0===t.filter((e=>ir.moderators.has(e))).length))return;const n=e.filter((e=>e.length>=3&&"e"===e[0]));n.length>0?n.forEach((e=>is("eventsBlocked",e[1],e[2]))):e.filter((e=>e.length>=3&&"p"===e[0])).forEach((e=>is("pubkeysBlocked",e[1],e[2])))},ds=e=>{const t=e.filter((e=>2===e.length)),n=t.filter((e=>"p"===e[0])).map((e=>e[1])),r=t.filter((e=>"e"===e[0])).map((e=>e[1]));n.forEach((e=>is("pubkeysBlocked",e,"Mute-listed user"))),r.forEach((e=>is("eventsBlocked",e,"Mute-listed event")))},hs=()=>ys(window.nostr)?window.nostr:void 0;async function ps(e,t){if(ys(window.nostr))return window.nostr;const n=new AbortController,{signal:r}=n,o=[new Promise(((e,r)=>{var o;null==(o=null==t?void 0:t.signal)||o.addEventListener("abort",(()=>{var e,o;n.abort(null==(e=t.signal)?void 0:e.reason);try{null==(o=null==t?void 0:t.signal)||o.throwIfAborted()}catch(i){return void r(i)}r(new Error("aborted unexpectedly"))}))})),gs({signal:r})];var i;return"number"==typeof e&&Number.isFinite(e)&&e>0&&o.push((i={signal:r,timeoutMs:e},new Promise((e=>{var t;const n=setTimeout((()=>{e(void 0)}),i.timeoutMs);null==(t=i.signal)||t.addEventListener("abort",(()=>{clearTimeout(n)}))})))),function(){const e=Object.getOwnPropertyDescriptor(window,"nostr");if(!e)return!0;return e.configurable??!1}()&&o.push(function(){let e=window.nostr;return new Promise((t=>{Object.defineProperty(window,"nostr",{configurable:!0,get:()=>e,set:n=>{ys(n)&&t(n),e=n}})}))}()),Promise.race(o).then((e=>(n.abort("teardown"),e)))}function gs(e){return new Promise((t=>{var n;const r=function(e){let t,n=0,r=0;const o=()=>{n+=r,r=n<1e3?10:n<5e3?100:1e3},i=()=>{o(),t=setTimeout((()=>{e(),i()}),r)},s=()=>{clearTimeout(t)};return i(),s}((()=>{const e=hs();e&&(t(e),r())}));null==(n=e.signal)||n.addEventListener("abort",r)}))}function ys(e){if(!e)return!1;const t=e;try{const e="getPublicKey"in t&&("function"==typeof t.getPublicKey||"object"==typeof t.getPublicKey),n="signEvent"in t&&("function"==typeof t.signEvent||"object"==typeof t.signEvent);return e&&n}catch{return!1}}const ms=[1,Me],vs=[...ms,7,Le],bs=["wss://purplepag.es/","wss://hist.nostr.land"],ws=Math.max(5600,6e3);const ks=new class{constructor(e){__publicField(this,"relays",new Map),__publicField(this,"seenOn",new Map),__publicField(this,"verifyEvent"),__publicField(this,"_WebSocket"),__publicField(this,"eventsCount",{}),__publicField(this,"eventsTs",{}),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation}async ensureRelay(e){let t=this.relays.get(e);return t||(t=new Tr(e,{verifyEvent:this.verifyEvent,websocketImplementation:this._WebSocket}),t.connectionTimeout=ws,t._onauth=t=>{ir.readRelays.includes(e)&&this.updateRelayInfo(e,{readAuth:!0})},this.relays.set(e,t)),await t.connect(),t}close(e){e.forEach((e=>{var t;null==(t=this.relays.get(e))||t.close()}))}async updateRelays(e){const t=e=>{const t=Object.values(e);return!(!t.find((e=>e.read))||!t.find((e=>e.write)))};let n=!1;const r=!(!sr.active||!window.nostr);let o={};const i=async()=>{const e=sr.active.pk,n=es(await this.querySync([...ir.readRelays,...bs],{authors:[e],kinds:[10002]}),(e=>e.created_at)),r=n?n.tags:[],o=Object.fromEntries(r.filter((e=>e.length>=2&&"r"===e[0])).map((e=>{let t={read:!0,write:!0};if(3===e.length){t["read"===e[2]?"write":"read"]=!1}return[e[1],t]})));return t(o)&&Sr("profileRelays",{pk:e,relays:JSON.stringify(o)}),o};if(r){const e=sr.active.pk;if(o=await window.nostr.getRelays(),!t(o)){const t=await Er("profileRelays",IDBKeyRange.only(e));t&&(o=JSON.parse(t.relays))}t(o)||(n=!0,o=await i())}const s=r&&t(o)?o:Object.fromEntries((e||"").split(",").map((e=>[e,{read:!0,write:r}]))),a=Object.fromEntries(Object.entries(s).map((([e,t])=>[e.trim(),t])).filter((([e,t])=>e.length>0)).map((([e,t])=>[Lr(new URL(e).toString()),t]))),l=Object.entries(a),c=l.filter((([e,t])=>t.read)).map((([e,t])=>e));var u,f,d;u=ir,d=e=>{e.writeRelays=l.filter((([e,t])=>t.write)).map((([e,t])=>e)),JSON.stringify(e.readRelays)!==JSON.stringify(c)&&(e.readRelays=c)},f=e=>{if(vn(e)){let t;(t=Rn.get(e))||Rn.set(e,t=new Proxy(e,Pn)),d(t)}return e},C((()=>f(bn(u)))),console.log(`[zapthreads] readRelays=${JSON.stringify(ir.readRelays)} writeRelays=${JSON.stringify(ir.writeRelays)}`),await this.updateWritePow(),r&&!n&&i()}async subscribeMany(e,t,n){return await this.subscribeManyMap(Object.fromEntries(e.map((e=>[e,t]))),n)}async subscribeManyMap(e,t){const{fastRelays:n,slowRelays:r,ranks:o}=await Ss(Object.keys(e)),i=new Set([...n,r]),s=[];for(const[m,v]of Object.entries(e)){if(!i.has(m))continue;const e=[];for(const t of v)e.push({...t,since:await this.getSince(m,t)});s.push({url:m,filters:e,maxSince:Math.max(...e.map((e=>e.since))),latency:o.get(m)})}console.log(`[zapthreads] subscribing to ${s.length} relays (${Object.keys(e).length-s.length} failing)`),s.sort(((e,t)=>e.latency!==t.latency?e.latency-t.latency:e.maxSince!==t.maxSince?e.maxSince-t.maxSince:0)),t.receivedEvent=(e,t)=>{let n=this.seenOn.get(t);n||(n=new Set,this.seenOn.set(t,n)),n.add(e.url),this.eventsCount[e.url]=(this.eventsCount[e.url]||0)+1};const a=new Set,l=[],c=[];let u=e=>{var n;c[e]=!0,c.filter((e=>e)).length===s.length&&(null==(n=t.oneose)||n.call(t),u=()=>{})};const f=[];let d=(e,n,r)=>{var o;"connection timed out"===r||"websocket error"===r?_s(n,1/0):r.includes("blocked")||"relay connection errored"===r?_s(n,1/0,-1,!0):r.includes("auth")?this.updateRelayInfo(n,{readAuth:!0}):r.includes("write-only")&&this.updateRelayInfo(n,{writeOnly:!0}),u(e),f[e]=r,f.filter((e=>e)).length===s.length&&(null==(o=t.onclose)||o.call(t,f),d=()=>{})};const h=e=>{var n;if(null==(n=t.alreadyHaveEvent)?void 0:n.call(t,e))return!0;const r=a.has(e);return a.add(e),r},p=s.map((async({url:e,filters:n,latency:r},o)=>{let i;console.log(`[zapthreads] subscribing on ${e} with estimated latency ${Math.floor(r)} ms`);try{i=await this.ensureRelay(e)}catch(f){const t=Gs(f)||"";return console.log(`[zapthreads] ${e} closed ${t}`),void d(o,e,t)}const s=this.eventsCount[e]||0,a=Date.now(),c=i.subscribe(n,{...t,onevent:r=>{var o;n.filter((e=>function(e,t){if(e.ids&&-1===e.ids.indexOf(t.id))return!1;if(e.kinds&&-1===e.kinds.indexOf(t.kind))return!1;if(e.authors&&-1===e.authors.indexOf(t.pubkey))return!1;for(let n in e)if("#"===n[0]){let r=e[`#${n.slice(1)}`];if(r&&!t.tags.find((([e,t])=>e===n.slice(1)&&-1!==r.indexOf(t))))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}(e,r))).forEach((t=>this.saveSince(e,t,r.created_at))),null==(o=t.onevent)||o.call(t,r)},oneose:()=>{var n;const r=Date.now()-a,i=(this.eventsCount[e]||0)-s;delete this.eventsCount[e];const l=r/Math.max(1,i);_s(e,l),null==(n=t.oneoseOnRelay)||n.call(t,e),u(o)},onclose:t=>d(o,e,t),alreadyHaveEvent:h,eoseTimeout:t.maxWait});l.push(c)})),g=Date.now(),y=Promise.allSettled(p).then((e=>{console.log(`[zapthreads] processed subscriptions in ${Date.now()-g} ms`)}));return{async close(){await y,l.forEach((e=>{e.close()}))}}}async subscribeManyEose(e,t,n){const r=rs()+900,o=await this.subscribeMany(e,t.map((e=>e.until?e:{...e,until:r})),{...n,oneose(){o.close()}});return o}async querySync(e,t,n){return new Promise((async r=>{const o=[];await this.subscribeManyEose(e,[t],{...n,onevent(e){o.push(e)},onclose(e){r(o)}})}))}async publishEvent(e){const t=ir.writeRelays,{fastRelays:n,slowRelays:r,offlineRelays:o,unsupported:i}=await Ss(t,{event:e,write:!0});if(console.log(`[zapthreads] publishing to ${n.length+r.length} relays`+(i+o>0?` (ignored ${i} unsupported, ${o} failing)`:"")),ir.onPublish&&!(await ir.onPublish({relays:[...n,...r]})).accepted)return{ok:0,failures:0};const s=await this.concurrentPublish(e,n);return this.concurrentPublish(e,r),s}async concurrentPublish(e,t){if(0===t.length)return{ok:0,failures:0};const n=Date.now(),r=t.map((async t=>await this.publishOnRelay(t,e))),o=await Promise.allSettled(r),i=Date.now()-n,{ok:s,failures:a}=Bs(o,t);return console.log(`[zapthreads] event ${e.id} published in ${i} ms to ${s} relays (${a} failed)`,t),{ok:s,failures:a}}async estimateWriteRelayLatencies(){const e=async e=>{var t;if(null==(t=this.relays.get(e))?void 0:t.connected)return;if((await xr("relayStats",e,{index:"name"})).length>=5)return;const n=Date.now();let r=1/0;try{await this.ensureRelay(e);r=Date.now()-n}finally{_s(e,r)}},t=ir.writeRelays.map((async t=>await e(t)));await Promise.allSettled(t)}async publishOnRelay(e,t){const n=Date.now();let r=1/0;try{const o=await this.ensureRelay(e);await o.publish(t),r=Date.now()-n}finally{_s(e,r,t.kind)}}async updateRelayInfos(){var e;if(ir.disableFeatures.includes("relayInformation"))return;const t=rs(),n=[],{fastRelays:r,slowRelays:o,offlineRelays:i}=await Ss([...ir.readRelays,...ir.writeRelays]);for(const c of[...r,...o])if(null==(e=this.relays.get(c))?void 0:e.connected){const e=await Er("relayInfos",IDBKeyRange.only(c));Is(t,e)&&n.push(c)}if(0===n.length)return;const s=await Promise.allSettled(n.map((async e=>{let n;try{const t=await zs(e);As(t),Cs(void 0,t),n=t}catch(r){const t=(null==r?void 0:r.message)||String(r);console.info(`[zapthreads] info for ${e} failed with "${t}"`)}await Sr("relayInfos",{name:e,info:n,l:t})}))),{ok:a,failures:l}=Bs(s,n);console.log(`[zapthreads] updated infos for ${a} relays (${l} failed)`),await Ir((async()=>await this.updateWritePow()))}async updateRelayInfo(e,t){const n=await Er("relayInfos",IDBKeyRange.only(e))||{};await Sr("relayInfos",{...n,...t,name:e})}async updateWritePow(){const e=await Promise.all(ir.writeRelays.map((async e=>{var t,n;const r=null==(t=await Er("relayInfos",IDBKeyRange.only(e)))?void 0:t.info;return(null==(n=null==r?void 0:r.limitation)?void 0:n.min_pow_difficulty)||0})));ir.writePowDifficulty=Math.max(ir.minReadPow,...e)}async getSince(e,t){if(t.since)return t.since;if(!ir.anchor)return 0;const n=Ts(e,t);if(void 0!==this.eventsTs[n])return this.eventsTs[n];const r=await Er("requestFilters",IDBKeyRange.only(n));if(!r)return 0;const o=rs(),i=r.l+3600<o;return Math.max(0,i?r.l+1:r.l-3600)}saveSince(e,t,n){var r;if(!ir.anchor||(null==(r=t.kinds)?void 0:r.includes(0)))return;const o=Ts(e,t),i=Math.max(this.eventsTs[o]||0,n);this.eventsTs[o]=i,Sr("requestFilters",{key:o,l:i})}}({verifyEvent:Vi,websocketImplementation:void 0}),_s=async(e,t,n=-1,r=!1)=>{const o=es((await xr("relayStats",e,{index:"name"})).filter((e=>e.kind===n)),(e=>e.ts));Sr("relayStats",{name:e,kind:n,serial:o?(o.serial+(r?0:1))%5:0,latency:t,ts:rs()})},xs=(e,t,n)=>{if(0===n)return!0;let r=0;if("number"==typeof t)r=t;else if("object"==typeof t){const e=t.find((e=>e.length>2&&"nonce"===e[0]));r=e&&+e[2]||0}return r>=n&&Qi(e)>=n},Es=e=>!0===(null==e?void 0:e.writeOnly),As=(e,t)=>{if(!0===(null==t?void 0:t.readAuth))return!1;if(!e)return!0;const n=ir.language;return!(n&&e.language_tags&&e.language_tags.length>0&&!e.language_tags.includes(n))},Cs=(e,t)=>{if(!t)return!0;if(!As(t))return!1;const n=t.retention;if(n){const t=e?e.kind:1;if(!(0===n.filter((e=>{const n=e.time&&0===e.time||e.count&&0===e.count,r=e.kinds&&e.kinds.includes(t),o=e.kinds&&e.kinds.filter((e=>Array.isArray(e))).map((e=>e)).map((e=>2==e.length&&t>=e[0]&&t<=e[1])).length>0;return n&&(r||o)})).length))return!1}const r=t.limitation,o=ir.maxWritePow;if(r){if(r.auth_required&&r.auth_required)return!1;if(r.payment_required&&r.payment_required)return!1;if(r.min_pow_difficulty&&(o&&o<r.min_pow_difficulty||e&&!xs(e.id,e.tags,r.min_pow_difficulty)))return!1;if(r.max_content_length&&e&&e.content.length>r.max_content_length)return!1;if(r.max_message_length&&e&&('["EVENT",'+JSON.stringify(e)+"]").length>r.max_message_length)return!1}return!0},Ss=async(e,t)=>{const n=rs();let r=-1;t&&t.kind?r=t.kind:t&&t.event&&(r=t.event.kind);const o=(null==t?void 0:t.write)||!1;let i=[];const s=[];let a=0,l=0;const c=new Map;for(const f of new Set(e)){const e=await Er("relayInfos",IDBKeyRange.only(f));if(e)try{if(!o&&(!As(null==e?void 0:e.info,e)||Es(e))||o&&!Cs(null==t?void 0:t.event,null==e?void 0:e.info)){l++;continue}}catch(u){}const d=await xr("relayStats",f,{index:"name"}),h=Xi(d.map((e=>e.latency))),p=d.filter((e=>e.kind===r)),g=Xi(p.map((e=>e.latency))),y=p.length>0?es(p,(e=>e.ts)):es(d,(e=>e.ts)),m=p.length>0?g:h;c.set(f,m),m===1/0?y&&y.latency===1/0&&n<y.ts+30?a++:s.push(f):i.push({relayUrl:f,latency:m})}return i=i.sort(((e,t)=>e.latency-t.latency)).map((({relayUrl:e})=>e)),0===i.length?{fastRelays:s,slowRelays:[],offlineRelays:0,ranks:c,unsupported:l}:{fastRelays:i,slowRelays:s,offlineRelays:a,unsupported:l,ranks:c}},zs=async e=>{if(!ir.disableFeatures.includes("relayInformation"))return await(await Os(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()},Is=(e,t)=>{const n=t&&t.l;return!n||e>n+ns},Bs=(e,t)=>{var n;let r=0,o=0;for(let i=0;i<e.length;i++)if("fulfilled"===e[i].status)r++;else{const r=null==(n=e[i])?void 0:n.reason;console.error(t[i],(null==r?void 0:r.message)||String(r)),o++}return{ok:r,failures:o}},Os=(e,t)=>fetch(e,{...t,signal:AbortSignal.timeout(ws)}),Ls=async(e,t)=>{ir.client&&0===e.tags.filter((e=>e.length>0&&"client"===e[0])).length&&e.tags.push(["client",ir.client]);const n=ir.writePowDifficulty;let r;if(n>0){const o=function(e,t){let n=0;const r=e,o=["nonce",n.toString(),t.toString()];for(r.tags.push(o);;){const e=Math.floor((new Date).getTime()/1e3);if(e!==r.created_at&&(n=0,r.created_at=e),o[1]=(++n).toString(),r.id=Ji(r),Qi(r.id)>=t)break}return r}(e,n),i=await t.signEvent(o);r={...o,...i}}else{const n=Fi(e),o=await t.signEvent(e);r={id:n,...e,...o}}return console.log(JSON.stringify(r,null,2)),r},Ms=async(e,t)=>{const n=await Ls(e,t),{ok:r,failures:o}=await ks.publishEvent(n);return{ok:r,failures:o,event:n}},$s=async()=>{if(sr.active)return sr.active;let e,t=!1;const n=await xr("sessions",0,{index:"autoLogin"});if(n.length>0)if(window.nostr){console.log("[zapthreads] nip-07 became available, trying to re-enable auto-login");try{e=await window.nostr.getPublicKey()}catch(i){console.error(i),console.log("[zapthreads] cannot retrieve pubkey, removing old sessions"),zr("sessions",n.map((e=>e.pk)))}n.find((t=>t.pk===e))&&(t=!0,console.log("[zapthreads] re-enabling auto-login"))}else{console.log("[zapthreads] nip-07 is probably removed");const e=await xr("sessions",0,{index:"autoLogin"});e.length>0&&console.log("[zapthreads] disabling auto-login"),e.forEach((e=>Sr("sessions",{...e,autoLogin:0})))}const{accepted:r,autoLogin:o}=ir.onLogin?await ir.onLogin({knownUser:t}):{accepted:!0,autoLogin:!1};if(r){if(!window.nostr)throw new Error("No NIP-07 extension!");return e||(e=await window.nostr.getPublicKey()),sr.active={pk:e,signEvent:async e=>await window.nostr.signEvent(e)},sr.active.signEvent||console.error("User has no signer!"),(!0===o||t)&&(console.log("[zapthreads] saving session"),Sr("sessions",{pk:e,autoLogin:1})),await ks.updateRelays(),sr.active}e&&(console.log("[zapthreads] removing session",e),zr("sessions",[e]))},Rs=e=>{const{e:t,rankable:n,minReadPow:r,upvotes:o,downvotes:i}=e,s=Ks(t);Ps({id:t.id,pubkey:t.pk,kind:t.k,powOrTags:t.pow,content:t.c},r);return{...ir.onEvent?ir.onEvent({rankable:n,kind:t.k,content:Us(t,ir),replies:s,upvotes:o,downvotes:i,client:t.client,language:t.language,pow:t.pow}):{sanitizedContent:t.c,rank:void 0,showReportButton:!1},noteEvent:t}},Ps=(e,t)=>{const n=e.id&&ir.blocks.events.has(e.id);n&&is("eventsBlocked",e.id);const r=ir.blocks.pubkeys.has(e.pubkey);if(r&&is("pubkeysBlocked",e.pubkey),n)throw new Error("Block-listed event");if(r)throw new Error("Block-listed user");if(!e.content.trim()&&e.content.length>ir.maxCommentLength)throw new Error("Invalid message length");if(void 0!==e.id&&void 0!==t&&!xs(e.id,e.powOrTags,t))throw new Error("NIP-13 PoW is not okay")},Ts=(e,t)=>{const n=["since","until","limit"],r=Object.fromEntries(Object.entries(t).filter((([e,t])=>!n.includes(e))).sort()),o=[e,ir.anchor.value,r];return ve(ji(JSON.stringify(o)))},js=async(e,t,n)=>{const r=+new Date,o=n.map((e=>[e.pk,e])),i=new Map(o),s=new Set([...e].filter((e=>{const t=i.get(e);return!((null==t?void 0:t.l)&&t.l>r-216e5)})).filter((e=>!!e)));if(0===s.size)return;const a=Math.min(...o.filter((([e,t])=>s.has(e))).map((([e,t])=>t.l?t.l+1:0))),{fastRelays:l,slowRelays:c}=await Ss(t,{kind:0}),u=[{kinds:[0],authors:[...s],since:a===1/0?0:a}],f=async e=>{0!==e.length&&await ks.subscribeManyEose([...e,...bs],u,{onevent(e){const t=e.pubkey;if(s.has(t))try{const n=JSON.parse(e.content),o={pk:t,ts:e.created_at,i:n.image||n.picture,n:n.displayName||n.display_name||n.name},s=i.get(t);if(!s||!(null==s?void 0:s.i)||!(null==s?void 0:s.n)||s.ts<o.ts){const e=s?{...s,...o,l:r}:{...o,l:r};i.set(t,e),Sr("profiles",e),console.log(`[zapthreads] updated profile ${t}`)}}catch(n){console.error(n)}}})};await f(l),f(c)},Ns=new RegExp("(?<=^|\\s)@?((naddr|npub|nevent|note)[a-z0-9]{20,})","g"),qs=/\B\#([a-zA-Z0-9]+\b)(?!;)/g,Us=(e,t,n=[])=>{let r=e.c;const o=t.urlPrefixes,i=t.profiles,s=[...new Set(e.t)];if(s.length>0){const e=new RegExp(`(^|\\s)\\#(${s.join("|")})`,"gi");r=r.replaceAll(e,`$1[#$2](${o.tag}$2)`)}r=r.replaceAll(Ns,"nostr:$1"),r=function(e,t){return e.replaceAll(Ue(),((e,n)=>t({uri:e,value:n,decoded:Te(n)})))}(r,(({decoded:e,value:t})=>{switch(e.type){case"nprofile":let r=i().find((t=>t.pk===e.data.pubkey));return`[@${(null==r?void 0:r.n)||Fs(t)}](${o.nprofile}${t})`;case"npub":let s=i().find((t=>t.pk===e.data));return`[@${(null==s?void 0:s.n)||Fs(t)}](${o.npub}${t})`;case"note":return`[@${Fs(t)}](${o.note}${t})`;case"naddr":const a=e.data,l=n.find((e=>e.pk===a.pubkey&&e.d===a.identifier));return l&&l.tl?`[${l.tl}](${o.naddr}${t})`:`[@${Fs(t)}](${o.naddr}${t})`;case"nevent":return`[@${Fs(t)}](${o.nevent}${t})`;default:return t}}));return new fn("full",{linkTarget:"_blank",typographer:!0,quotes:"ru"===e.language?"«»‘’":"“”‘’"}).render(r.trim())},Ds=e=>{const t=[],n=function*(e){const t=e.matchAll(Ue());for(const r of t)try{const[e,t]=r;yield{uri:e,value:t,decoded:Te(t),start:r.index,end:r.index+e.length}}catch(n){}}(e);for(const i of n){if("npub"===i.decoded.type&&t.push(["p",i.decoded.data]),"naddr"===i.decoded.type){const e=i.decoded.data;t.push(["a",`${e.kind}:${e.pubkey}:${e.identifier}`,"","mention"])}"nevent"===i.decoded.type&&t.push(["e",i.decoded.data.id]),"note"===i.decoded.type&&t.push(["e",i.decoded.data])}const r=e.matchAll(qs),o=new Set([...r].map((e=>e[1].toLowerCase())));for(const i of o)t.push(["t",i]);return t},Fs=e=>e.substring(0,8)+"..."+e.substring(e.length-4),Hs=20,Vs='data:image/svg+xml;utf-8,<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><circle cx="512" cy="512" r="512" fill="%23333" fill-rule="evenodd" /></svg>',Ks=e=>e.children.reduce(((e,t)=>e+Ks(t)),e.children.length),Ws=/\/+$/,Zs=(e,t=!0)=>{const n=new URL(e);return n.hash="",t&&(n.pathname=n.pathname.replace(Ws,"")),n.toString()},Gs=e=>{const t=e;return(null==t?void 0:t.message)||String(null==t?void 0:t.reason)},Js=(e,t)=>{let n=e.map((e=>({...e,children:[]})));const r=new Set(n.filter((e=>{if(t){const n=t.id===(e.re||e.ro);return n&&(e.parent=t),n}return!n.find((t=>t.id===(e.re||e.ro)))})));n=n.filter((e=>!r.has(e)));for(let o of r)o.children.push(...Js(n,o));return[...r]};function Ys(e){const[t,n]=w(e);return e=>void 0===e?t():n(e)}function Qs(e){return e(!e())}var Xs=J("<div class=ztr-comment-info-picture><img>"),ea=J("<div class=ztr-reply-form><textarea></textarea><div class=ztr-reply-controls>"),ta=J("<span> Comment is limited to <!> characters; you entered <!>."),na=J("<span>Publishing is disabled"),ra=J("<span class=ztr-reply-error>"),oa=J('<svg class=ztr-spinner viewBox="0 0 50 50"><circle class=path cx=25 cy=25 r=20 fill=none stroke-width=5>'),ia=J("<button class=ztr-reply-button>Reply as "),sa=J("<button class=ztr-reply-login-button><div style=display:inline-grid;vertical-align:middle></div>&nbsp;Login"),aa=J("<li class=ztr-comment-action-like><span> likes"),la=J("<li class=ztr-comment-action-zap><span> sats"),ca=J("<div class=ztr-comment-new><div class=ztr-comment-body><ul class=ztr-comment-actions>");const ua=e=>{const t=()=>e.comment(),n=t=>e.comment(t),[r,o]=w(!1),[i,s]=w(),[a,l]=w(""),c=()=>ir.anchor,u=ir.profiles;x((async()=>{if(sr.active){const e=sr.active.pk;let t=u().find((t=>t.pk===e));t||(t={pk:e,l:0,ts:0},await Sr("profiles",t)),s(t),js(new Set([e]),ir.readRelays,u())}else s()}));const f=async(t,r)=>{var i;o(!1),n(""),l(r??""),await Sr("events",gr(t),{immediate:!0}),null==(i=e.onDone)||i.call(void 0)},d=e=>{o(!1),l(e)},h=async n=>{let r;if(!n)return;if(r=sr.active,!(null==r?void 0:r.signEvent))return void d("User has no signer!");const i=t().trim();if(!i)return;const s={kind:1,created_at:rs(),content:i,pubkey:r.pk,tags:Ds(i)};try{((e,t)=>{const n=!1;ms.includes(e.kind)?Rs({e:{...gr(e),children:[]},rankable:n,minReadPow:t,upvotes:0,downvotes:0}):(Ps({id:e.id,pubkey:e.pubkey,kind:e.kind,powOrTags:e.tags,content:e.content},t),ir.onEvent?ir.onEvent({rankable:n,kind:e.kind,content:e.content,client:pr(e.tags),replies:0,upvotes:0,downvotes:0,pow:ir.writePowDifficulty}):e.content)})({...s,id:void 0})}catch(a){return void d(Gs(a))}if(ir.anchorAuthor&&ir.anchorAuthor!==s.pubkey&&s.tags.push(["p",ir.anchorAuthor]),ir.externalAuthor)try{const e=Ce(ir.externalAuthor).data;s.tags.push(["p",e])}catch(l){}if(e.replyTo){const t=await Er("events",IDBKeyRange.only(e.replyTo));t&&(console.log("[zapthreads] publishing reply"),s.tags.push(["e",t.ro,"","root"]),t.pk!==s.pubkey&&s.tags.push(["p",t.pk])),s.tags.push(["e",e.replyTo,"","reply"])}else{const e=ir.version||ir.rootEventIds[0];if(e)s.tags.push(["e",e,"","root"]);else if("http"===c().type){const e=Lr(c().value),t={pubkey:r.pk,created_at:rs(),kind:8812,tags:[["r",e]],content:`Comments on ${e} ↴`},n=await Ls(t,r);Sr("events",gr(n)),ir.disableFeatures.includes("publish")?console.log("Publishing root event disabled",n):(console.log("publishing root event"),ks.publishEvent(n)),ir.filter={"#e":[n.id]},s.tags.push(["e",n.id,"","root"])}}if("naddr"===c().type&&s.tags.push(["a",c().value,"","root"]),ir.language&&(s.tags.push(["L","ISO-639-1"]),s.tags.push(["l",ir.language,"ISO-639-1"])),o(!0),ir.disableFeatures.includes("publish")){const e=await Ls(s,r);setTimeout((()=>f(e)),1e3)}else{const{ok:e,failures:t,event:n}=await Ms(s,r);if(0===e)d("Your comment was not published to any relay");else{const r=`Published to ${e}/${ir.writeRelays.length} relays (see console for more info)`;f(n,t>0?r:void 0)}}},p=void 0!==e.replyTo;let g;(e=>{x((()=>{const t=e();t&&setTimeout((()=>t.focus()))}))})((()=>p&&g));const y=()=>ir.maxCommentLength,m=()=>t().length>y();return(()=>{var e=ea(),o=e.firstChild,s=o.nextSibling;o.$$input=e=>n(e.target.value);var c,u,f,v,b;return"function"==typeof g?X(g,o):g=o,o.autofocus=p,ee(e,(c=E((()=>t().length>.98*y())),()=>{return c()&&(e=ta(),n=e.firstChild,r=n.nextSibling,(o=r.nextSibling.nextSibling).nextSibling,ee(e,Qa,n),ee(e,y,r),ee(e,(()=>t().length),o),_((()=>e.classList.toggle("ztr-reply-error",!!m()))),e);var e,n,r,o}),s),ee(s,(u=E((()=>!!ir.disableFeatures.includes("publish"))),()=>u()&&na()),null),ee(s,(f=E((()=>!!a())),()=>{return f()&&(ee(e=ra(),a),e);var e}),null),ee(s,K(Z,{get when(){return!r()},get fallback(){return oa()},get children(){var e=Xs(),t=e.firstChild;return _((()=>{var e;return Q(t,"src",(null==(e=i())?void 0:e.i)||Vs)})),e}}),null),ee(s,(v=E((()=>!!i())),()=>{return v()&&((e=ia()).firstChild,e.$$click=()=>h(i()),ee(e,(()=>i().n||Fs(ze(i().pk))),null),_((()=>e.disabled=r()||m())),e);var e}),null),ee(s,(b=E((()=>!i())),()=>{return b()&&(e=sa(),t=e.firstChild,e.$$click=()=>(async()=>{try{await $s(),l("")}catch(e){d(Gs(e))}})(),ee(t,qa),e);var e,t}),null),_((e=>{var t=r(),n=ir.replyPlaceholder||"Add your comment...",i=!!m();return t!==e.e&&(o.disabled=e.e=t),n!==e.t&&Q(o,"placeholder",e.t=n),i!==e.a&&o.classList.toggle("too-long",e.a=i),e}),{e:void 0,t:void 0,a:void 0}),_((()=>o.value=t())),e})()},fa=()=>{const e=()=>ir.anchor,t=_r((()=>["aggregates",IDBKeyRange.only([e().value,9735])])),n=_r((()=>["aggregates",IDBKeyRange.only([e().value,7])])),r=()=>{var e;return(null==(e=n())?void 0:e.ids.length)??0},o=Ys("");return i=ca(),s=i.firstChild,ee(a=s.firstChild,K(Z,{get when(){return!ir.disableFeatures.includes("likes")},get children(){var e=aa(),t=e.firstChild,n=t.firstChild;return ee(e,Fa,t),ee(t,r,n),e}}),null),ee(a,K(Z,{get when(){return!ir.disableFeatures.includes("zaps")},get children(){var e=la(),n=e.firstChild,r=n.firstChild;return ee(e,Da,n),ee(n,(()=>{return(e=(null==(n=t())?void 0:n.sum)??0)<1e4?e.toString():e<1e6?Math.round(e/1e3)+"k":Math.round(e/1e6)+"M";var e,n}),r),e}}),null),ee(s,K(ua,{comment:o}),null),i;var i,s,a};Y(["input","click"]);var da=J("<div class=ztr-thread>"),ha=J("<li class=ztr-comment-action-reply><span>"),pa=J("<div class=ztr-comment><div class=ztr-comment-body><div class=ztr-comment-info-wrapper><div class=ztr-comment-info><div class=ztr-comment-info-picture><img></div><ul class=ztr-comment-info-items><li class=ztr-comment-info-author><a target=_blank></a><span style=white-space:nowrap;><a target=_blank style=font-weight:400><small>ed </small></a></span></li></ul></div></div><div class=ztr-comment-text></div><ul class=ztr-comment-actions></ul></div><div class=ztr-comment-replies><div class=ztr-comment-replies-info-actions>"),ga=J("<div class=ztr-comment-text><p class=warning><span>This is a <!> that referenced this article in <a>another thread"),ya=J("<div class=ztr-comment-text><p class=warning><span>Article contents may have changed since this <!> was made"),ma=J("<div class=ztr-comment-text><p class=warning><span>Article contents changed since this <!> was made"),va=J("<div class=ztr-comment-expand><span>"),ba=J("<span>"),wa=J("<li class=ztr-comment-action-upvote>"),ka=J("<li class=ztr-comment-action-votes><span>"),_a=J("<li class=ztr-comment-action-downvote>"),xa=J("<li class=ztr-comment-action-remove>"),Ea=J("<li class=ztr-comment-action-report>"),Aa=J("<ul class=ztr-comment-replies-info-items><li><span></span></li><li> repl"),Ca=J('<svg width=40 height=46 viewBox="0 0 525 600"fill=none xmlns=http://www.w3.org/2000/svg><path d="M442.711 254.675C454.209 334.323 371.764 351.177 324.332 349.703C321.286 349.608 318.416 351.091 316.617 353.55C311.71 360.258 303.867 368.932 297.812 368.932C291.012 368.932 284.892 382.009 282.101 390.146C281.808 391 282.648 391.788 283.507 391.509C358.626 367.118 388.103 358.752 400.801 361.103C411.052 363.001 430.226 397.321 438.532 414.244C417.886 415.43 411.005 396.926 406.259 393.604C402.462 390.947 401.038 403.094 400.801 409.499C396.292 407.127 390.597 403.806 390.122 393.604C389.648 383.403 384.427 386.013 380.393 386.487C376.359 386.962 314.423 406.89 305.169 409.499C295.914 412.109 285.235 415.667 276.455 421.836C261.743 428.953 252.251 423.971 249.64 411.872C247.552 402.192 261.11 372.411 268.15 358.731C259.449 361.973 241.382 368.552 238.724 368.932C236.147 369.3 203.454 394.539 185.97 408.253C184.95 409.053 184.294 410.225 184.059 411.499C181.262 426.698 172.334 430.952 156.856 438.917C144.4 445.326 100.9 512.174 78.5318 548.261C76.9851 550.756 74.7151 552.673 72.2776 554.31C58.0697 563.847 43.5996 588.121 37.7308 600C29.3778 575.897 40.262 555.162 46.7482 547.808C43.9006 545.341 37.3353 546.78 34.4086 547.808C42.4768 520.051 70.7156 520.051 69.7664 520.051C74.987 515.544 136.211 428.004 137.634 423.971C139.047 419.97 136.723 401.262 167.494 391.005C167.982 390.842 168.467 390.619 168.9 390.34C192.873 374.933 210.857 350.094 216.893 339.514C184.887 337.314 148.236 319.47 129.072 308.008C124.941 305.538 120.56 303.387 115.777 302.846C89.5384 299.876 63.2668 316.661 52.6808 326.229C48.3144 320.156 53.2345 302.506 56.2403 294.44C45.6092 292.921 29.979 308.357 23.4928 316.265C16.4687 305.258 22.6227 285.583 26.5777 277.121C12.5295 277.501 3.00581 283.922 0 287.085C11.6277 200.494 100.569 225.677 101.565 226.827C96.8187 221.893 97.2142 215.44 98.0052 212.83C151.872 214.254 177.026 205.239 192.925 195.986C318.22 126.002 372.206 168.942 392.139 179.736C412.073 190.53 448.261 194.919 473.296 184.955C503.196 171.432 498.695 136.577 492.636 123.274C485.992 108.683 448.498 88.5179 435.209 63.0154C421.921 37.5129 433.5 6.50012 448.895 2.17754C463.562 -1.94096 474.037 2.85041 482.076 10.1115C487.436 14.9524 502.484 18.4148 508.773 20.6685C515.061 22.9223 525.502 25.8877 524.909 27.667C524.316 29.4463 514.249 29.2088 512.688 29.2088C509.485 29.2088 505.688 29.6833 509.485 31.4626C513.937 33.2682 520.657 35.8924 523.875 37.6198C524.294 37.8443 524.207 38.4293 523.749 38.5526C501.912 44.4295 482.414 32.3029 467.957 46.2898C453.244 60.524 484.568 71.4369 500.704 88.5179C516.841 105.599 533.452 126.001 520.163 172.5C509.875 208.497 466.758 239.103 444.486 251.075C443.205 251.764 442.503 253.235 442.711 254.675Z">'),Sa=J('<svg viewBox="0 -6 60 60"xmlns=http://www.w3.org/2000/svg><path d="M 12.6030 50.4905 C 13.3758 50.4905 13.9307 50.1140 14.8621 49.2421 L 20.6483 43.8720 C 19.5188 42.9803 18.6073 41.5733 18.6073 38.3433 L 18.6073 25.2052 C 18.6073 19.1217 22.3129 15.5152 28.3766 15.5152 L 42.2479 15.5152 L 42.2281 14.7622 C 41.9306 10.6999 39.2557 8.0643 34.7177 8.0643 L 7.5301 8.0643 C 2.9922 8.0643 0 10.7791 0 15.4954 L 0 34.9548 C 0 39.6710 2.9922 42.7028 7.5301 42.7028 L 10.8195 42.7028 L 10.8195 48.4693 C 10.8195 49.6979 11.4735 50.4905 12.6030 50.4905 Z M 44.6058 53.2450 C 45.7353 53.2450 46.3895 52.4325 46.3895 51.2237 L 46.3895 45.4374 L 48.4702 45.4374 C 53.0078 45.4374 56 42.4056 56 37.7092 L 56 25.6610 C 56 20.9250 53.0078 18.2300 48.4702 18.2300 L 28.8522 18.2300 C 24.1161 18.2300 21.3221 20.9250 21.3221 25.6610 L 21.3221 37.7092 C 21.3221 42.4056 24.1161 45.4374 28.8522 45.4374 L 35.1735 45.4374 L 42.3470 51.9767 C 43.2784 52.8487 43.8331 53.2450 44.6058 53.2450 Z">'),za=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="-120 -80 528 588"><path d="M349.4 44.6c5.9-13.7 1.5-29.7-10.6-38.5s-28.6-8-39.9 1.8l-256 224c-10 8.8-13.6 22.9-8.9 35.3S50.7 288 64 288H175.5L98.6 467.4c-5.9 13.7-1.5 29.7 10.6 38.5s28.6 8 39.9-1.8l256-224c10-8.8 13.6-22.9 8.9-35.3s-16.6-20.7-30-20.7H272.5L349.4 44.6z">'),Ia=J('<svg viewBox="0 -16 180 180"xmlns=http://www.w3.org/2000/svg><path d="M60.732 29.7C41.107 29.7 22 39.7 22 67.41c0 27.29 45.274 67.29 74 94.89 28.744-27.6 74-67.6 74-94.89 0-27.71-19.092-37.71-38.695-37.71C116 29.7 104.325 41.575 96 54.066 87.638 41.516 76 29.7 60.732 29.7z">'),Ba=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 512 512"><path d="M323.8 34.8c-38.2-10.9-78.1 11.2-89 49.4l-5.7 20c-3.7 13-10.4 25-19.5 35l-51.3 56.4c-8.9 9.8-8.2 25 1.6 33.9s25 8.2 33.9-1.6l51.3-56.4c14.1-15.5 24.4-34 30.1-54.1l5.7-20c3.6-12.7 16.9-20.1 29.7-16.5s20.1 16.9 16.5 29.7l-5.7 20c-5.7 19.9-14.7 38.7-26.6 55.5c-5.2 7.3-5.8 16.9-1.7 24.9s12.3 13 21.3 13L448 224c8.8 0 16 7.2 16 16c0 6.8-4.3 12.7-10.4 15c-7.4 2.8-13 9-14.9 16.7s.1 15.8 5.3 21.7c2.5 2.8 4 6.5 4 10.6c0 7.8-5.6 14.3-13 15.7c-8.2 1.6-15.1 7.3-18 15.2s-1.6 16.7 3.6 23.3c2.1 2.7 3.4 6.1 3.4 9.9c0 6.7-4.2 12.6-10.2 14.9c-11.5 4.5-17.7 16.9-14.4 28.8c.4 1.3 .6 2.8 .6 4.3c0 8.8-7.2 16-16 16H286.5c-12.6 0-25-3.7-35.5-10.7l-61.7-41.1c-11-7.4-25.9-4.4-33.3 6.7s-4.4 25.9 6.7 33.3l61.7 41.1c18.4 12.3 40 18.8 62.1 18.8H384c34.7 0 62.9-27.6 64-62c14.6-11.7 24-29.7 24-50c0-4.5-.5-8.8-1.3-13c15.4-11.7 25.3-30.2 25.3-51c0-6.5-1-12.8-2.8-18.7C504.8 273.7 512 257.7 512 240c0-35.3-28.6-64-64-64l-92.3 0c4.7-10.4 8.7-21.2 11.8-32.2l5.7-20c10.9-38.2-11.2-78.1-49.4-89zM32 192c-17.7 0-32 14.3-32 32V448c0 17.7 14.3 32 32 32H96c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32H32z">'),Oa=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 512 512"><path d="M323.8 477.2c-38.2 10.9-78.1-11.2-89-49.4l-5.7-20c-3.7-13-10.4-25-19.5-35l-51.3-56.4c-8.9-9.8-8.2-25 1.6-33.9s25-8.2 33.9 1.6l51.3 56.4c14.1 15.5 24.4 34 30.1 54.1l5.7 20c3.6 12.7 16.9 20.1 29.7 16.5s20.1-16.9 16.5-29.7l-5.7-20c-5.7-19.9-14.7-38.7-26.6-55.5c-5.2-7.3-5.8-16.9-1.7-24.9s12.3-13 21.3-13L448 288c8.8 0 16-7.2 16-16c0-6.8-4.3-12.7-10.4-15c-7.4-2.8-13-9-14.9-16.7s.1-15.8 5.3-21.7c2.5-2.8 4-6.5 4-10.6c0-7.8-5.6-14.3-13-15.7c-8.2-1.6-15.1-7.3-18-15.2s-1.6-16.7 3.6-23.3c2.1-2.7 3.4-6.1 3.4-9.9c0-6.7-4.2-12.6-10.2-14.9c-11.5-4.5-17.7-16.9-14.4-28.8c.4-1.3 .6-2.8 .6-4.3c0-8.8-7.2-16-16-16H286.5c-12.6 0-25 3.7-35.5 10.7l-61.7 41.1c-11 7.4-25.9 4.4-33.3-6.7s-4.4-25.9 6.7-33.3l61.7-41.1c18.4-12.3 40-18.8 62.1-18.8H384c34.7 0 62.9 27.6 64 62c14.6 11.7 24 29.7 24 50c0 4.5-.5 8.8-1.3 13c15.4 11.7 25.3 30.2 25.3 51c0 6.5-1 12.8-2.8 18.7C504.8 238.3 512 254.3 512 272c0 35.3-28.6 64-64 64l-92.3 0c4.7 10.4 8.7 21.2 11.8 32.2l5.7 20c10.9 38.2-11.2 78.1-49.4 89zM32 384c-17.7 0-32-14.3-32-32V128c0-17.7 14.3-32 32-32H96c17.7 0 32 14.3 32 32V352c0 17.7-14.3 32-32 32H32z">'),La=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 512 512"><path d="M313.4 32.9c26 5.2 42.9 30.5 37.7 56.5l-2.3 11.4c-5.3 26.7-15.1 52.1-28.8 75.2H464c26.5 0 48 21.5 48 48c0 18.5-10.5 34.6-25.9 42.6C497 275.4 504 288.9 504 304c0 23.4-16.8 42.9-38.9 47.1c4.4 7.3 6.9 15.8 6.9 24.9c0 21.3-13.9 39.4-33.1 45.6c.7 3.3 1.1 6.8 1.1 10.4c0 26.5-21.5 48-48 48H294.5c-19 0-37.5-5.6-53.3-16.1l-38.5-25.7C176 420.4 160 390.4 160 358.3V320 272 247.1c0-29.2 13.3-56.7 36-75l7.4-5.9c26.5-21.2 44.6-51 51.2-84.2l2.3-11.4c5.2-26 30.5-42.9 56.5-37.7zM32 192H96c17.7 0 32 14.3 32 32V448c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32V224c0-17.7 14.3-32 32-32z">'),Ma=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 512 512"><path d="M313.4 479.1c26-5.2 42.9-30.5 37.7-56.5l-2.3-11.4c-5.3-26.7-15.1-52.1-28.8-75.2H464c26.5 0 48-21.5 48-48c0-18.5-10.5-34.6-25.9-42.6C497 236.6 504 223.1 504 208c0-23.4-16.8-42.9-38.9-47.1c4.4-7.3 6.9-15.8 6.9-24.9c0-21.3-13.9-39.4-33.1-45.6c.7-3.3 1.1-6.8 1.1-10.4c0-26.5-21.5-48-48-48H294.5c-19 0-37.5 5.6-53.3 16.1L202.7 73.8C176 91.6 160 121.6 160 153.7V192v48 24.9c0 29.2 13.3 56.7 36 75l7.4 5.9c26.5 21.2 44.6 51 51.2 84.2l2.3 11.4c5.2 26 30.5 42.9 56.5 37.7zM32 384H96c17.7 0 32-14.3 32-32V128c0-17.7-14.3-32-32-32H32C14.3 96 0 110.3 0 128V352c0 17.7 14.3 32 32 32z">'),$a=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 448 512"><path d="M170.5 51.6L151.5 80l145 0-19-28.4c-1.5-2.2-4-3.6-6.7-3.6l-93.7 0c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6L354.2 80 368 80l48 0 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-8 0 0 304c0 44.2-35.8 80-80 80l-224 0c-44.2 0-80-35.8-80-80l0-304-8 0c-13.3 0-24-10.7-24-24S10.7 80 24 80l8 0 48 0 13.8 0 36.7-55.1C140.9 9.4 158.4 0 177.1 0l93.7 0c18.7 0 36.2 9.4 46.6 24.9zM80 128l0 304c0 17.7 14.3 32 32 32l224 0c17.7 0 32-14.3 32-32l0-304L80 128zm80 64l0 208c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-208c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0l0 208c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-208c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0l0 208c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-208c0-8.8 7.2-16 16-16s16 7.2 16 16z">'),Ra=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 448 512"><path d="M48 24C48 10.7 37.3 0 24 0S0 10.7 0 24L0 64 0 350.5 0 400l0 88c0 13.3 10.7 24 24 24s24-10.7 24-24l0-100 80.3-20.1c41.1-10.3 84.6-5.5 122.5 13.4c44.2 22.1 95.5 24.8 141.7 7.4l34.7-13c12.5-4.7 20.8-16.6 20.8-30l0-279.7c0-23-24.2-38-44.8-27.7l-9.6 4.8c-46.3 23.2-100.8 23.2-147.1 0c-35.1-17.6-75.4-22-113.5-12.5L48 52l0-28zm0 77.5l96.6-24.2c27-6.7 55.5-3.6 80.4 8.8c54.9 27.4 118.7 29.7 175 6.8l0 241.8-24.4 9.1c-33.7 12.6-71.2 10.7-103.4-5.4c-48.2-24.1-103.3-30.1-155.6-17.1L48 338.5l0-237z">'),Pa=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 448 512"><path d="M201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z">'),Ta=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 448 512"><path d="M201.4 137.4c12.5-12.5 32.8-12.5 45.3 0l160 160c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L224 205.3 86.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l160-160z">'),ja=J('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 512 512"><path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480H40c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24V296c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z">');const Na=e=>{const t=()=>e.articles(),n=ir.profiles,r=()=>ir.userObservedComments,o=e=>{const n=ir.commentContexts.get(e.id);if(n)return n;{const[n,r]=w(),o=Us(e,ir,t()),i={thread:{collapsed:n,setCollapsed:r,trigger:()=>r(!n())},text:{value:o,overflowed:Ys(void 0),collapsed:Ys(!0)},votes:{upvotesCount:Ys(0),downvotesCount:Ys(0)},reply:{text:Ys(""),isOpen:Ys(!1)}};return ir.commentContexts.set(e.id,i),i}},i=t=>{const n=[],r=[],i=!!e.firstLevelComments;for(const e of t){let t=0,a=!1;try{const{upvotesCount:n,downvotesCount:r}=o(e).votes,s=Rs({e:e,rankable:i,minReadPow:ir.minReadPow,upvotes:n(),downvotes:r()});a=!0,i&&(t=ir.ranks.get(e.id)||s.rank||0,ir.ranks.set(e.id,t)),!0===s.showReportButton&&ir.showReportButton.add(e.id)}catch(s){is("eventsBlocked",e.id,Gs(s)),r.push(e.id)}a&&n.push({rank:t,e:e})}return n},s=()=>[...i(os(e.topNestedEvents(),!e.firstLevelComments)).sort(((t,n)=>e.firstLevelComments?n.rank-t.rank:0)).map((({e:e})=>e)),...i(e.bottomNestedEvents?e.bottomNestedEvents():[]).map((({e:e})=>e))];return ee(a=da(),K(W,{get each(){return s()},children:i=>{const s=!i().parent,a=E((()=>Ks(i()))),l=()=>(e.firstLevelComments?e.firstLevelComments():0)>=3||a()>=5,c=()=>{var e;return i().pk===(null==(e=sr.active)?void 0:e.pk)},u=()=>o(i());x(z([t],(()=>{if(ir.commentContexts.has(i().id)){const e={...u()};e.text.value=Us(i(),ir,t()),ir.commentContexts.set(i().id,e)}})));const[f,d]=w(),h=()=>{const e=u().text.overflowed();if(void 0!==e)return e;const t=getComputedStyle(f()),n=parseFloat(t.fontSize),r=parseFloat(t.maxHeight)||7.5*n;return(parseFloat(t.height)||0)>r&&(u().text.overflowed(!0),!0)};x(z([r,l],(()=>{const e=u().thread,t=e.collapsed();void 0!==t?e.setCollapsed(t):s&&r()&&e.setCollapsed(l())})));const p=Ys(!1),g=Ys(0),y=()=>e.votes().filter((e=>e.noteId===i().id)),m=async()=>{try{return await $s()}catch(e){console.error(Gs(e))}};x((()=>{C((()=>{const e=(()=>{const e=new Map;return y().forEach((t=>{!function(e,t,n,r){let o,i,s=!1;e.has(t)?o=e.get(t):(o=n(),s=!0),r?(i=r(o),s=!0):i=o,s&&e.set(t,i)}(e,t.pk,(()=>[]),(e=>[...e,t]))})),[...e.values()].map((e=>os(e)[0]))})();p(e.length>0);const t=e.map((e=>+(1===fr(e)))).reduce(((e,t)=>e+t),0),n=e.map((e=>+(-1===fr(e)))).reduce(((e,t)=>e+t),0),{upvotesCount:r,downvotesCount:o}=u().votes;r(t),o(n);const i=sr.active,s=i&&e.filter((e=>e.pk===i.pk)).map((e=>fr(e)))[0]||0;g(s)}))}));const v=async e=>{const t=await m();if(!t)return;const n=t,r=g()===e?0:e,o=i().ro||ir.version||ir.rootEventIds[0];await(async()=>{const e=os(y().filter((e=>e.pk===n.pk))).reverse().map((e=>e.id));0!==e.length&&await Ms({kind:5,created_at:rs(),content:"",pubkey:n.pk,tags:[...e.map((e=>["e",e])),...e.map((e=>["k","7"]))]},n)&&zr("reactions",e)})(),[-1,1].includes(r)&&await(async()=>{const e=[];o&&e.push(["e",o,"","root"]),await Ms({kind:7,created_at:rs(),content:-1===r?"-":"+",pubkey:n.pk,tags:[...e,["e",i().id,"","reply"],["p",n.pk]]},n)})()},b=Ys(Vs),k=()=>i().pk,A=()=>ze(k()),S=()=>n().find((e=>e.pk===k()));let B;x((async()=>{var e;b((null==(e=S())?void 0:e.i)||Vs)}));const O=()=>(e=>{const t=new Date,n=Math.floor((t.getTime()-e)/1e3);if(n<60)return"now";if(n<3600){const e=Math.floor(n/60);return`${e} minute${1===e?"":"s"} ago`}if(n<=86400){const e=Math.floor(n/3600);return`${e} hour${1===e?"":"s"} ago`}if(n<=604800){const e=Math.floor(n/86400);return`${e} day${1===e?"":"s"} ago`}if(n>604800){const n=new Date(e);return"on "+n.toLocaleDateString("en-us",{day:"numeric",month:"long"})+(n.getFullYear()===t.getFullYear()?"":" "+n.getFullYear())}return""})(1e3*i().ts),[L,M]=w();x((()=>{M(O()),B=setInterval((()=>{M(O())}),6e4)}));const $=()=>i().a===ir.anchor.value&&i().am,R=()=>i().k===Me?"highlight":$()?"mention":"comment";return I((()=>{clearInterval(B)})),V=pa(),W=V.firstChild,G=W.firstChild,J=G.firstChild.firstChild,Y=J.firstChild,te=J.nextSibling.firstChild.firstChild,ne=te.nextSibling.firstChild,re=ne.firstChild,oe=re.firstChild,ie=G.nextSibling,se=ie.nextSibling,ae=W.nextSibling,le=ae.firstChild,Y.addEventListener("error",(()=>b(Vs))),ee(te,(()=>{var e;return(null==(e=S())?void 0:e.n)||Fs(A())})),ee(re,R,oe),ee(re,L,null),ee(W,(P=E((()=>!(i().parent||!i().ro||ir.rootEventIds.includes(i().ro)))),()=>{return P()&&(e=ga(),t=e.firstChild,n=t.firstChild,r=n.firstChild.nextSibling,o=r.nextSibling.nextSibling,ee(t,Qa,n),ee(n,R,r),_((()=>Q(o,"href",ir.urlPrefixes.note+Ie(i().ro)))),e);var e,t,n,r,o}),ie),ee(W,(T=E((()=>!(i().parent||i().ro))),()=>{return T()&&(e=ya(),t=e.firstChild,n=t.firstChild,(r=n.firstChild.nextSibling).nextSibling,ee(t,Qa,n),ee(n,R,r),e);var e,t,n,r}),ie),ee(W,(j=E((()=>!(i().parent||!i().ro||!ir.rootEventIds.includes(i().ro)||!ir.version||ir.version===i().ro))),()=>{return j()&&(e=ma(),t=e.firstChild,n=t.firstChild,(r=n.firstChild.nextSibling).nextSibling,ee(t,Qa,n),ee(n,R,r),e);var e,t,n,r}),ie),X(d,ie),ee(W,(N=E((()=>!!h())),()=>{return N()&&(e=va(),t=e.firstChild,e.$$click=()=>Qs(u().text.collapsed),ee(t,(()=>u().text.collapsed()?"Read more":"Show less")),e);var e,t}),se),ee(se,(()=>K(Z,{get when(){return!ir.disableFeatures.includes("votes")},get children(){return[(r=wa(),r.$$click=()=>v(1),ee(r,(n=E((()=>1===g())),()=>n()?Ka():Ha()),null),ee(r,K(Z,{get when(){return E((()=>!!ir.disableFeatures.includes("singleVoteCounter")))()&&p()},get children(){var e=ba();return ee(e,(()=>u().votes.upvotesCount())),e}}),null),_((()=>r.classList.toggle("selected",!(1!==g())))),r),K(Z,{get when(){return!ir.disableFeatures.includes("singleVoteCounter")||!p()},get children(){var e,t=ka();return ee(t.firstChild,(e=E((()=>!!p())),()=>e()?u().votes.upvotesCount()-u().votes.downvotesCount():"Vote")),t}}),(t=_a(),t.$$click=()=>v(-1),ee(t,(e=E((()=>-1===g())),()=>e()?Wa():Va()),null),ee(t,K(Z,{get when(){return E((()=>!!ir.disableFeatures.includes("singleVoteCounter")))()&&p()},get children(){var e=ba();return ee(e,(()=>u().votes.downvotesCount())),e}}),null),_((()=>t.classList.toggle("selected",!(-1!==g())))),t)];var e,t,n,r}})),null),ee(se,(q=E((()=>!!c())),()=>{return q()&&((e=xa()).$$click=()=>(async()=>{const e=await m();if(!e)return;const t=e;if(t&&(!ir.onRemove||(await ir.onRemove({content:u().text.value})).accepted)){const e=i().id;await Ms({kind:5,created_at:rs(),content:"",pubkey:t.pk,tags:[["e",e],["k","1"]]},t)&&zr("events",[e])}})(),ee(e,Za),e);var e}),null),ee(se,(U=E((()=>!(!sr.active||!(sr.active&&ir.moderators.has(sr.active.pk)||ir.showReportButton.has(i().id))||c()||ir.moderators.has(i().pk)))),()=>{return U()&&((e=Ea()).$$click=()=>(async()=>{const e=await m();if(!e)return;const t=e;if(!t)return;const n=ir.onReport?await ir.onReport({}):{accepted:!0,list:"event",type:"other",reason:""};if(!n.accepted)return;const r=i().id,o="event"===n.list?["e",r]:["p",i().pk],s=await Ms({kind:Oe,created_at:rs(),content:n.reason||"",pubkey:t.pk,tags:[[...o,n.type||"other"]]},t),a=await Ms({kind:$e,created_at:rs(),content:n.reason||"",pubkey:t.pk,tags:[o]},t);(s||a)&&zr("events",[r])})(),ee(e,Ga),e);var e}),null),ee(se,K(Z,{get when(){return!ir.disableFeatures.includes("reply")},get children(){var e=ha(),t=e.firstChild;return e.$$click=()=>{ir.userStartedReadingComments=!0,Qs(u().reply.isOpen)},ee(e,Ua,t),ee(t,(()=>u().reply.isOpen()?"Cancel":"Reply")),e}}),null),ee(W,(D=E((()=>!!u().reply.isOpen())),()=>D()&&K(ua,{get comment(){return u().reply.text},get replyTo(){return i().id},onDone:()=>{const e=u();e.thread.setCollapsed(!1),e.reply.isOpen(!1)}})),null),ee(le,(F=E((()=>a()>0)),()=>{return F()&&(t=Aa(),n=t.firstChild,r=n.firstChild,o=n.nextSibling,i=o.firstChild,t.$$click=()=>{ir.userStartedReadingComments=!0,u().thread.trigger()},ee(r,(e=E((()=>!0===u().thread.collapsed())),()=>e()?Ja():Ya())),ee(o,a,i),ee(o,(()=>a()>1?"ies":"y"),null),_((()=>t.classList.toggle("selected",!(!0!==u().thread.collapsed())))),t);var e,t,n,r,o,i})),ee(ae,(H=E((()=>!u().thread.collapsed())),()=>H()&&K(Na,{topNestedEvents:()=>i().children,get articles(){return e.articles},get votes(){return e.votes}})),null),_((e=>{var t=b(),n=ir.urlPrefixes.npub+A(),r=ir.urlPrefixes.note+Ie(i().id),o=!(!h()||!u().text.collapsed()),s=!(i().k!=Me),a=u().text.value;return t!==e.e&&Q(Y,"src",e.e=t),n!==e.t&&Q(te,"href",e.t=n),r!==e.a&&Q(ne,"href",e.a=r),o!==e.o&&ie.classList.toggle("ztr-comment-text-fade",e.o=o),s!==e.i&&ie.classList.toggle("highlight",e.i=s),a!==e.n&&(ie.innerHTML=e.n=a),e}),{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),V;var P,T,j,N,q,U,D,F,H,V,W,G,J,Y,te,ne,re,oe,ie,se,ae,le}})),a;var a},qa=()=>Ca(),Ua=()=>{return Q(e=Sa(),"width",Hs),Q(e,"height",Hs),e;var e},Da=()=>{return Q(e=za(),"width",Hs),Q(e,"height",Hs),e;var e},Fa=()=>{return Q(e=Ia(),"width",Hs),Q(e,"height",Hs),e;var e},Ha=()=>Ba(),Va=()=>Oa(),Ka=()=>La(),Wa=()=>Ma(),Za=()=>$a(),Ga=()=>Ra(),Ja=()=>Pa(),Ya=()=>Ta(),Qa=()=>{return Q(e=ja(),"height",Hs),e;var e};Y(["click"]);const{bech32:Xa,hex:el,utf8:tl}=xe,nl={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},rl={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},ol={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},il={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},sl={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},al=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],ll={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},cl=BigInt("2100000000000000000"),ul=BigInt(1e11),fl={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},dl={};for(let El=0,Al=Object.keys(fl);El<Al.length;El++){const e=Al[El],t=fl[Al[El]].toString();dl[t]=e}const hl={1:e=>el.encode(Xa.fromWordsUnsafe(e)),16:e=>el.encode(Xa.fromWordsUnsafe(e)),13:e=>tl.encode(Xa.fromWordsUnsafe(e)),19:e=>el.encode(Xa.fromWordsUnsafe(e)),23:e=>el.encode(Xa.fromWordsUnsafe(e)),27:e=>el.encode(Xa.fromWordsUnsafe(e)),6:gl,24:gl,3:function(e){const t=[];let n,r,o,i,s,a=Xa.fromWordsUnsafe(e);for(;a.length>0;)n=el.encode(a.slice(0,33)),r=el.encode(a.slice(33,41)),o=parseInt(el.encode(a.slice(41,45)),16),i=parseInt(el.encode(a.slice(45,49)),16),s=parseInt(el.encode(a.slice(49,51)),16),a=a.slice(51),t.push({pubkey:n,short_channel_id:r,fee_base_msat:o,fee_proportional_millionths:i,cltv_expiry_delta:s});return t},5:function(e){const t=e.slice().reverse().map((e=>[!!(1&e),!!(2&e),!!(4&e),!!(8&e),!!(16&e)])).reduce(((e,t)=>e.concat(t)),[]);for(;t.length<2*al.length;)t.push(!1);const n={};al.forEach(((e,r)=>{let o;o=t[2*r]?"required":t[2*r+1]?"supported":"unsupported",n[e]=o}));const r=t.slice(2*al.length);return n.extra_bits={start_bit:2*al.length,bits:r,has_required:r.reduce(((e,t,n)=>n%2!=0?e||!1:e||t),!1)},n}};function pl(e){return t=>({tagCode:parseInt(e),words:Xa.encode("unknown",t,Number.MAX_SAFE_INTEGER)})}function gl(e){return e.reverse().reduce(((e,t,n)=>e+t*Math.pow(32,n)),0)}function yl(e,t){let n,r;if(e.slice(-1).match(/^[munp]$/))n=e.slice(-1),r=e.slice(0,-1);else{if(e.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");r=e}if(!r.match(/^\d+$/))throw new Error("Not a valid human readable amount");const o=BigInt(r),i=n?o*ul/ll[n]:o*ul;if("p"===n&&o%BigInt(10)!==BigInt(0)||i>cl)throw new Error("Amount is outside of valid range");return t?i.toString():i}var ml={decode:function(e,t){if("string"!=typeof e)throw new Error("Lightning Payment Request must be string");if("ln"!==e.slice(0,2).toLowerCase())throw new Error("Not a proper lightning payment request");const n=[],r=Xa.decode(e,Number.MAX_SAFE_INTEGER);e=e.toLowerCase();const o=r.prefix;let i=r.words,s=e.slice(o.length+1),a=i.slice(-104);i=i.slice(0,-104);let l=o.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(l&&!l[2]&&(l=o.match(/^ln(\S+)$/)),!l)throw new Error("Not a proper lightning payment request");n.push({name:"lightning_network",letters:"ln"});const c=l[1];let u;if(t){if(void 0===t.bech32||void 0===t.pubKeyHash||void 0===t.scriptHash||!Array.isArray(t.validWitnessVersions))throw new Error("Invalid network");u=t}else switch(c){case nl.bech32:u=nl;break;case rl.bech32:u=rl;break;case ol.bech32:u=ol;break;case il.bech32:u=il;break;case sl.bech32:u=sl}if(!u||u.bech32!==c)throw new Error("Unknown coin bech32 prefix");n.push({name:"coin_network",letters:c,value:u});const f=l[2];let d;if(f){d=yl(f+l[3],!0),n.push({name:"amount",letters:l[2]+l[3],value:d})}else d=null;n.push({name:"separator",letters:"1"});const h=gl(i.slice(0,7));let p,g,y,m;for(i=i.slice(7),n.push({name:"timestamp",letters:s.slice(0,7),value:h}),s=s.slice(7);i.length>0;){const e=i[0].toString();p=dl[e]||"unknown_tag",g=hl[e]||pl(e),i=i.slice(1),y=gl(i.slice(0,2)),i=i.slice(2),m=i.slice(0,y),i=i.slice(y),n.push({name:p,tag:s[0],letters:s.slice(0,3+y),value:g(m)}),s=s.slice(3+y)}n.push({name:"signature",letters:s.slice(0,104),value:el.encode(Xa.fromWordsUnsafe(a))}),s=s.slice(104),n.push({name:"checksum",letters:s});let v={paymentRequest:e,sections:n,get expiry(){let e=n.find((e=>"expiry"===e.name));if(e)return b("timestamp")+e.value},get route_hints(){return n.filter((e=>"route_hint"===e.name)).map((e=>e.value))}};for(let w in fl)"route_hint"!==w&&Object.defineProperty(v,w,{get:()=>b(w)});return v;function b(e){let t=n.find((t=>t.name===e));return t?t.value:void 0}},hrpToMillisat:yl},vl=J("<div id=ztr-root><style>"),bl=J("<div id=ztr-content>"),wl=J("<h1>Error!"),kl=J("<div class=ztr-comment-text><pre></pre><p>Only properly formed NIP-19 naddr, note and nevent encoded entities and URLs are supported."),_l=J("<h2 id=ztr-title>");const xl=e=>{const t=()=>+e.minReadPow;var n;k((()=>{ir.anchor=(()=>{const t=e.anchor.trim();try{if(t.startsWith("http")){const n=!e.legacyUrl;return{type:"http",value:Zs(t,n)}}const n=Ce(t);switch(n.type){case"nevent":return{type:"note",value:n.data.id};case"note":return{type:"note",value:n.data};case"naddr":const e=n.data;return{type:"naddr",value:`${e.kind}:${e.pubkey}:${e.identifier}`}}}catch(n){return console.error(n),{type:"error",value:`Malformed anchor: ${t}`}}})(),(e.author||"").startsWith("npub")&&(ir.externalAuthor=e.author),ir.disableFeatures=e.disable.split(",").map((e=>e.trim())).filter(lr),ir.urlPrefixes=((e="")=>{const t={naddr:"https://nostr.at/",npub:"https://nostr.at/",nprofile:"https://nostr.at/",nevent:"https://nostr.at/",note:"https://nostr.at/",tag:"https://snort.social/t/"};for(const n of e.split(",")){const[e,r]=n.split(":");r&&(t[e]=`https://${r}`)}return t})(e.urls),ir.replyPlaceholder=e.replyPlaceholder,ir.maxCommentLength=+e.maxCommentLength||1/0,ir.minReadPow=t(),ir.maxWritePow=+e.maxWritePow,ir.writePowDifficulty=Math.max(ir.writePowDifficulty,t()),ir.community=e.community,(e=>{const t=e.trim();t&&(ur(t)?ir.language=t:console.error(`[zapthreads] Unknown ISO-639-1 language ${t}, ignoring`))})(e.language);const n=e.client.trim();n&&(ir.client=n)})),n=async()=>{sr.active||(await(async()=>{ps(0);const e=await Er("sessions",1,{index:"autoLogin"});if(!e)return;const t=await ps(1e3);if(!t)return void console.log("[zapthreads] nip-07 is probably removed");const n=await t.getPublicKey();if(n!==e.pk)return console.log("[zapthreads] unknown user, disabling auto-login"),void Sr("sessions",{...e,autoLogin:0});ir.onLogin&&!(await ir.onLogin({knownUser:!0}))||(sr.active={pk:n,signEvent:async e=>await t.signEvent(e)})})(),await ks.updateRelays(e.relays))},x((()=>S(n)));const r=()=>ir.anchor,o=()=>ir.readRelays,i=()=>e.version;ir.profiles=kr((()=>["profiles"]));const s=()=>ir.disableFeatures.includes("watch");k(z([r],(()=>{ir.version=i()}))),k(z([r,o],(async()=>{if(ir.rootEventIds.length>0||"error"===r().type)return;let t,n;switch(r().type){case"http":n=await xr("events",r().value,{index:"r"}),ir.rootEventIds=os(n).map((e=>e.id));t={"#r":e.legacyUrl?[r().value]:[r().value,`${r().value}/`],kinds:[1,8812]};break;case"note":const o=await Er("events",IDBKeyRange.only(r().value));return ir.rootEventIds=[r().value],void(o&&(ir.anchorAuthor=o.pk));case"naddr":const[i,s,a]=r().value.split(":");n=(await xr("events",a,{index:"d"})).filter((e=>e.pk===s)),n.length>0&&(ir.rootEventIds=os(n).map((e=>e.id)),ir.anchorAuthor=n[0].pk),t={authors:[s],kinds:[parseInt(i)],"#d":[a]};break;default:throw"error"}const i=o();if(0===i.length)return;const s=(await ks.querySync(i,{...t})).map(gr);for(const e of s)"http"==r().type?(1==e.k&&e.c.includes("↴")||8812==e.k)&&Sr("events",e):Sr("events",e);switch(r().type){case"http":case"naddr":const e=[...n,...s],t=os([...e]).map((e=>e.id));(t.length>0&&t[0])!==ir.rootEventIds[0]&&(ir.rootEventIds=t);break;case"note":ir.rootEventIds=s.map((e=>e.id))}s.length>0&&(ir.anchorAuthor=s[0].pk)})));const a=()=>ir.rootEventIds;k(z([a,i],(()=>{switch(r().type){case"http":case"note":return void((ir.filter["#e"]??[]).toString()!==a().toString()&&(ir.filter={"#e":a()}));case"naddr":const e=ir.filter["#a"]&&ir.filter["#a"][0];return r().value!==e&&(ir.filter={"#a":[r().value]}),void(ir.version=i()||a()[0])}}),{defer:!0}));const l=E((()=>ir.filter),{defer:!0});let c;x(z([l,o],(async()=>{const e=l(),t=o(),n=r();h(),b();const i=ir.profiles();if(0===Object.entries(e).length||0===t.length)return;const a=await(async()=>Math.max(await cs(),await as()))();null==c||c.close(),c=null,I((()=>{console.log("[zapthreads] unsubscribing and cleaning up",n.value),null==c||c.close(),c=null})),console.log(`[zapthreads] subscribing to ${n.value} on`,[...t]);const u=!ir.anchorAuthor&&"note"===r().type,f=u?[{ids:[r().value],kinds:ms,limit:1}]:[],d=ir.disableFeatures.includes("votes")&&ir.disableFeatures.includes("likes"),p=ir.disableFeatures.includes("zaps"),g=vs.filter((e=>{let t=!0;return d&&t&&(t=7!==e),p&&t&&(t=e!==Le),t})),y=new Set,m={};let v=new Set;const w=new Set;c=await ks.subscribeManyMap(Object.fromEntries(t.map((t=>[t,[...f,{...e,kinds:g}]]))),{onevent(e){(async()=>{if(ms.includes(e.kind)){const t=gr(e);u&&!ir.anchorAuthor&&e.id===r().value&&(console.log(`[zapthreads] anchor author is ${e.pubkey}`),ir.anchorAuthor=e.pubkey),Sr("events",t),v.add(e.pubkey)}else if(7===e.kind){y.add(e.id);const t=((e,t)=>{er(e);const n=e.tags.filter((e=>e.length>1&&"e"===e[0])),r=n.filter((e=>e.length>2)),o=r.filter((e=>"reply"===e[3])).concat(r.filter((e=>"root"===e[3]))).map((e=>e[1])).concat(n.length>0&&n[0].length>1&&[n[0][1]]||[])[0],i=e.tags.find((e=>e.length>2&&"nonce"===e[0])),s=i&&+i[2]||0;return{id:e.id??"",noteId:o,pk:e.pubkey,content:e.content,ts:e.created_at,pow:s,a:t}})(e,n.value);0!==fr(t)&&Sr("reactions",t)}else if(e.kind===Le){const t=e.tags.find((e=>"bolt11"===e[0]));t&&t[1]&&(m[e.id]=t[1])}})()},oneoseOnRelay(e){v=new Set([...v].filter((e=>!w.has(e)))),v.forEach((e=>w.add(e))),js(v,t,i),v.clear()},oneose(){(async()=>{const e=await Er("aggregates",IDBKeyRange.only([n.value,7]))??{eid:n.value,ids:[],k:7};e.ids=[...new Set([...e.ids,...y])],Sr("aggregates",e);const t=await Er("aggregates",IDBKeyRange.only([n.value,Le]))??{eid:n.value,ids:[],k:Le,sum:0};t.sum=Object.entries(m).reduce(((e,n)=>{if(t.ids.includes(n[0]))return e;const r=ml.decode(n[1]).sections.find((e=>"amount"===e.name));return e+Number(r.value)/1e3}),t.sum??0),t.ids=[...new Set([...t.ids,...Object.keys(m)])],Sr("aggregates",t)})(),Ir((async()=>{if(await ks.estimateWriteRelayLatencies(),await(async e=>{ir.blocks.checkUpdates&&(ir.blocks.checkUpdates=!1,await ls(e),await ss(),await us(),console.log("[zapthreads] updated block-lists"))})(a),await ks.updateRelayInfos(),s()){null==c||c.close();const e=new Set(ir.writeRelays);ks.close(t.filter((t=>!e.has(t))))}console.log("[zapthreads] oneose has finished")}))}})}),{defer:!0}));const u=kr((()=>["events",30023,{index:"k"}])),f=E((()=>{if(ir.disableFeatures.includes("hideContent")&&"naddr"===r().type){const[e,t,n]=r().value.split(":"),o=u().find((e=>e.d===n&&e.pk===t));if(o){const e=`# ${o.tl}\n ${o.c}`;return Us({...o,c:e},ir)}}})),d=E((()=>{switch(r().type){case"http":case"note":return kr((()=>["events",ir.rootEventIds,{index:"ro"}]));case"naddr":return kr((()=>["events",r().value,{index:"a"}]));default:return()=>[]}})),h=()=>d()(),p=E((()=>{if(ir.rootEventIds&&ir.rootEventIds.length){const e=h();return Js(e).filter((e=>!(e.k===Me&&0===e.children.length)))}return[]})),g=()=>{const e=ir.userStartedReadingComments,t=p().filter((t=>{var n;return!e||(null==(n=sr.active)?void 0:n.pk)==t.pk||ir.topRootEventIds.has(t.id)}));return t.forEach((e=>ir.topRootEventIds.add(e.id))),t},y=()=>p().filter((e=>!ir.topRootEventIds.has(e.id))),m=()=>p().reduce(((e,t)=>e+Ks(t)),p().length),v=()=>p().filter((e=>!e.parent)).length,b=kr((()=>["reactions",r().value,{index:"a"}])),A=E((()=>b().filter((e=>0!==fr(e)))));let C;const B=function(e,t){const n=new WeakMap,r=new IntersectionObserver(((e,t)=>{var r;for(const o of e)null==(r=n.get(o.target))||r(o,t)}),e);function o(e){r.unobserve(e),n.delete(e)}function i(e,t){!function(e,t){t.observe(e)}(e,r),n.set(e,t)}I((()=>r.disconnect()));const s=t?(e,n)=>{const r="function"!=typeof(o=t)||o.length?o:o();var o;return t=>n(r(t,{visible:S(e)}))}:(e,t)=>e=>t(e.isIntersecting);return t=>{const[n,r]=w((null==e?void 0:e.initialValue)??!1),a=s(n,r);let l;return t instanceof Element?i(t,a):x((()=>{const e=t();e!==l&&(l&&o(l),e&&i(e,a),l=e)})),I((()=>l&&o(l))),n}}({threshold:0})((()=>C));return x(z([B,v],(()=>{!ir.userStartedReadingComments&&B()&&v()>0&&(ir.userObservedComments=!0,setTimeout((()=>{ir.userStartedReadingComments=!0}),3e3))}))),I((()=>{clearTimeout(undefined)})),$=vl(),R=$.firstChild,"function"==typeof C?X(C,$):C=$,ee(R,'#ztr-content,\n#ztr-content img {\n  max-width: 100%;\n}\n\n#ztr-root {\n  display: flex;\n  flex-direction: column;\n  font-family: var(--ztr-font);\n  font-size: var(--ztr-font-size);\n  color: var(--ztr-text-color);\n  border: 1px solid transparent;\n  word-wrap: break-word;\n  /* removes margin collapse */\n  margin-top: 0;\n  line-height: 1.2em;\n}\n\n#ztr-subtitle {\n  font-size: 1.2em;\n  color: #666;\n}\n\na {\n  color: var(--ztr-link-color);\n  text-decoration: none;\n}\n\n/* Comment */\n\n.ztr-comment {\n  position: relative;\n  margin: 0;\n  padding: 0;\n  padding-top: 2.5em;\n}\n\n.ztr-comment-body {\n  /*padding: 1em;*/\n  /*padding-bottom: 2em;*/\n  /*padding-bottom: 0.5em;*/\n}\n\n.ztr-comment:first-child {\n  padding-top: 0;\n  border-top-left-radius: 0.3em;\n  border-top-right-radius: 0.3em;\n}\n\n.ztr-comment:last-child {\n  border-bottom-left-radius: 0.3em;\n  border-bottom-right-radius: 0.3em;\n}\n\n.ztr-comment-info-wrapper {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.ztr-comment-info {\n  display: flex;\n  align-items: center;\n}\n\n.ztr-comment-info-picture {\n  width: 3.5em;\n}\n\nul.ztr-comment-info-items {\n  display: flex;\n  align-items: center;\n  list-style: none;\n  margin: 0;\n  padding: 0;\n  font-size: 0.9em;\n}\n\nul.ztr-comment-info-items li {\n  display: inline-block;\n  cursor: default;\n  padding-right: 0.5em;\n}\n\nul.ztr-comment-info-items li a {\n  font-weight: 600;\n}\n\nul.ztr-comment-info-items li a small {\n  /* color: rgba(0,0,0,0.5); */\n}\n\n.ztr-comment-info-author a {\n  font-size: 1.2em;\n  padding-right: 0.2em;\n}\n\n.ztr-comment-info-author a:hover {\n  text-decoration: underline;\n}\n\n.ztr-comment-info-dots {\n  cursor: pointer;\n}\n\n.ztr-comment-info-separator {\n  width: 0.5em;\n}\n\n.ztr-comment-info-picture img {\n  width: 2em;\n  height: 2em;\n  border-radius: 50%;\n  padding: 0.5em;\n  position: relative;\n  display: block;\n  object-fit: cover;\n}\n\n.ztr-comment-text,\n#ztr-content {\n  margin-bottom: 0.75em;\n  padding: 0 0.8em 0 3.5em;\n  line-height: 1.5em;\n  line-break: loose;\n  word-break: break-word;\n  overflow: hidden;\n  max-width: 37em;\n  min-width: 12em;\n}\n\n.ztr-comment-text-fade {\n  position: relative;\n  max-height: 6em;\n}\n.ztr-comment-text-fade::after {\n  content: "";\n  text-align: right;\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(150deg, rgba(255, 255, 255, 0) 70%, rgba(255, 255, 255, 1));\n  pointer-events: none;\n  cursor: text;\n}\n\n.ztr-comment-text p {\n  margin: 0 0 0.1em 0;\n}\n\n.ztr-comment-text code {\n  font-size: 1.1em;\n  margin: 0 0.2em;\n}\n\n.ztr-comment-text pre,\n.ztr-info-pane pre {\n  white-space: pre-wrap;\n  white-space: -moz-pre-wrap;\n  word-wrap: break-word;\n}\n\n.ztr-comment-text a {\n  color: var(--ztr-action-color, #96609c);\n}\n\n.ztr-comment-text a:hover {\n  color: var(--ztr-action-hover-color);\n  text-decoration: underline;\n}\n\n.ztr-comment-text img {\n  max-width: 100%;\n}\n\n.ztr-comment-text .warning {\n  margin-top: 0em;\n  font-size: 0.8em;\n  display: flex;\n  align-items: center;\n}\n\n.ztr-comment-text .warning svg {\n  height: 1.2em;\n  fill: #e4984d;\n  padding-right: 0.7em;\n}\n\n.ztr-comment-replies {\n  margin-left: 3em;\n}\n\n.ztr-comment-replies-info-actions {\n  /*min-height: 2.5em;\n  align-items: center;*/\n  padding-bottom: 0.5em;\n  margin-left: 0.22em; /* wat */\n}\n\n.ztr-comment-replies-info-items {\n  display: flex;\n  list-style: none;\n  font-size: 0.9em;\n  font-weight: 600;\n  color: #6d6d6d;\n  cursor: pointer;\n  width: 10em;\n  li {\n    padding: 1em;\n    padding-left: 1.3em;\n    margin: -0.6em;\n    margin-left: -1em;\n  }\n}\n\n.ztr-comment-replies-info-items.selected {\n  color: var(--ztr-action-color, #96609c);\n  svg {\n    fill: var(--ztr-action-color, #96609c);\n  }\n}\n\n.ztr-comment-replies-info-items:hover svg {\n  fill: white;\n}\n\n.ztr-comment-replies-info-items:hover li {\n  color: white;\n}\n\nul.ztr-comment-replies-info-items {\n  border-radius: 1.4rem;\n  min-height: 3em;\n  align-items: center;\n  padding: 0;\n  justify-content: center;\n  width: 9em;\n}\n\nul.ztr-comment-replies-info-items:hover {\n  background: var(--ztr-action-color, #96609c);\n  color: white;\n}\n\n.highlight p {\n  background: #F6AD55;\n  color: #2B2B2B;\n  display: inline;\n  padding: 0.2em;\n}\n\n/* Styling the reply to comment form */\n\n.ztr-comment-expand {\n  display: flex;\n  position: relative;\n  max-width: fit-content;\n  padding-top: 0.8em;\n  padding-bottom: 0.5em;\n  padding-left: 1.1em;\n  padding-right: 1em;\n  margin-left: 2.4em;\n  margin-top: -1em;\n  margin-bottom: 0.5em;\n  font-weight: 600;\n  cursor: pointer;\n  color: #2B2B2B;\n}\n\n.ztr-comment-expand:hover span {\n  color: var(--ztr-action-color, #96609c);\n}\n\nul.ztr-comment-actions {\n  display: flex;\n  align-items: center;\n  list-style: none;\n  margin: 0;\n  padding: 0 0 0 2.625em;\n  font-weight: 600;\n  user-select: none;\n}\n\nul.ztr-comment-actions {\n  margin-top: -1em;\n}\n\nul.ztr-comment-actions li {\n  display: inline-flex;\n  align-items: center;\n  text-align: center;\n  padding: 1em;\n  margin: -0.125em;\n  cursor: pointer;\n}\n\nli.ztr-comment-action-upvote {\n  margin-left: 0.5em;\n  margin-right: 0.5em;\n  span {\n    margin-left: 0.075em;\n    font-size: 0.85em;\n  }\n}\n\nli.ztr-comment-action-downvote {\n  margin-left: 0.5em;\n  margin-right: 0.5em;\n  span {\n    margin-left: 0.075em;\n    font-size: 0.85em;\n  }\n}\n\nli.ztr-comment-action-reply {\n  margin-left: 0.7em;\n  margin-right: 0.7em;\n}\n\nli.ztr-comment-action-zap {\n  margin-left: 0.7em;\n  margin-right: 0.7em;\n}\n\nli.ztr-comment-action-like {\n  margin-left: 0.7em;\n  margin-right: 0.7em;\n}\n\n.ztr-comment-action-zap:hover svg {\n  fill: #e4984d;\n}\n\n.ztr-comment-action-zap:hover span {\n  color: #e4984d;\n}\n\n.ztr-comment-action-like:hover svg {\n  fill: #e35428;\n}\n\n.ztr-comment-action-like:hover span {\n  color: #e35428;\n}\n\n.ztr-comment-action-upvote:hover svg {\n  fill: var(--ztr-action-color, #96609c);\n}\n\n.ztr-comment-action-upvote:hover span {\n  color: var(--ztr-action-color, #96609c);\n}\n\n.ztr-comment-action-upvote.selected {\n  svg {\n    fill: var(--ztr-action-color, #96609c);\n  }\n}\n\n.ztr-comment-action-downvote:hover svg {\n  fill: var(--ztr-action-color, #96609c);\n}\n\n.ztr-comment-action-downvote:hover span {\n  color: var(--ztr-action-color, #96609c);\n}\n\n.ztr-comment-action-downvote.selected {\n  svg {\n    fill: var(--ztr-action-color, #96609c);\n  }\n}\n\n.ztr-comment-action-remove:hover svg {\n  fill: var(--ztr-action-color, #96609c);\n}\n\n.ztr-comment-action-report:hover svg {\n  fill: var(--ztr-action-color, #96609c);\n}\n\nli.ztr-comment-action-votes {\n  justify-content: center;\n  span {\n    margin-left: -0.7em;\n    margin-right: -0.7em;\n    font-size: 0.85em;\n  }\n}\n\n.ztr-reply-form {\n  padding: 0 0.5em 0 3.5em;\n}\n\n.ztr-reply-form textarea {\n  font-family: var(--ztr-font);\n  font-size: 1.1em;\n  line-height: 1.4;\n  color: #2B2B2B;\n  background-color: #FDFDFD;\n  border: 1px solid #BBB;\n  outline: none;\n  width: calc(100% - 1.5em);\n  min-width: 12em;\n  padding: 0.7em;\n  margin: 0.5em 0;\n  height: 4em;\n  border-radius: 0.2em;\n  min-height: 4em;\n  resize: vertical;\n}\n\n.ztr-reply-form textarea.too-long {\n  border: 2px solid rgb(202, 23, 23);\n}\n\n.ztr-reply-form:disabled {\n  opacity: 65%;\n  user-select: none;\n}\n\n.ztr-reply-controls {\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n}\n\n.ztr-reply-controls span {\n  font-weight: bold;\n  font-size: 0.85em;\n  margin-right: 1em;\n  user-select: none;\n  cursor: default;\n}\n\n.ztr-reply-error {\n  color: rgb(202, 23, 23);\n}\n\n.ztr-reply-controls button {\n  font-family: var(--ztr-font);\n  appearance: none;\n  padding: 0.5em 1.4em;\n  min-width: 8em;\n  min-height: 3em;\n  border-radius: 1.4rem;\n  font-size: 0.95em;\n  font-weight: 600;\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.ztr-reply-controls button:hover {\n  color: white;\n  background: var(--ztr-action-color, #96609c);\n}\n\n.ztr-reply-login-button {\n  color: var(--ztr-action-color, #96609c);\n  background-color: white;\n  border: 1px solid var(--ztr-action-color, #96609c);\n}\n\n.ztr-reply-login-button svg {\n  fill: var(--ztr-action-color, #96609c);\n  width: 2em;\n  height: 2em;\n}\n\n.ztr-reply-login-button:hover svg {\n  fill: white;\n}\n\n.ztr-reply-button {\n  color: var(--ztr-text-color);\n  display: flex;\n  align-items: center;\n  border: 1px solid transparent;\n}\n\n.ztr-info-pane {\n  padding: 0 0.5em 1em 3.5em;\n}\n\n.ztr-info-pane pre {\n  font-size: 0.8em;\n}\n\n.ztr-spinner {\n  width: 1.2em;\n  height: 1.2em;\n  padding: 0.9em;\n  animation: rotate 4s linear infinite;\n}\n\n.ztr-reply-button:disabled {\n  opacity: 65%;\n  pointer-events: none;\n  cursor: pointer;\n  user-select: none;\n}\n\n.ztr-spinner .path {\n  stroke: var(--ztr-text-color, #2B2B2B);\n  stroke-linecap: round;\n  animation: dash 1.5s ease-in-out infinite;\n}\n\n@keyframes rotate {\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes dash {\n  0% {\n    stroke-dasharray: 1, 150;\n    stroke-dashoffset: 0;\n  }\n\n  50% {\n    stroke-dasharray: 90, 150;\n    stroke-dashoffset: -35;\n  }\n\n  100% {\n    stroke-dasharray: 90, 150;\n    stroke-dashoffset: -124;\n  }\n}\n\n/* new */\n\n.ztr-comment-new .ztr-reply-form {\n  margin: 0.5em 0;\n  padding: 0;\n}\n\n.ztr-comment-new .ztr-comment-body {\n  padding: 0;\n}\n\n.ztr-comment-new .ztr-comment-actions {\n  font-size: 1.1em;\n  padding: 0;\n}\n\n.ztr-spinner .path {\n  stroke: var(--ztr-text-color, #DEDEDE);\n}\n\n.ztr-comment,\n.ztr-reply-button {\n  background-color: var(--ztr-background-color, rgba(255, 255, 255, 0.06));\n}\n\nsvg {\n  width: 1.1em;\n  height: 1.1em;\n  fill: var(--ztr-icon-color, #6d6d6d);\n}\n\nul.ztr-comment-actions li span {\n  padding: 0.25em 0.25em 0 0.25em;\n  color: var(--ztr-icon-color, #6d6d6d);\n}\n\n.ztr-comment-action-reply:hover svg {\n  fill: var(--ztr-action-color, #96609c);\n}\n\n.ztr-comment-action-reply:hover span {\n  color: var(--ztr-action-color, #96609c);\n}\n'),ee($,(O=E((()=>!!f())),()=>{return O()&&(e=bl(),_((()=>e.innerHTML=f())),e);var e}),null),ee($,(L=E((()=>"error"===r().type)),()=>{return L()&&[wl(),(e=kl(),ee(e.firstChild,(()=>r().value)),e)];var e}),null),ee($,(M=E((()=>"error"!==r().type)),()=>{return M()&&[E((()=>E((()=>!ir.disableFeatures.includes("reply")))()&&K(fa,{}))),(t=_l(),ee(t,(e=E((()=>m()>0)),()=>e()&&`${m()} comment${1==m()?"":"s"}`)),t),K(Na,{topNestedEvents:g,bottomNestedEvents:y,articles:u,votes:A,firstLevelComments:v})];var e,t}),null),$;var O,L,M,$,R};return function(e,t,n){2===arguments.length&&(n=t,t={}),de(e,t)(he(n))}("zap-threads",{anchor:"",community:"",version:"",relays:"",author:"",disable:"",urls:"","reply-placeholder":"","legacy-url":"",language:"",client:"","max-comment-length":"","min-read-pow":"","max-write-pow":""},(e=>K(xl,{get anchor(){return e.anchor??""},get version(){return e.version??""},get relays(){return e.relays??""},get author(){return e.author??""},get community(){return e.community??""},get disable(){return e.disable??""},get urls(){return e.urls??""},get replyPlaceholder(){return e["reply-placeholder"]??""},get legacyUrl(){return e["legacy-url"]??""},get language(){return e.language??""},get client(){return e.client??""},get maxCommentLength(){return e["max-comment-length"]??""},get minReadPow(){return e["min-read-pow"]??""},get maxWritePow(){return e["max-write-pow"]??""}}))),xl.onLogin=function(e){return ir.onLogin=e,xl},xl.onEvent=function(e){return ir.onEvent=e,xl},xl.onPublish=function(e){return ir.onPublish=e,xl},xl.onRemove=function(e){return ir.onRemove=e,xl},xl.onReport=function(e){return ir.onReport=e,xl},xl}();
